import{j as e,c as L,d as T,e as S,f as I,I as z,L as D,g as Q,h as $,i as B}from"./radix-CDPlHJ-s.js";import{c as l,u as P,T as E,d as F,e as h,f as x,g as W,h as c,a as O}from"./index.js";import{u as R,r as u}from"./router-Cji3JhtE.js";import{e as H,f as U}from"./icons-dUk6Lg-n.js";function A({...o}){return e.jsx(L,{"data-slot":"dropdown-menu",...o})}function V({...o}){return e.jsx(T,{"data-slot":"dropdown-menu-trigger",...o})}function J({className:o,sideOffset:n=4,...i}){return e.jsx(S,{children:e.jsx(I,{"data-slot":"dropdown-menu-content",sideOffset:n,className:l("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",o),...i})})}function f({className:o,inset:n,variant:i="default",...r}){return e.jsx(z,{"data-slot":"dropdown-menu-item","data-inset":n,"data-variant":i,className:l("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),...r})}function ee({className:o,children:n,checked:i,...r}){return e.jsxs($,{"data-slot":"dropdown-menu-checkbox-item",className:l("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),checked:i,...r,children:[e.jsx("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:e.jsx(B,{children:e.jsx(H,{className:"size-4"})})}),n]})}function te({className:o,inset:n,...i}){return e.jsx(D,{"data-slot":"dropdown-menu-label","data-inset":n,className:l("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",o),...i})}function se({className:o,...n}){return e.jsx(Q,{"data-slot":"dropdown-menu-separator",className:l("bg-border -mx-1 my-1 h-px",o),...n})}function G({onClose:o}={}){const n=R(),{refreshFiles:i}=P(),[r,j]=u.useState({queue:[],currently_processing:null,processing_state:"idle",age_in_seconds:0}),[b,w]=u.useState(!0),[g,m]=u.useState(null),p=async()=>{try{const s=await fetch(O("/api/queue/status"));if(s.ok){const t=await s.json();t.success?(r.currently_processing&&t.data.currently_processing!=r.currently_processing&&i(),j(t.data)):m(t.error),m(null)}else throw new Error(`Failed to fetch queue status: ${s.status}`)}catch(s){console.error("Error fetching queue status:",s),m(s instanceof Error?s.message:"Failed to fetch queue status")}finally{w(!1)}};u.useEffect(()=>{const s=setInterval(()=>{p()},1e3);return()=>clearInterval(s)},[r.currently_processing]);const N=async s=>{confirm(`Remove "${s.split("/").pop()}" from queue?`)},k=async s=>{if(confirm(`Cancel processing of "${s.split("/").pop()}"?`))try{const t=await fetch("/api/queue/cancel",{method:"POST",headers:{"Content-Type":"application/json"}});if(t.ok)await p();else{const a=await t.json().catch(()=>({message:"Unknown error"}));alert(`Failed to cancel job: ${a.message}`)}}catch(t){console.error("Error cancelling job:",t),alert("Failed to cancel processing job")}},y=async s=>{if(s===0)return;const t=[...r.queue],[a]=t.splice(s,1);t.splice(s-1,0,a),await d(t)},_=async s=>{if(s===r.queue.length-1)return;const t=[...r.queue],[a]=t.splice(s,1);t.splice(s+1,0,a),await d(t)},C=async s=>{if(s===0)return;const t=[...r.queue],[a]=t.splice(s,1);t.splice(0,0,a),await d(t)},M=async s=>{if(s===r.queue.length-1)return;const t=[...r.queue],[a]=t.splice(s,1);t.push(a),await d(t)},d=async s=>{try{const t=await fetch("/api/queue/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paths:s})});if(t.ok)await p();else{const a=await t.json().catch(()=>({message:"Unknown error"}));alert(`Failed to set queue: ${a.message}`)}}catch(t){console.error("Error setting queue:",t),alert("Failed to set queue")}},v=s=>{var t;return((t=s.split("/").pop())==null?void 0:t.replace(/\.(mp4|MP4)$/,""))||s},q=()=>{o?o():n("/")};return b?e.jsx("div",{className:"h-full overflow-auto",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-lg text-muted-foreground",children:"Loading queue..."})})}):e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("div",{className:"p-6 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Queue"})}),o&&e.jsxs("button",{onClick:q,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(U,{className:"h-4 w-4"}),"Close"]})]}),g&&e.jsx("div",{className:"mb-6 p-4 bg-destructive/10 border border-destructive/20 rounded-md",children:e.jsx("p",{className:"text-sm text-destructive",children:g})}),e.jsx("div",{className:"border border-border rounded-md",children:!r.currently_processing&&r.queue.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No items in queue"}):e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(h,{children:[e.jsx(x,{className:"w-[15%] text-left",children:"Position"}),e.jsx(x,{className:"w-[65%] text-left",children:"File"}),e.jsx(x,{className:"w-[20%] text-left",children:"Actions"})]})}),e.jsxs(W,{children:[r.currently_processing&&e.jsxs(h,{children:[e.jsx(c,{className:"font-mono text-sm text-left",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"text-orange-600 dark:text-orange-400",children:"Processing"}),e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),r.age_in_seconds!==void 0&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",r.age_in_seconds,"s)"]})]})}),e.jsx(c,{className:"font-medium text-left",children:e.jsx("div",{className:"max-w-xs truncate",title:r.currently_processing,children:v(r.currently_processing)})}),e.jsx(c,{className:"text-left",children:e.jsx("button",{onClick:()=>k(r.currently_processing),className:"p-1.5 border border-red-500 text-red-500 bg-transparent rounded hover:bg-red-50 hover:border-red-600 hover:text-red-600 dark:hover:bg-red-950/20 focus:outline-none focus:ring-1 focus:ring-red-500 transition-colors",title:"Cancel processing",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},`processing-${r.currently_processing}`),r.queue.map((s,t)=>e.jsxs(h,{children:[e.jsx(c,{className:"font-mono text-sm text-left",children:`#${t+1}`}),e.jsx(c,{className:"font-medium text-left",children:e.jsx("div",{className:"max-w-xs truncate",title:s,children:v(s)})}),e.jsx(c,{className:"text-left",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>y(t),disabled:t===0,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Move up",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{onClick:()=>_(t),disabled:t===r.queue.length-1,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Move down",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs(A,{modal:!1,children:[e.jsx(V,{asChild:!0,children:e.jsx("button",{className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors",title:"More actions",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(J,{align:"end",children:[e.jsxs(f,{onClick:()=>C(t),disabled:t===0,className:"focus:text-primary",children:[e.jsx("span",{children:"Send to top"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})]}),e.jsxs(f,{onClick:()=>M(t),disabled:t===r.queue.length-1,className:"focus:text-primary",children:[e.jsx("span",{children:"Send to bottom"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})]}),e.jsxs(f,{onClick:()=>N(s),className:"text-destructive focus:text-destructive",children:[e.jsx("span",{children:"Remove from queue"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]})]})]})]})})]},`${s}-${t}`))]})]})})]})})}const re=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));export{A as D,G as Q,V as a,J as b,te as c,se as d,ee as e,f,re as g};
