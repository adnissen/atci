import{l as Z,r as l,d as m,j as s,T as ee,i as se,g as te,k as q,m as ae,P as oe,C as f,n as V,D as N}from"./index.js";import{C as re}from"./chevron-left.js";function ie({onClose:u}={}){var O;const C=Z(),[o,c]=l.useState({watch_directories:[""],whispercli_path:"",model_path:"",ffmpeg_path:"",ffprobe_path:""}),[x,y]=l.useState(!1),[S,n]=l.useState([]),[k,h]=l.useState(""),[W,D]=l.useState(!1),[p,B]=l.useState([]),[H,T]=l.useState(!1),[d,j]=l.useState("custom"),[F,P]=l.useState(null),[g,J]=l.useState([]),[b,A]=l.useState(null);l.useEffect(()=>{_(),M(),v()},[]);const M=async()=>{T(!0);try{const e=await fetch(m("/api/models/list"));if(e.ok){const t=await e.json();t.success&&t.data?B(t.data||[]):n([t.error||"Failed to fetch models"])}}catch(e){console.error("Error fetching models:",e)}finally{T(!1)}},U=async e=>{P(e);try{const t=await fetch(m("/api/models/download"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e})});if(t.ok)await M(),d===e&&c(a=>({...a,model_name:e,model_path:""}));else{const a=await t.json();n([a.message||"Failed to download model"])}}catch{n(["Network error: Failed to download model"])}finally{P(null)}},v=async()=>{try{const e=await fetch(m("/api/tools/list"));if(e.ok){const t=await e.json();t.success&&t.data?J(t.data||[]):n([t.error||"Failed to fetch tools"])}else console.error("Failed to fetch tools")}catch(e){console.error("Error fetching tools:",e)}},$=async e=>{A(e);try{const t=await fetch(m("/api/tools/download"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:e})});if(t.ok)await v(),await _(),h(`${e} downloaded successfully`);else{const a=await t.json();n([a.message||`Failed to download ${e}`])}}catch(t){console.error("Error downloading tool:",t),n([t.message||`Failed to download ${e}`])}finally{A(null)}},I=async e=>{try{const t=await fetch(m("/api/tools/use-downloaded"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:e})});if(t.ok)await _(),await v(),h(`Now using downloaded ${e}`);else{const a=await t.json();n([a.message||`Failed to use downloaded ${e}`])}}catch(t){console.error("Error setting tool path:",t),n([t.message||`Failed to use downloaded ${e}`])}},R=async e=>{const t=g.find(a=>a.name===e);t&&t.system_path?(c(a=>({...a,[`${e}_path`]:t.system_path})),h("")):n([`System path not found for ${e}`])},z=async e=>{const t=g.find(a=>a.name===e);t&&t.system_path?(c(a=>({...a,[`${e}_path`]:t.system_path})),h("")):n([`System path not found for ${e}`])},_=async()=>{var e;D(!0);try{const t=await fetch(m("/api/config"),{headers:{Accept:"application/json","Content-Type":"application/json"}});if(t.ok){const a=await t.json();if(a.success&&((e=a.data)!=null&&e.config)){const r=a.data.config,i={watch_directories:r.watch_directories&&r.watch_directories.length>0?r.watch_directories:[""],whispercli_path:r.whispercli_path||"",model_path:r.model_path||"",model_name:r.model_name||"",ffmpeg_path:r.ffmpeg_path||"",ffprobe_path:r.ffprobe_path||"",password:r.password||""};c(i),i.model_name?j(i.model_name):i.model_path&&j("custom")}}}catch(t){console.error("Error fetching configuration:",t)}finally{D(!1)}},E=()=>{var a,r;const e=o.watch_directories.some(i=>i.trim()!==""),t=d==="custom"&&((a=o.model_path)==null?void 0:a.trim())!==""||d!=="custom"&&((r=p.find(i=>i.name===d))==null?void 0:r.downloaded);return e&&o.whispercli_path.trim()!==""&&o.ffmpeg_path.trim()!==""&&o.ffprobe_path.trim()!==""&&t},w=(e,t)=>{c(a=>({...a,[e]:t}))},G=(e,t)=>{const a=[...o.watch_directories];a[e]=t,c(r=>({...r,watch_directories:a}))},K=()=>{c(e=>({...e,watch_directories:[...e.watch_directories,""]}))},Q=e=>{if(o.watch_directories.length>1){const t=o.watch_directories.filter((a,r)=>r!==e);c(a=>({...a,watch_directories:t}))}},X=()=>{u?u():C("/")},Y=e=>{j(e),e==="custom"?c(t=>({...t,model_name:void 0,model_path:t.model_path||""})):p.find(a=>a.name===e)&&c(a=>({...a,model_name:e,model_path:""}))},L=async(e=!1)=>{y(!0),n([]),h("");const t=o.watch_directories.filter(r=>r.trim()!=="");if(t.length===0){n(["At least one watch directory is required"]),y(!1);return}const a={watch_directories:t,whispercli_path:o.whispercli_path,ffmpeg_path:o.ffmpeg_path,ffprobe_path:o.ffprobe_path};d==="custom"?a.model_path=o.model_path:a.model_name=d,o.password!==void 0&&(a.password=o.password);try{const r=await fetch(m("/api/config"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)}),i=await r.json();r.ok&&i.success?(h("Configuration saved successfully!"),e&&setTimeout(()=>{u?u():C("/")},1e3)):n(i.errors||[i.message||"Failed to save configuration"])}catch{n(["Network error: Failed to save configuration"])}finally{y(!1)}};return s.jsx("div",{className:"h-full overflow-auto",children:W?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-lg text-muted-foreground",children:"Loading configuration..."})}):s.jsxs("div",{className:"p-6 h-full",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Configuration"}),u&&s.jsxs("button",{onClick:X,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[s.jsx(re,{className:"h-4 w-4"}),"Close"]})]}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),L(!1)},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Watch Directories"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"border border-input rounded-md",children:s.jsx(ee,{children:s.jsx(se,{children:o.watch_directories.map((e,t)=>s.jsxs(te,{children:[s.jsx(q,{className:"p-2",children:s.jsx("input",{type:"text",value:e,onChange:a=>G(t,a.target.value),placeholder:"/path/to/your/videos",className:"w-full px-2 py-1 text-sm border-0 bg-transparent text-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:ring-inset rounded"})}),s.jsx(q,{className:"p-2 w-10",children:s.jsx("button",{type:"button",onClick:()=>Q(t),disabled:o.watch_directories.length===1,className:"p-1 text-destructive hover:bg-destructive/10 rounded disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent",title:"Remove directory",children:s.jsx(ae,{className:"h-3 w-3"})})})]},t))})})}),s.jsxs("button",{type:"button",onClick:K,className:"flex items-center gap-1 px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded hover:bg-secondary/80",children:[s.jsx(oe,{className:"h-3 w-3"}),"Add Directory"]})]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Directories to monitor for video files. At least one directory is required."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Whisper-CLI Tool"}),g.filter(e=>e.name==="whisper-cli").map(e=>s.jsxs("div",{className:"border border-border rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Whisper CLI"}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:["Platform: ",e.platform]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-xs space-y-1",children:[e.system_available&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Available in system PATH: ",e.system_path]}),e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Downloaded to: ",e.downloaded_path]}),!e.system_available&&!e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[s.jsx(V,{className:"h-3 w-3"}),"Not found in system PATH or downloads"]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"whispercli_path",className:"block text-xs font-medium text-foreground mb-1",children:"Current Path"}),s.jsx("input",{type:"text",id:"whispercli_path",value:o.whispercli_path,onChange:t=>w("whispercli_path",t.target.value),placeholder:"/path/to/whisper-cli",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent text-sm",required:!0})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[!e.downloaded&&s.jsxs("button",{type:"button",onClick:()=>$(e.name),disabled:b!==null,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(N,{className:"h-3 w-3"}),b===e.name?"Downloading...":"Download"]}),e.downloaded&&s.jsx("button",{type:"button",onClick:()=>I(e.name),className:"px-3 py-1.5 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Use Downloaded Version"}),e.system_available&&s.jsx("button",{type:"button",onClick:()=>z(e.name),className:"px-3 py-1.5 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Use System Version"})]})]})]},e.name))]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Model Selection"}),s.jsxs("select",{value:d,onChange:e=>Y(e.target.value),className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",disabled:H,children:[s.jsx("option",{value:"custom",children:"Custom Model Path"}),p.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("optgroup",{label:"Downloaded Models",children:p.filter(e=>e.downloaded).map(e=>s.jsxs("option",{value:e.name,children:[e.name," âœ“"]},e.name))}),s.jsx("optgroup",{label:"Available Models",children:p.filter(e=>!e.downloaded).map(e=>s.jsx("option",{value:e.name,children:e.name},e.name))})]})]}),d==="custom"?s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"text",value:o.model_path||"",onChange:e=>w("model_path",e.target.value),placeholder:"/path/to/your/whisper.cpp/model.bin",className:"w-full mt-2 px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",required:d==="custom"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Path to the Whisper model file (.bin)"})]}):d!=="custom"&&s.jsx(s.Fragment,{children:(O=p.find(e=>e.name===d))!=null&&O.downloaded?s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-green-600",children:[s.jsx(f,{className:"h-4 w-4"}),"Model is downloaded and ready to use"]}):s.jsxs("button",{type:"button",onClick:()=>U(d),disabled:F!==null,className:"mt-2 flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(N,{className:"h-3 w-3"}),F===d?"Downloading...":"Download Model"]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"FFmpeg Tools"}),g.filter(e=>e.name==="ffmpeg"||e.name==="ffprobe").map(e=>s.jsxs("div",{className:"border border-border rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-sm font-medium text-foreground capitalize",children:e.name}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:["Platform: ",e.platform]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-xs space-y-1",children:[e.system_available&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Available in system PATH: ",e.system_path]}),e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Downloaded to: ",e.downloaded_path]}),!e.system_available&&!e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[s.jsx(V,{className:"h-3 w-3"}),"Not found in system PATH or downloads"]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`${e.name}_path`,className:"block text-xs font-medium text-foreground mb-1",children:"Current Path"}),s.jsx("input",{type:"text",id:`${e.name}_path`,value:o[`${e.name}_path`],onChange:t=>w(`${e.name}_path`,t.target.value),placeholder:`/path/to/${e.name}`,className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent text-sm",required:!0})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[!e.downloaded&&s.jsxs("button",{type:"button",onClick:()=>$(e.name),disabled:b!==null,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(N,{className:"h-3 w-3"}),b===e.name?"Downloading...":"Download"]}),e.downloaded&&s.jsx("button",{type:"button",onClick:()=>I(e.name),className:"px-3 py-1.5 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Use Downloaded Version"}),e.system_available&&s.jsx("button",{type:"button",onClick:()=>R(e.name),className:"px-3 py-1.5 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Use System Version"})]})]})]},e.name))]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-foreground mb-1",children:"API Password (optional)"}),s.jsx("input",{type:"password",id:"password",value:o.password||"",onChange:e=>w("password",e.target.value),placeholder:"Set or clear API password (leave blank to disable)",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"If set, all API requests require this password (via Basic Auth or cookie)."})]}),S.length>0&&s.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-3",children:s.jsx("div",{className:"text-sm text-destructive",children:s.jsx("ul",{className:"list-disc list-inside space-y-1",children:S.map((e,t)=>s.jsx("li",{children:e},t))})})}),k&&s.jsx("div",{className:"bg-accent/10 border border-accent/20 rounded-md p-3",children:s.jsx("div",{className:"text-sm text-accent-foreground",children:k})}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"submit",disabled:x||!E(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Saving...":"Save"}),s.jsx("button",{type:"button",onClick:()=>L(!0),disabled:x||!E(),className:"px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/80 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Saving...":"Save and Close"})]})]})]})})}export{ie as default};
