import{j as e,S as Cn,C as Sn,a as Rn,T as En,R as Ln,b as _n,P as Mn,O as Tn}from"./radix-CDPlHJ-s.js";import{r as u,b as d}from"./router-Cji3JhtE.js";import{a as $n}from"./utils-BMpDO24p.js";import{c as $e,a as Ve,u as Qt,T as Dn,b as On,d as jt,e as nt,f as Pn,g as Ge}from"./index.js";import{D as Fe,a as He,b as ze,c as vt,d as Qe,e as Je,f as ye,Q as It}from"./QueuePage-BtxpzuDR.js";import{b as yt,X as An,c as Bn,d as Ft,e as In,f as Fn,R as Hn,g as zn,D as kt,h as Nt}from"./icons-D0PEVxHe.js";import Ht from"./ConfigPage-DWe62UL6.js";import"./react-vendor-DJG_os-6.js";const Wn=$n("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),je=u.forwardRef(({className:t,variant:n,size:r,asChild:a=!1,...i},l)=>{const b=a?Cn:"button";return e.jsx(b,{className:$e(Wn({variant:n,size:r,className:t})),ref:l,...i})});je.displayName="Button";function Un(t){const[n,r]=u.useState(()=>window.matchMedia(t).matches);return u.useEffect(()=>{const a=window.matchMedia(t),i=l=>{r(l.matches)};return a.addEventListener("change",i),r(a.matches),()=>{a.removeEventListener("change",i)}},[t]),n}function Jt(){return!Un("(min-width: 640px)")}function Vn({searchTerm:t,setSearchTerm:n,activeSearchTerm:r,setActiveSearchTerm:a,setSearchLineNumbers:i,setExpandedFiles:l,isSearching:b,isOpen:w,onClose:y,onSearch:L,onClearSearch:g,selectedWatchDirs:f,setSelectedWatchDirs:m,availableWatchDirs:$,selectedSources:_,setSelectedSources:M,availableSources:I}){const R=()=>{n(""),a(""),i({}),l(new Set),g()};return w?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20",children:e.jsx("div",{className:"bg-background border border-border rounded-lg shadow-lg w-full max-w-md mx-4",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Search"}),e.jsx("button",{onClick:y,className:"p-1 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:S=>{const O=S.target.value;n(O),O.trim()===""&&(a(""),i({}),l(new Set))},onKeyDown:S=>{S.key==="Enter"&&(L(),y())},className:"w-full px-3 py-2 pr-10 text-sm border border-input bg-background text-foreground rounded focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",autoFocus:!0}),(t||r)&&e.jsx("button",{onClick:R,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",title:"Clear search",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),($.length>1||I.length>1)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Search Filters"}),$.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Watch Directories"}),e.jsxs(Fe,{modal:!1,children:[e.jsx(He,{asChild:!0,children:e.jsxs("button",{className:"w-full inline-flex items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[f.length===$.length||f.length===0?"All Directories":`${f.length} Director${f.length===1?"y":"ies"}`,e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(ze,{align:"start",className:"w-80",children:[e.jsx(vt,{children:"Watch Directories"}),e.jsx(Qe,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Je,{checked:f.length===$.length,onCheckedChange:S=>{m(S?[...$]:[])},children:"Select All"}),e.jsx(Qe,{}),$.map(S=>e.jsx(Je,{checked:f.includes(S),onCheckedChange:O=>{m(O?[...f,S]:f.filter(v=>v!==S))},children:e.jsx("span",{className:"truncate",title:S,children:S.split("/").pop()||S})},S))]})]})]})]}),I.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Transcript Sources"}),e.jsxs(Fe,{modal:!1,children:[e.jsx(He,{asChild:!0,children:e.jsxs("button",{className:"w-full inline-flex items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[_.length===I.length?"All Sources":_.length===0?"No Sources":`${_.length} Source${_.length===1?"":"s"}`,e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(ze,{align:"start",className:"w-80",children:[e.jsx(vt,{children:"Sources"}),e.jsx(Qe,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Je,{checked:_.length===I.length,onCheckedChange:S=>{M(S?[...I]:[])},children:"Select All"}),e.jsx(Qe,{}),I.map(S=>e.jsx(Je,{checked:_.includes(S),onCheckedChange:O=>{M(O?[..._,S]:_.filter(v=>v!==S))},children:S},S))]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{L(),y()},disabled:b,className:"flex-1 px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:`w-4 h-4 ${b?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",strokeWidth:2}),e.jsx("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21",strokeWidth:2,strokeLinecap:"round"})]}),"Search"]}),e.jsx("button",{onClick:R,className:"px-4 py-2 text-sm border border-red-300 bg-red-50 text-red-700 rounded hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Clear"}),e.jsx("button",{onClick:y,className:"px-4 py-2 text-sm border border-input bg-background text-foreground rounded hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring",children:"Cancel"})]})]})})}):null}function qn({show:t,searchTerm:n,setSearchTerm:r,activeSearchTerm:a,setActiveSearchTerm:i,setSearchLineNumbers:l,setExpandedFiles:b,isSearching:w,queue:y,isAtTop:L,clipStart:g,clipEnd:f,mobileClipPlayerComponent:m,selectedWatchDirs:$,setSelectedWatchDirs:_,availableWatchDirs:M,selectedSources:I,setSelectedSources:R,availableSources:S,showAllFiles:O,onToggleShowAllFiles:v,onSearch:z,onClearSearch:V,onScrollToTop:x,onConfigClick:p,onQueueClick:D,onPlayClip:F}){const[W,X]=u.useState(!1),c=Jt(),E=()=>{r(""),i(""),l({}),b(new Set),V()};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-background/95 border-b border-border px-2 sm:px-4 z-10 backdrop-blur-sm ${c?"py-1":"py-2"}`,children:e.jsx("div",{className:"w-full",children:c?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center gap-1",children:[e.jsx("div",{className:"flex items-center flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-lg",children:"atci"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(je,{onClick:p,variant:"ghost",size:"sm",className:"px-2 py-1 rounded hover:bg-accent group text-xs gap-1",title:"Edit configuration",children:[e.jsx("svg",{className:"w-4 h-4 group-hover:animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"})}),e.jsx("span",{children:"Config"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(je,{onClick:D,variant:"ghost",size:"sm",className:"px-2 py-1 rounded hover:bg-accent text-xs gap-1 group",title:"View processing queue",children:[e.jsx("div",{className:"relative w-4 h-4 overflow-hidden",children:e.jsxs("div",{className:"group-hover:animate-[moveUp_1s_linear_infinite] transition-transform",children:[e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"2px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"6px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"10px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"14px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"18px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"22px"}})]})}),e.jsx("span",{children:"Queue"})]}),y.length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1",children:y.length})]}),e.jsxs(je,{onClick:F,disabled:g==null||f===null||f===void 0||!F||m!==null,variant:"ghost",size:"sm",className:"px-2 py-1 rounded hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed text-xs gap-1",title:m!==null?"Clip player is already open":g!=null&&f!==null&&f!==void 0?"Play Clip":"No clip selected",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),e.jsx("span",{children:"Clip"})]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"looking for something?",value:n,onChange:k=>{const q=k.target.value;r(q),q.trim()===""&&(i(""),l({}),b(new Set))},onKeyDown:k=>k.key==="Enter"&&z(),className:"w-full px-3 py-1.5 bg-muted text-foreground text-sm rounded-full border border-border focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),(n||a)&&e.jsx("button",{onClick:E,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-0.5 text-muted-foreground hover:text-foreground transition-colors rounded-full hover:bg-accent",title:"Clear search",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx(je,{onClick:()=>{O&&v(),z()},disabled:w,variant:O&&!a?"secondary":"default",className:`px-3 py-1.5 rounded-full text-sm font-medium disabled:opacity-50 ${O&&!a?"":"bg-primary hover:bg-primary/90 text-primary-foreground"}`,children:w?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",strokeWidth:2}),e.jsx("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21",strokeWidth:2,strokeLinecap:"round"})]}):"Search"}),e.jsx(je,{onClick:()=>{E(),O||v(),x()},variant:O&&!a?"default":"secondary",className:"px-3 py-1.5 rounded-full text-sm font-medium",children:"All"})]})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"flex items-center flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-lg",children:"atci"})}),e.jsx("div",{className:"flex-1 max-w-md mx-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"looking for something?",value:n,onChange:k=>{const q=k.target.value;r(q),q.trim()===""&&(i(""),l({}),b(new Set))},onKeyDown:k=>k.key==="Enter"&&z(),className:"w-full px-4 py-2 bg-muted text-foreground rounded-full border border-border focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),(n||a)&&e.jsx("button",{onClick:E,className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 text-muted-foreground hover:text-foreground transition-colors rounded-full hover:bg-accent",title:"Clear search",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"flex gap-1 items-center flex-shrink-0",children:[e.jsx(je,{onClick:()=>{O&&v(),z()},disabled:w,variant:O&&!a?"secondary":"default",className:`px-4 py-2 rounded-full text-sm font-medium disabled:opacity-50 ${O&&!a?"":"bg-primary hover:bg-primary/90 text-primary-foreground"}`,children:w?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",strokeWidth:2}),e.jsx("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21",strokeWidth:2,strokeLinecap:"round"})]}):"Search"}),e.jsx(je,{onClick:()=>{E(),O||v(),x()},variant:O&&!a?"default":"secondary",className:"px-4 py-2 rounded-full text-sm font-medium",children:"All"}),e.jsxs("div",{className:"relative",children:[e.jsx(je,{onClick:D,variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-accent group",title:"View processing queue",children:e.jsx("div",{className:"relative w-5 h-5 overflow-hidden",children:e.jsxs("div",{className:"group-hover:animate-[moveUp_1s_linear_infinite] transition-transform",children:[e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"3px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"8px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"13px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"18px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"23px"}}),e.jsx("div",{className:"absolute left-0 right-0 h-px bg-current rounded-full",style:{top:"28px"}})]})})}),y.length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1",children:y.length})]}),e.jsx(je,{onClick:p,variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-accent group",title:"Edit configuration",children:e.jsx("svg",{className:"w-5 h-5 group-hover:animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"})})})]})]})})}),e.jsx(Vn,{searchTerm:n,setSearchTerm:r,activeSearchTerm:a,setActiveSearchTerm:i,setSearchLineNumbers:l,setExpandedFiles:b,isSearching:w,isOpen:W,onClose:()=>X(!1),onSearch:z,onClearSearch:V,selectedWatchDirs:$,setSelectedWatchDirs:_,availableWatchDirs:M,selectedSources:I,setSelectedSources:R,availableSources:S})]})}const Mt=({isOpen:t,filename:n,transcriptInitialValue:r,onTranscriptSave:a,onCancel:i,isTranscriptSubmitting:l,transcriptTargetLineNumber:b})=>{const[w,y]=d.useState(r),L=d.useRef(null);d.useEffect(()=>{t&&y(r)},[t,r]),d.useEffect(()=>{t&&b&&L.current&&setTimeout(()=>{const f=L.current;if(!f)return;const m=f.value.split(`
`);if(b<=m.length){let $=0;for(let I=0;I<b-1;I++)$+=m[I].length+1;f.setSelectionRange($,$),f.focus();const _=f.scrollHeight/m.length,M=(b-1)*_;f.scrollTop=M-f.clientHeight/2}},100)},[t,b]);const g=()=>{a(w)};return t?e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg max-w-5xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Edit Transcript - ",n]}),e.jsx("button",{onClick:i,className:"p-1 text-muted-foreground hover:text-foreground hover:bg-accent rounded transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-md font-medium text-foreground",children:"Transcript (.txt)"}),e.jsx("button",{onClick:g,disabled:l,className:"px-3 py-1.5 text-xs font-normal text-primary-foreground bg-primary border border-transparent rounded hover:bg-primary/90 disabled:opacity-50 transition-colors",children:l?"Saving...":"Save Transcript"})]}),e.jsx("textarea",{ref:L,value:w,onChange:f=>y(f.target.value),className:"w-full h-64 p-3 border border-input bg-background text-foreground rounded-md font-mono text-sm leading-6 focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",placeholder:"Enter transcript content...",readOnly:l})]})})]})}):null},zt=({open:t,onOpenChange:n,selectedTime:r,clipStart:a,clipEnd:i,clipTranscript:l,currentTranscript:b,onSetClipStart:w,onSetClipEnd:y,onClearClip:L,onClipBlock:g,blockStartTime:f,blockEndTime:m,children:$})=>{const _=l!==null&&l!==b,M=!_&&i!==null&&r>=i,I=!_&&a!==null&&r<=a;return e.jsxs(Fe,{modal:!1,open:t,onOpenChange:n,children:[e.jsx(He,{asChild:!0,children:$}),e.jsxs(ze,{align:"start",side:"right",sideOffset:8,children:[e.jsxs(ye,{onClick:()=>w(r),disabled:M,className:`flex items-center gap-2 ${M?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(yt,{size:16,className:"text-green-600"}),"Set Clip Start"]}),e.jsxs(ye,{onClick:()=>y(r),disabled:I,className:`flex items-center gap-2 ${I?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(yt,{size:16,className:"text-red-600"}),"Set Clip End"]}),g&&f!==void 0&&m!==void 0&&e.jsxs(ye,{onClick:()=>g(f,m),className:"flex items-center gap-2",children:[e.jsx(yt,{size:16,className:"text-purple-600"}),"Clip Block"]}),(a!==null||i!==null)&&e.jsxs(ye,{onClick:L,className:"flex items-center gap-2",children:[e.jsx(An,{size:16,className:"text-gray-600"}),"Clear Clip"]})]})]})},Yn=d.memo(({startTime:t,endTime:n,visible:r,text:a,name:i,fullPath:l,isSearchResult:b=!1,lineNumbers:w,onEditSuccess:y,fullTranscript:L="",isSmallScreen:g=!1,onSetRightPaneUrl:f,clipStart:m,clipEnd:$,clipTranscript:_,onSetClipStart:M,onSetClipEnd:I,onClearClip:R,onClipBlock:S})=>{const[O,v]=d.useState(!1),[z,V]=d.useState(!1),[x,p]=d.useState(!1),[D,F]=d.useState(null),[W,X]=d.useState(null),[c,E]=d.useState(!1),[k,q]=d.useState(null),C=h=>{const o=h.split(":"),U=parseInt(o[0],10),Q=parseInt(o[1],10),de=o[2].split("."),ne=parseInt(de[0],10),Pe=parseInt(de[1]||"0",10);return U*3600+Q*60+ne+Pe/1e3},se=d.useMemo(()=>{if(!t||!n||m===null||m===void 0||_!==i)return!1;const h=C(t),o=C(n);return m>=h&&m<=o},[t,n,m,_,i]),Y=d.useMemo(()=>{if(!t||!n||$===null||$===void 0||_!==i)return!1;const h=C(t),o=C(n);return $>=h&&$<=o},[t,n,$,_,i]),xe=d.useMemo(()=>{if(!t||!n||m===null||m===void 0||$===null||$===void 0||_!==l)return!1;const h=C(t),o=C(n);return h>=m&&o<=$},[t,n,m,$,_,i]),ae=se||Y||xe,ge=(h,o)=>{q({time:h,type:o}),E(!0)};if(d.useEffect(()=>{},[a]),d.useEffect(()=>{},[t,n]),d.useEffect(()=>{const h=o=>{const U=o.target;if(U.classList.contains("timestamp-link")){o.preventDefault();const Q=U.getAttribute("data-url");Q&&f&&f(Q)}};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}},[f]),!r||a==="WEBVTT")return null;const le=d.useMemo(()=>{const h=/(\d{2}:\d{2}:\d{2}\.\d{3})/g;return a.replace(h,o=>{const U=C(o);return`<span class="text-sky-700 hover:text-sky-600 underline cursor-pointer timestamp-link" data-timestamp="${o}" data-url="/player/${encodeURIComponent(i)}?time=${U}">${o}</span>`})},[a,i]),ve=()=>{v(!0)},re=async h=>{var o;if(h.trim()===L.trim()){v(!1);return}V(!0);try{const U=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),Q=await fetch(Ve("/api/transcripts/replace"),{method:"POST",headers:{"X-CSRF-Token":U||"","Content-Type":"application/json"},body:JSON.stringify({video_path:i,new_content:h})});if(Q.ok)y&&y(),v(!1);else{const de=await Q.json();alert(`Error: ${de.error||"Failed to update transcript"}`)}}catch(U){console.error("Error updating transcript:",U),alert("Error: Failed to update transcript. Please try again.")}finally{V(!1)}},Ce=()=>{v(!1)},ce=()=>{p(!0)},Se=async h=>{var o;if(h.trim()===L.trim()){p(!1);return}V(!0);try{const U=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),Q=await fetch(Ve("/api/transcripts/replace"),{method:"POST",headers:{"X-CSRF-Token":U||"","Content-Type":"application/json"},body:JSON.stringify({video_path:l,new_content:h})});if(Q.ok)y&&y(),p(!1);else{const de=await Q.json();alert(`Error: ${de.error||"Failed to update timestamp"}`)}}catch(U){console.error("Error updating timestamp:",U),alert("Error: Failed to update timestamp. Please try again.")}finally{V(!1)}},ue=()=>{p(!1)};if(t&&n&&t===n)return e.jsx(e.Fragment,{});const Ne=w[0],oe=w[w.length-1],N=()=>{const h=[];return b&&ae?h.push("bg-gradient-to-r","from-primary/10","to-amber-500/10","border-l-4","border-primary","pl-2"):b?h.push("bg-primary/10","border-l-4","border-primary","pl-2"):ae&&h.push("bg-amber-500/10","border-l-4","border-amber-500","pl-2"),h.join(" ")};return e.jsxs("div",{className:N(),children:[ae&&e.jsx("div",{className:"flex items-center gap-1 text-xs text-amber-600 dark:text-amber-400 mb-1",children:e.jsx("span",{className:"bg-amber-500/20 px-1 py-0.5 rounded text-amber-700 dark:text-amber-300 font-medium",children:"Clip"})}),t&&n&&e.jsx("div",{className:"group",children:e.jsxs("span",{className:"relative",children:[e.jsx("div",{className:"flex items-center gap-1 min-w-0",children:e.jsxs("div",{className:"text-muted-foreground text-sm font-mono flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:`text-xs mr-2 flex-shrink-0 text-right w-8 cursor-pointer transition-colors duration-200 ${D===Ne||W==="timestamp"?"text-blue-600 hover:text-blue-700":"text-muted-foreground hover:text-blue-500"}`,onClick:()=>X(W==="timestamp"?null:"timestamp"),onMouseEnter:()=>F(Ne),onMouseLeave:()=>F(null),children:Ne}),e.jsxs("span",{className:"min-w-0",children:[e.jsx(zt,{open:c&&(k==null?void 0:k.type)==="start",onOpenChange:h=>{E(h),h||q(null)},selectedTime:(k==null?void 0:k.time)||(t?C(t):0),clipStart:m??null,clipEnd:$??null,clipTranscript:_??null,currentTranscript:i,onSetClipStart:M||(()=>{}),onSetClipEnd:I||(()=>{}),onClearClip:R||(()=>{}),onClipBlock:S?(h,o)=>S(h,o,a,l):void 0,blockStartTime:t?C(t):void 0,blockEndTime:n?C(n):void 0,children:e.jsx("span",{onClick:()=>t&&ge(C(t),"start"),className:"text-sky-700 hover:text-sky-600 underline cursor-pointer",onMouseEnter:()=>F(Ne),onMouseLeave:()=>F(null),children:t})})," --> ",e.jsx(zt,{open:c&&(k==null?void 0:k.type)==="end",onOpenChange:h=>{E(h),h||q(null)},selectedTime:(k==null?void 0:k.time)||(n?C(n):0),clipStart:m??null,clipEnd:$??null,clipTranscript:_??null,currentTranscript:i,onSetClipStart:M||(()=>{}),onSetClipEnd:I||(()=>{}),onClearClip:R||(()=>{}),onClipBlock:S?(h,o)=>S(h,o,a,l):void 0,blockStartTime:t?C(t):void 0,blockEndTime:n?C(n):void 0,children:e.jsx("span",{onClick:()=>n&&ge(C(n),"end"),className:"text-sky-700 hover:text-sky-600 underline cursor-pointer",onMouseEnter:()=>F(Ne),onMouseLeave:()=>F(null),children:n})})]})]})}),e.jsx("div",{className:"flex items-center gap-1 min-w-0",children:e.jsxs("div",{className:"text-muted-foreground text-sm font-mono flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:`text-xs mr-2 flex-shrink-0 text-right w-8 cursor-pointer transition-colors duration-200 ${D===oe||W==="content"?"text-blue-600 hover:text-blue-700":"text-muted-foreground hover:text-blue-500"}`,onClick:()=>X(W==="content"?null:"content"),onMouseEnter:()=>F(oe),onMouseLeave:()=>F(null),children:oe}),e.jsx("div",{className:"text-foreground font-mono text-sm leading-relaxed whitespace-pre-wrap break-words flex-1 min-w-0",dangerouslySetInnerHTML:{__html:le},onMouseEnter:()=>F(oe),onMouseLeave:()=>F(null)})]})}),W&&e.jsx("div",{className:"absolute left-0 top-0 z-10 dropdown-menu-container",children:e.jsxs(Fe,{modal:!1,open:W==="timestamp"||W==="content",onOpenChange:h=>!h&&X(null),children:[e.jsx(He,{asChild:!0,children:e.jsx("div",{className:"invisible"})}),e.jsxs(ze,{align:"start",side:"right",sideOffset:8,children:[e.jsx(ye,{asChild:!0,children:e.jsxs("a",{href:`/api/frame?filename=${encodeURIComponent(l)}&time=${C(t)+(C(n)-C(t))/2}&text=${encodeURIComponent(a)}`,target:"_blank",className:"flex items-center gap-2 w-full",children:[e.jsx(Bn,{size:16,className:"text-[#6d28d9]"}),"View Frame"]})}),e.jsxs(ye,{onClick:()=>ce(),className:"flex items-center gap-2",children:[e.jsx(Ft,{size:16,className:"text-[#3b82f6]"}),"Edit Line"]})]})]})})]})}),a!=null&&!t&&!n&&e.jsx("div",{className:"group",children:e.jsxs("span",{className:"relative",children:[e.jsx("div",{className:"flex items-center gap-1 min-w-0",children:e.jsxs("div",{className:"text-muted-foreground text-sm font-mono flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:`text-xs mr-2 flex-shrink-0 text-right w-8 cursor-pointer transition-colors duration-200 ${D===oe||W==="content"?"text-blue-600 hover:text-blue-700":"text-muted-foreground hover:text-blue-500"}`,onClick:()=>X(W==="content"?null:"content"),onMouseEnter:()=>F(oe),onMouseLeave:()=>F(null),children:oe}),e.jsx("div",{className:"text-foreground font-mono text-sm leading-relaxed whitespace-pre-wrap break-words flex-1 min-w-0",dangerouslySetInnerHTML:{__html:le},onMouseEnter:()=>F(oe),onMouseLeave:()=>F(null)})]})}),W==="content"&&e.jsx("div",{className:"absolute left-0 top-0 z-10 dropdown-menu-container",children:e.jsxs(Fe,{modal:!1,open:!0,onOpenChange:h=>!h&&X(null),children:[e.jsx(He,{asChild:!0,children:e.jsx("div",{className:"invisible"})}),e.jsx(ze,{align:"start",side:"right",sideOffset:8,children:e.jsxs(ye,{onClick:ve,className:"flex items-center gap-2",children:[e.jsx(Ft,{size:16,className:"text-[#3b82f6]"}),"Edit Line"]})})]})})]})}),e.jsx(Mt,{isOpen:O,filename:l,transcriptInitialValue:L,onTranscriptSave:re,onCancel:Ce,isTranscriptSubmitting:z,transcriptTargetLineNumber:oe}),e.jsx(Mt,{isOpen:x,filename:l,transcriptInitialValue:L,onTranscriptSave:Se,onCancel:ue,isTranscriptSubmitting:z,transcriptTargetLineNumber:Ne})]})}),Kt=({visible:t=!1,name:n,fullPath:r,className:a="",searchTerm:i="",text:l="",loading:b=!1,error:w=null,visibleLines:y=[],expandContext:L,onEditSuccess:g,isSmallScreen:f=!1,onSetRightPaneUrl:m,clipStart:$,clipEnd:_,clipTranscript:M,onSetClipStart:I,onSetClipEnd:R,onClearClip:S,onClipBlock:O})=>{const v=d.useRef(null),z=d.useRef(0),V=d.useRef(0),x=c=>{const E=/\d{2}:\d{2}:\d{2}\.\d{3}/g,k=c.match(E);return k&&k.length>=2&&c.includes("-->")?{hasRange:!0,time1:k[0],time2:k[1]}:{hasRange:!1}},p=(c,E)=>{const k=c.split(`
`).flatMap(Y=>Y.split("\r")),q=[],C=i.toLowerCase(),se=E.length===1&&E[0]===-1||E.length===0;for(let Y=0;Y<k.length;Y++){const xe=k[Y],ae=x(xe);if(ae.hasRange&&ae.time1&&ae.time2){const ge=Y<k.length-1?k[Y+1]:"",le=ge.toLowerCase(),ve=i?le.includes(C):!1,re=[Y+1,Y+2],Ce=se||re.some(ce=>E.includes(ce));q.push({startTime:ae.time1,endTime:ae.time2,text:ge,visible:Ce,isSearchResult:ve,originalIndex:q.length,lineNumbers:re}),Y++}else{const ge=xe.toLowerCase(),le=i?ge.includes(C):!1,ve=[Y+1],re=se||ve.some(Ce=>E.includes(Ce));q.push({text:xe,visible:re,isSearchResult:le,originalIndex:q.length,lineNumbers:ve})}}return q};d.useEffect(()=>{v.current&&(V.current=v.current.scrollTop)},[l]);const D=d.useMemo(()=>p(l,y),[l,y,i]);d.useEffect(()=>{v.current&&l.length>z.current&&(v.current.scrollTop=V.current),z.current=l.length},[D]);const F=d.useMemo(()=>{const c=y.length===1&&y[0]===-1;if(y.length===0||c)return D.map(q=>({type:"block",data:q}));const E=[];let k=0;for(let q=0;q<D.length;q++){const C=D[q];if(C.visible){k>0&&(E.push({type:"message",data:{count:k,line:C.lineNumbers[C.lineNumbers.length-1],direction:"up"}}),k=0),E.push({type:"block",data:C});let se=0;for(let Y=q+1;Y<D.length;Y++){const xe=D[Y];if(xe.visible)break;se+=xe.lineNumbers.length}se>0&&E.push({type:"message",data:{count:se,line:C.lineNumbers[C.lineNumbers.length-1],direction:"down"}})}else k+=C.lineNumbers.length}return E},[D,y]),W=d.useMemo(()=>F.map((c,E)=>({...c,virtualIndex:E,originalIndex:E})),[F]),X=(c,E)=>{L(r,E,c)};return t?e.jsx("div",{className:`w-full ${f?"px-4 py-4 bg-transparent":"p-3 sm:p-6 bg-card border border-border"} ${a}`,children:e.jsxs("div",{className:"space-y-4",children:[b&&e.jsx("div",{className:"text-muted-foreground",children:"Loading transcript..."}),w&&e.jsxs("div",{className:"text-destructive",children:["Error: ",w]}),!b&&!w&&e.jsxs("div",{className:"text-muted-foreground text-left relative",children:[i&&D.filter(c=>c.isSearchResult).length===0&&e.jsxs("div",{className:"text-muted-foreground italic",children:['No matches found for "',i,'" in this transcript.']}),D.length>0&&e.jsx("div",{ref:v,className:"space-y-0.5 max-h-[600px] overflow-y-auto",style:{WebkitOverflowScrolling:"touch",scrollBehavior:"smooth"},children:W.map(c=>e.jsx("div",{children:c.type==="block"?e.jsx(Yn,{fullPath:r,startTime:c.data.startTime,endTime:c.data.endTime,visible:c.data.visible,text:c.data.text,name:n,isSearchResult:c.data.isSearchResult,lineNumbers:c.data.lineNumbers,onEditSuccess:g,fullTranscript:l,isSmallScreen:f,onSetRightPaneUrl:m,clipStart:$,clipEnd:_,clipTranscript:M,onSetClipStart:I,onSetClipEnd:R,onClearClip:S,onClipBlock:O}):e.jsx("div",{className:"text-muted-foreground italic",children:e.jsxs("span",{className:"cursor-pointer hover:text-primary hover:underline",onClick:()=>X(c.data.line,c.data.direction),children:["[",c.data.count," lines ",c.data.direction==="up"?"above":"below","]"]})})},c.type==="block"?`${c.data.originalIndex}-${c.virtualIndex}`:`message-${c.virtualIndex}`))})]})]})}):null},bt=u.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:$e("rounded-xl border bg-card text-card-foreground shadow",t),...n}));bt.displayName="Card";const Zt=u.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:$e("flex flex-col space-y-1.5 p-6",t),...n}));Zt.displayName="CardHeader";const Xn=u.forwardRef(({className:t,...n},r)=>e.jsx("h3",{ref:r,className:$e("font-semibold leading-none tracking-tight",t),...n}));Xn.displayName="CardTitle";const Gn=u.forwardRef(({className:t,...n},r)=>e.jsx("p",{ref:r,className:$e("text-sm text-muted-foreground",t),...n}));Gn.displayName="CardDescription";const wt=u.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:$e("p-6 pt-0",t),...n}));wt.displayName="CardContent";const en=u.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:$e("flex items-center p-6 pt-0",t),...n}));en.displayName="CardFooter";function Tt({isOpen:t,videoPath:n,source:r,onClose:a,onRegenerate:i}){var z,V;const[,l]=u.useState([]),[,b]=u.useState([]),[w,y]=u.useState([]),[L,g]=u.useState(""),[f,m]=u.useState(!1),[$,_]=u.useState(null),[M,I]=u.useState(!1),R=x=>{if(!r)return!1;if(x.type==="subtitle"){const p=r.match(/subtitles.*\((\d+)\)/);return!!(p&&parseInt(p[1])===x.subtitle_stream_index)}else if(x.type==="whisper")return r===x.model;return!1};u.useEffect(()=>{t&&n&&S()},[t,n]);const S=async()=>{m(!0),_(null);try{const[x,p]=await Promise.all([fetch(Ve(`/api/video/subtitle-streams?path=${encodeURIComponent(n)}`)),fetch(Ve("/api/models/list"))]);let D=[],F=[];if(x.ok){const c=await x.json();c.success&&(D=c.data)}if(p.ok){const c=await p.json();c.success&&(F=c.data.filter(E=>E.downloaded))}l(D),b(F);const W=[];D.forEach(c=>{const E=c.language||"Unknown",k={id:`subtitle_${c.index}`,type:"subtitle",label:`Subtitles: ${E} (${c.index})`,subtitle_stream_index:c.index};R(k)&&(k.label+=" (last used)"),W.push(k)}),F.forEach(c=>{const E={id:`whisper_${c.name}`,type:"whisper",label:`${c.name}`,model:c.name};R(E)&&(E.label+=" (last used)"),W.push(E)}),y(W);const X=W.find(c=>R(c));g(X?X.id:"")}catch(x){console.error("Error fetching regeneration data:",x),_("Failed to load regeneration options")}finally{m(!1)}},O=async()=>{if(!L)return;const x=w.find(p=>p.id===L);if(x){I(!0);try{await i(x.type==="whisper"?x.model:void 0,x.type==="subtitle"?x.subtitle_stream_index:void 0),a()}catch(p){console.error("Regeneration failed:",p),_("Failed to regenerate transcript")}finally{I(!1)}}},v=()=>{M||a()};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg p-6 w-96 max-w-90vw max-h-80vh overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Regenerate Transcript"}),e.jsx("button",{onClick:v,disabled:M,className:"text-muted-foreground hover:text-foreground disabled:opacity-50",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Choose a processing method for: ",((z=n.split("/").pop())==null?void 0:z.split("\\").pop())||n]}),f&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Loading options..."]})}),$&&e.jsx("div",{className:"text-sm text-destructive mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded",children:$}),!f&&!$&&w.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground mb-4 p-3 bg-muted border border-border rounded",children:"No processing options available. Make sure you have subtitle streams or downloaded Whisper models."}),!f&&!$&&w.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Processing Method:"}),e.jsxs(Fe,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(je,{variant:"outline",className:"w-full justify-between",disabled:M,children:[L&&((V=w.find(x=>x.id===L))==null?void 0:V.label)||"Select a processing method...",e.jsx("svg",{className:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsx(ze,{className:"w-full min-w-[400px]",children:w.map(x=>e.jsxs(ye,{onClick:()=>g(x.id),className:"flex flex-col items-start p-3",children:[e.jsx("div",{className:"font-medium",children:x.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:x.type==="subtitle"?"Extract from embedded subtitles":"AI transcription"})]},x.id))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:v,disabled:M,className:"px-4 py-2 text-sm border border-input bg-background text-foreground rounded hover:bg-accent focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:M||!L,className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:M?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerating..."]}):"Regenerate"})]})]})]})}):null}function Qn({file:t,onExpand:n,isExpanded:r,isRegenerating:a,isReplacing:i,isProcessing:l,onRegenerate:b,onReplace:w,onRename:y,onRegenerateMeta:L,formatDate:g,getSourceChipColor:f,isSmallScreen:m=!1,mobileTranscriptRowRefs:$}){var v;const[_,M]=u.useState(!1),I=((v=t.name.split("/").pop())==null?void 0:v.split("\\").pop())||t.name,R=z=>{z.stopPropagation(),M(!0)},S=async(z,V)=>{await b({stopPropagation:()=>{}},z,V)};if(m){const z=e.jsxs("div",{className:"w-full bg-background py-4 px-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1 mr-2 min-w-0 text-left",id:"ref",ref:V=>{$.current[t.base_name]=V},children:[e.jsx("h3",{className:"font-medium text-base break-all overflow-hidden text-left",title:t.name,children:I}),t.source&&e.jsx("div",{className:"text-left",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2 ${f(t.source)}`,children:t.source})})]}),e.jsxs(Fe,{modal:!1,children:[e.jsx(He,{asChild:!0,children:e.jsx("button",{onClick:V=>V.stopPropagation(),className:"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Actions",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(ze,{align:"end",children:[e.jsxs(ye,{onClick:V=>y(V),disabled:l||a||i,children:[e.jsx("span",{children:"Rename"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})]}),t.transcript&&e.jsxs(ye,{onClick:V=>w(V),disabled:i,className:"text-blue-600 hover:text-blue-700",children:[e.jsx("span",{children:"Edit transcript"}),!i&&e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})]}),t.transcript&&e.jsxs(ye,{onClick:R,disabled:a,className:"text-green-600 hover:text-green-700",children:[e.jsx("span",{children:"Regenerate transcript"}),a?e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),l&&e.jsxs(ye,{disabled:!0,children:[e.jsx("span",{children:"Processing transcript..."}),e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]})]})]})]}),e.jsx("div",{className:"space-y-3 mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Date:"}),e.jsx("div",{className:"font-medium break-words text-xs",children:g(t.created_at)})]}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Last Generated:"}),e.jsx("div",{className:"font-medium break-words text-xs",children:g(t.last_generated||"")})]}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Lines:"}),e.jsx("div",{className:"font-medium text-xs",children:t.line_count||0})]}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Length:"}),e.jsx("div",{className:"font-medium flex items-center gap-1 text-xs",children:t.length?t.length:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"-"}),e.jsx("button",{onClick:V=>L(V),disabled:a,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate video length",children:a?e.jsx("svg",{className:"w-3 h-3 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]})]})}),t.transcript&&e.jsx("button",{onClick:n,className:"w-full px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),"Hide Transcript"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Show Transcript"]})})]});return e.jsxs(e.Fragment,{children:[z,e.jsx(Tt,{isOpen:_,videoPath:t.full_path||t.name,source:t.source,onClose:()=>M(!1),onRegenerate:S})]})}const O=e.jsxs(bt,{className:"w-full",children:[e.jsx(Zt,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 mr-2 min-w-0",children:[e.jsx("h3",{className:"font-medium text-base break-all overflow-hidden",title:t.name,children:I}),t.source&&e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2 ${f(t.source)}`,children:t.source})]}),e.jsxs(Fe,{modal:!1,children:[e.jsx(He,{asChild:!0,children:e.jsx("button",{onClick:z=>z.stopPropagation(),className:"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Actions",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(ze,{align:"end",children:[e.jsxs(ye,{onClick:z=>y(z),disabled:l||a||i,children:[e.jsx("span",{children:"Rename"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})]}),t.transcript&&e.jsxs(ye,{onClick:z=>w(z),disabled:i,className:"text-blue-600 hover:text-blue-700",children:[e.jsx("span",{children:"Edit transcript"}),!i&&e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})]}),t.transcript&&e.jsxs(ye,{onClick:R,disabled:a,className:"text-green-600 hover:text-green-700",children:[e.jsx("span",{children:"Regenerate transcript"}),a?e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),l&&e.jsxs(ye,{disabled:!0,children:[e.jsx("span",{children:"Processing transcript..."}),e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]})]})]})]})}),e.jsx(wt,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"}),e.jsx("div",{className:"font-medium break-words",children:g(t.created_at)})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Generated:"}),e.jsx("div",{className:"font-medium break-words",children:g(t.last_generated||"")})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Lines:"}),e.jsx("div",{className:"font-medium",children:t.line_count||0})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Length:"}),e.jsx("div",{className:"font-medium flex items-center justify-center gap-1",children:t.length?t.length:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"-"}),e.jsx("button",{onClick:z=>L(z),disabled:a,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate video length",children:a?e.jsx("svg",{className:"w-3 h-3 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]})]})}),t.transcript&&e.jsx(en,{className:"pt-3",children:e.jsx("button",{onClick:n,className:"w-full px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),"Hide Transcript"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Show Transcript"]})})})]});return e.jsxs(e.Fragment,{children:[O,e.jsx(Tt,{isOpen:_,videoPath:t.full_path||t.name,source:t.source,onClose:()=>M(!1),onRegenerate:S})]})}function Jn({sortedFiles:t,activeSearchTerm:n,searchResults:r,showAllFiles:a,transcriptData:i,expandedFiles:l,searchLineNumbers:b,onExpandFile:w,onRegenerate:y,onReplace:L,onRename:g,onFetchTranscript:f,onSetRightPaneUrl:m,formatDate:$,getSourceChipColor:_,expandContext:M,clipStart:I,clipEnd:R,clipTranscript:S,onSetClipStart:O,onSetClipEnd:v,onClearClip:z,onClipBlock:V,mobileTranscriptRowRefs:x}){return e.jsx("div",{className:"divide-y divide-border",children:t.map(p=>{if(!(n?r.includes(p.full_path):a))return null;const F=i[p.full_path]||{text:"",loading:!1,error:null},W=l.has(p.full_path);return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{id:"ref",children:e.jsx(Qn,{file:p,onExpand:()=>w(p.full_path),isExpanded:W,isRegenerating:!p.transcript,isReplacing:!p.transcript,isProcessing:!1,onRegenerate:X=>y(p.full_path,p.source,X),onReplace:X=>L(p.full_path,X),onRename:X=>g(p.full_path,X),onRegenerateMeta:X=>y(p.full_path,p.source,X),formatDate:$,getSourceChipColor:_,isSmallScreen:!0,mobileTranscriptRowRefs:x})}),W&&e.jsx(Kt,{visible:!0,name:p.base_name,fullPath:p.full_path,className:"w-full",searchTerm:n,text:F.text,loading:F.loading,error:F.error,visibleLines:b[p.full_path]||[],expandContext:M,onEditSuccess:()=>{f(p.full_path)},isSmallScreen:!0,onSetRightPaneUrl:m,clipStart:I,clipEnd:R,clipTranscript:S,onSetClipStart:X=>O(X,p.full_path),onSetClipEnd:X=>v(X,p.full_path),onClearClip:z,onClipBlock:V})]},p.base_name)})})}function Kn({watchDirectory:t,isSmallScreen:n,activeSearchTerm:r,searchLineNumbers:a,setSearchLineNumbers:i,expandedFiles:l,setExpandedFiles:b,currentProcessingFile:w,showAllFiles:y,leftPaneWidth:L,setLeftPaneWidth:g,isLeftPaneWidthMeasured:f,setIsLeftPaneWidthMeasured:m,clipStart:$,clipEnd:_,clipTranscript:M,fileRowRefs:I,transcriptRowRefs:R,mobileTranscriptRowRefs:S,leftPaneRef:O,onSetRightPaneUrl:v,onSetClipStart:z,onSetClipEnd:V,onClearClip:x,onClipBlock:p}){var At;const{files:D,refreshFiles:F,selectedWatchDirs:W,setSelectedWatchDirs:X,availableWatchDirs:c,selectedSources:E,setSelectedSources:k,availableSources:q,page:C,setPage:se,pageSize:Y,setPageSize:xe,sortColumn:ae,setSortColumn:ge,sortDirection:le,setSortDirection:ve,totalPages:re,totalRecords:Ce,transcriptData:ce,fetchTranscript:Se}=Qt(),[ue,Ne]=u.useState(!1),[oe,N]=u.useState(!1),[h,o]=u.useState(""),[U,Q]=u.useState(""),[de,ne]=u.useState(!1),[Pe,Re]=u.useState(!1),[Ae,Ke]=u.useState(""),[Ee,Xe]=u.useState(""),[Me,Ze]=u.useState(!1),[st,Te]=u.useState(""),[ot,et]=u.useState(!1),[Le,De]=u.useState(""),[We,Oe]=u.useState(void 0),it=s=>{var j;return w?((j=w.video_path.split("/").pop())==null?void 0:j.replace(/\.(mp4|MP4)$/,""))===s:!1},Be=Object.keys(a).filter(s=>a[s]&&a[s].length>0),Ie=n||f&&L<753;u.useEffect(()=>{if(!O.current)return;const s=new ResizeObserver(P=>{for(const j of P)g(j.contentRect.width),m(!0)});return s.observe(O.current),()=>{s.disconnect()}},[g,m]),u.useEffect(()=>{T()},[l]);const qe=[...D].sort((s,P)=>{let j,B;switch(ae){case"created_at":j=s.created_at||"",B=P.created_at||"";break;case"last_generated":j=s.last_generated||"",B=P.last_generated||"";break;case"name":j=s.name||"",B=P.name||"";break;case"line_count":j=s.line_count||0,B=P.line_count||0;break;case"length":j=s.length||"0:00",B=P.length||"0:00";break;case"source":j=s.source||"",B=P.source||"";break;default:return 0}if(ae==="created_at"||ae==="last_generated"){const A=new Date(j.replace(" ","T")).getTime(),Z=new Date(B.replace(" ","T")).getTime();return le==="asc"?A-Z:Z-A}return typeof j=="string"&&typeof B=="string"?le==="asc"?j.localeCompare(B):B.localeCompare(j):le==="asc"?j-B:B-j}),H=(s,P,j)=>{const B=a[s];if(!B)return;const A=[...B];if(P==="up")for(let Z=1;Z<=16;Z++){const J=j-Z;J>0&&!A.includes(J)&&A.push(J)}else for(let Z=1;Z<=16;Z++){const J=j+Z;A.includes(J)||A.push(J)}i(Z=>({...Z,[s]:A}))},ee=s=>{ae===s?ve(P=>P==="asc"?"desc":"asc"):(ge(s),ve("asc"))},te=s=>ae!==s?e.jsx("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):le==="asc"?e.jsx("svg",{className:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{className:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),K=s=>{if(!s)return"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300";const P={tiny:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",base:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",small:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",medium:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",large:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",subtitles:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",manual:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200"};for(const[j,B]of Object.entries(P))if(s.includes(j))return B;return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"},ie=(s,P=!0)=>{if(!s||s==="N/A")return"N/A";try{const j=new Date(s.replace(" ","T"));if(isNaN(j.getTime()))return"N/A";const B=(j.getMonth()+1).toString().padStart(2,"0"),A=j.getDate().toString().padStart(2,"0"),Z=j.getFullYear();if(!P)return`${B}-${A}-${Z}`;let J=j.getHours();const Ue=j.getMinutes().toString().padStart(2,"0"),ct=J>=12?"pm":"am";return J=J%12,J=J||12,`${B}-${A}-${Z} ${J}:${Ue}${ct}`}catch{return"N/A"}},T=async()=>{const P=Array.from(l).filter(j=>{const B=ce[j];return!B||!B.loading&&!B.text&&!B.error});await Promise.all(P.map(j=>Se(j)))},G=(s,P,j)=>{j.stopPropagation(),De(s),Oe(P),et(!0)},pe=async(s,P)=>{await be(Le,{stopPropagation:()=>{}},s,P)},be=async(s,P,j,B)=>{var Z;P.stopPropagation();const A=(Z=document.querySelector('meta[name="csrf-token"]'))==null?void 0:Z.getAttribute("content");try{const J={video_path:s};j&&(J.model=j),B!==void 0&&(J.subtitle_stream_index=B);const Ue=await fetch(Ve("/api/transcripts/regenerate"),{method:"POST",headers:{"X-CSRF-Token":A||"","Content-Type":"application/json"},body:JSON.stringify(J)});if(Ue.ok)await F();else{const ct=await Ue.json().catch(()=>({error:"Unknown error"}));console.error("Failed to regenerate transcript:",ct.error),alert(`Failed to regenerate transcript: ${ct.error}`)}}catch(J){console.error("Regeneration error:",J),alert("Error regenerating transcript. Please try again.")}},_e=async(s,P)=>{P.stopPropagation();try{const j=await fetch(Ve(`/api/transcripts?video_path=${encodeURIComponent(s)}`));if(j.ok){const B=await j.json();if(B.success){const A=B.data;o(s),Q(A),N(!0)}else throw new Error(B.error)}else throw new Error("Failed to fetch transcript")}catch(j){console.error("Error fetching transcript for replacement:",j),alert("Error loading transcript. Please try again.")}finally{}},me=async s=>{var P;ne(!0);try{const j=(P=document.querySelector('meta[name="csrf-token"]'))==null?void 0:P.getAttribute("content"),B=await fetch(Ve("/api/transcripts/replace"),{method:"POST",headers:{"X-CSRF-Token":j||"","Content-Type":"application/json"},body:JSON.stringify({video_path:h,new_content:s})});if(B.ok)N(!1),o(""),Q(""),l.has(h)&&await Se(h),await F();else{const A=await B.json().catch(()=>({error:"Unknown error"}));console.error("Failed to replace transcript:",A.error),alert(`Failed to replace transcript: ${A.error}`)}}catch(j){console.error("Replace transcript error:",j),alert("Error replacing transcript. Please try again.")}finally{ne(!1)}},he=()=>{N(!1),o(""),Q("")},Ye=async(s,P)=>{var B;P.stopPropagation();const j=((B=s.split("/").pop())==null?void 0:B.split("\\").pop())||s;Ke(s),Xe(j),Te(""),Re(!0),setTimeout(()=>{const A=document.getElementById("new-filename");A&&A.select()},100)},tt=async()=>{var P,j;if(!Ee.trim()){Te("Filename cannot be empty");return}const s=((P=Ae.split("/").pop())==null?void 0:P.split("\\").pop())||Ae;if(Ee===s){Te("New filename must be different from current filename");return}if(/[\/\\]/.test(Ee)){Te("Filename cannot contain path separators");return}Ze(!0),Te("");try{const B=(j=document.querySelector('meta[name="csrf-token"]'))==null?void 0:j.getAttribute("content"),A=Ae.split("/");A[A.length-1]=Ee.trim();const Z=A.join("/"),J=await fetch(Ve("/api/transcripts/rename"),{method:"POST",headers:{"X-CSRF-Token":B||"","Content-Type":"application/json"},body:JSON.stringify({video_path:Ae,new_path:Z})});if(!J.ok){const Ue=await J.json();throw new Error(Ue.error||`Failed to rename file: ${J.status} ${J.statusText}`)}Re(!1),Ke(""),Xe(""),await F()}catch(B){console.error("Error renaming file:",B),Te(B instanceof Error?B.message:"An error occurred while renaming the file")}finally{Ze(!1)}},Pt=()=>{Re(!1),Ke(""),Xe(""),Te("")},hn=s=>{X(P=>P.includes(s)?P.filter(B=>B!==s):[...P,s])},pn=()=>{X(c)},xn=()=>{X([])},gn=s=>{k(P=>P.includes(s)?P.filter(B=>B!==s):[...P,s])},vn=()=>{k(q)},bn=()=>{k([])},lt=s=>{se(s)},wn=s=>{xe(s),se(0)},jn=({className:s=""})=>{if(!y||re<=1)return null;const P=C*Y+1,j=Math.min((C+1)*Y,Ce);return e.jsxs("div",{className:`flex flex-col sm:flex-row items-center gap-2 sm:gap-4 p-4 border-t border-border bg-background ${s}`,children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"hidden sm:inline",children:"Show"}),e.jsxs("select",{value:Y,onChange:B=>wn(Number(B.target.value)),className:"border border-border rounded px-2 py-1 bg-background text-xs sm:text-sm",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{className:"hidden sm:inline",children:"per page"})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-muted-foreground",children:e.jsxs("span",{children:[P,"-",j," of ",Ce]})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>lt(0),disabled:C===0,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-border rounded hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"First"}),e.jsx("span",{className:"sm:hidden",children:""})]}),e.jsxs("button",{onClick:()=>lt(C-1),disabled:C===0,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-border rounded hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"Previous"}),e.jsx("span",{className:"sm:hidden",children:""})]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(Ie?3:5,re)},(B,A)=>{let Z;const J=Ie?3:5;return re<=J||C<Math.floor(J/2)?Z=A:C>=re-Math.floor(J/2)?Z=re-J+A:Z=C-Math.floor(J/2)+A,e.jsx("button",{onClick:()=>lt(Z),className:`px-2 sm:px-3 py-1 text-xs sm:text-sm border border-border rounded hover:bg-accent min-w-0 ${Z===C?"bg-primary text-primary-foreground":""}`,children:Z+1},Z)})}),e.jsxs("button",{onClick:()=>lt(C+1),disabled:C>=re-1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-border rounded hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"Next"}),e.jsx("span",{className:"sm:hidden",children:""})]}),e.jsxs("button",{onClick:()=>lt(re-1),disabled:C>=re-1,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border border-border rounded hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"hidden sm:inline",children:"Last"}),e.jsx("span",{className:"sm:hidden",children:""})]})]})]})},yn=s=>{b(P=>{const j=new Set(P);return j.has(s)?j.delete(s):j.add(s),j})},kn=async()=>{var Z;const s=qe.filter(J=>r&&!Be.includes(J.full_path)?!1:J.transcript);if(s.length===0){alert("No files with transcripts to regenerate");return}const P=E[0],j=s.length,B=`Regenerate ${j} file${j===1?"":"s"} using "${P}" source?`;if(!confirm(B))return;Ne(!0);const A=(Z=document.querySelector('meta[name="csrf-token"]'))==null?void 0:Z.getAttribute("content");try{let J=0,Ue=0;(await Promise.allSettled(s.map(async at=>{const Bt=await fetch(Ve("/api/transcripts/regenerate"),{method:"POST",headers:{"X-CSRF-Token":A||"","Content-Type":"application/json"},body:JSON.stringify({video_path:at.full_path})});if(!Bt.ok){const Nn=await Bt.json().catch(()=>({error:"Unknown error"}));throw new Error(`${at.full_path}: ${Nn.error}`)}return at.full_path}))).forEach(at=>{at.status==="fulfilled"?J++:(Ue++,console.error("Bulk regeneration error:",at.reason))}),Ue>0?alert(`Bulk regeneration completed with ${J} successes and ${Ue} errors. Check console for details.`):alert(`Successfully queued ${J} files for regeneration`)}catch(J){console.error("Bulk regeneration error:",J),alert("Error during bulk regeneration. Please try again.")}finally{Ne(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:O,className:`${`w-full overflow-y-auto scrollbar-hide px-2 sm:px-4 ${t?n?"pt-24 pb-4":"pt-16 pb-4":"py-10"}`}`,children:[(c.length>1||q.length>1)&&e.jsxs("div",{className:`mb-6 flex items-center gap-4 ${Ie?"px-4":""}`,children:[c.length>1&&e.jsxs(Fe,{modal:!1,children:[e.jsx(He,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[W.length===c.length||W.length===0?"All Directories":`${W.length} Director${W.length===1?"y":"ies"}`,e.jsx("svg",{className:"ml-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(ze,{align:"start",className:"w-80",children:[e.jsx(vt,{children:"Watch Directories"}),e.jsx(Qe,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Je,{checked:W.length===c.length,onCheckedChange:s=>{s?pn():xn()},className:"font-medium",children:"Select All"}),e.jsx(Qe,{}),c.map(s=>e.jsx(Je,{checked:W.includes(s),onCheckedChange:()=>hn(s),children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium text-sm",children:s.split("/").pop()||s}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s})]})},s))]})]})]}),q.length>1&&e.jsxs(Fe,{modal:!1,children:[e.jsx(He,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[E.length===q.length||E.length===0?"All Transcript Sources":`${E.length} Source${E.length===1?"":"s"}`,e.jsx("svg",{className:"ml-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(ze,{align:"start",className:"w-80",children:[e.jsx(vt,{children:"Sources"}),e.jsx(Qe,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Je,{checked:E.length===q.length,onCheckedChange:s=>{s?vn():bn()},className:"font-medium",children:"Select All"}),e.jsx(Qe,{}),q.map(s=>e.jsx(Je,{checked:E.includes(s),onCheckedChange:()=>gn(s),children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${K(s)}`,children:s})})},s))]})]})]})]}),E.length===1&&e.jsxs("div",{className:`mb-6 flex items-center justify-between ${Ie?"px-4":""}`,children:[e.jsx("button",{onClick:kn,disabled:ue,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:ue?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerate All (",E[0],")"]})}),e.jsx("span",{className:"text-sm text-muted-foreground",children:(()=>{const s=qe.filter(P=>r&&!Be.includes(P.full_path)?!1:P.transcript);return`${s.length} file${s.length===1?"":"s"} with transcripts`})()})]}),e.jsxs("div",{children:[Be.length>0&&e.jsx("div",{className:`mb-6 p-4 bg-accent/10 border border-accent/20 rounded-md ${Ie?"mx-4":""}`,children:e.jsxs("h3",{className:"text-sm font-medium text-accent-foreground mb-2",children:["Found in ",Be.length," file(s)"]})}),r&&Be.length===0&&e.jsx("div",{className:`mb-6 p-4 bg-muted border border-border rounded-md ${Ie?"mx-4":""}`,children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:['No files found containing "',r,'"']})}),!r&&!y&&e.jsx("div",{className:`mb-6 p-4 bg-muted border border-border rounded-md ${Ie?"mx-4":""}`,children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Search to get started!"})}),!n&&!f?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})}):Ie?e.jsx(Jn,{sortedFiles:qe,activeSearchTerm:r,searchResults:Be,showAllFiles:y,transcriptData:ce,expandedFiles:l,searchLineNumbers:a,onExpandFile:s=>{const P=qe.find(j=>j.full_path===s);P!=null&&P.transcript&&yn(s)},onRegenerate:G,onReplace:_e,onRename:Ye,onFetchTranscript:Se,onSetRightPaneUrl:v,formatDate:s=>ie(s,L>=1129),getSourceChipColor:K,expandContext:H,clipStart:$,clipEnd:_,clipTranscript:M,onSetClipStart:z,onSetClipEnd:V,onClearClip:x,onClipBlock:p,mobileTranscriptRowRefs:S}):e.jsxs(Dn,{className:"table-fixed w-full",children:[e.jsx(On,{children:e.jsxs(jt,{children:[e.jsxs(nt,{className:"text-center w-[34%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>ee("name"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Filename",te("name")]}),r&&Be.length>0&&e.jsx("span",{className:"text-xs text-primary ml-2",children:"(Search Results)"})]}),e.jsx(nt,{className:"text-center w-[14%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>ee("created_at"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Date",te("created_at")]})}),e.jsx(nt,{className:"text-center w-[14%] pl-6 cursor-pointer hover:bg-accent transition-colors",onClick:()=>ee("last_generated"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Generated",te("last_generated")]})}),e.jsx(nt,{className:"text-center w-[10%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>ee("line_count"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Lines",te("line_count")]})}),e.jsx(nt,{className:"text-center w-[10%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>ee("length"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Length",te("length")]})}),e.jsx(nt,{className:"text-center w-[8%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>ee("source"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Source",te("source")]})}),e.jsx(nt,{className:"text-center w-[10%]",children:"Actions"})]})}),e.jsx(Pn,{children:qe.map(s=>{var B;if(!(r?Be.includes(s.full_path):y))return e.jsx(e.Fragment,{});const j=ce[s.full_path]||{text:"",loading:!1,error:null};return e.jsxs(e.Fragment,{children:[e.jsxs(jt,{ref:A=>{I.current[s.full_path]=A},"data-filename":s.full_path,className:"",onClick:()=>{s.transcript&&b(A=>{const Z=new Set(A);return Z.has(s.full_path)?Z.delete(s.full_path):Z.add(s.full_path),Z})},children:[e.jsx(Ge,{className:"font-medium w-[34%] max-w-0",children:e.jsx("div",{className:"leading-tight overflow-hidden whitespace-nowrap text-ellipsis",style:{direction:"rtl",textAlign:"left",unicodeBidi:"plaintext",fontSize:(()=>{var J;const Z=(((J=s.name.split("/").pop())==null?void 0:J.split("\\").pop())||s.name).length;return Z<=15?"14px":Z<=20?"13px":"12px"})()},title:s.name,children:((B=s.name.split("/").pop())==null?void 0:B.split("\\").pop())||s.name})}),e.jsx(Ge,{className:"w-[14%] pr-10 text-foreground",children:ie(s.created_at,L>=1129)}),e.jsx(Ge,{className:"w-[14%] text-center text-foreground",children:ie(s.last_generated||"",L>=1129)}),e.jsx(Ge,{className:"w-[10%] text-foreground",children:s.line_count||0}),e.jsx(Ge,{className:"w-[10%] text-foreground",children:s.length?s.length:e.jsx("button",{onClick:A=>be(s.full_path,A),disabled:!s.transcript,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate video length",children:s.transcript?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})}),e.jsx(Ge,{className:"w-[8%] text-center",children:s.source?L>=1129?e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{className:`inline-flex items-center rounded-full font-medium ${K(s.source)} ${s.source.length>10?"px-1.5 py-0.5 text-xs scale-75":"px-2.5 py-0.5 text-xs"}`,children:s.source})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${K(s.source).split(" ").find(A=>A.startsWith("bg-"))||"bg-gray-200"} ${K(s.source).split(" ").find(A=>A.startsWith("dark:bg-"))||""}`,title:s.source})}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(Ge,{className:"w-[10%] text-center p-2",children:e.jsxs(Fe,{modal:!1,children:[e.jsx(He,{asChild:!0,children:e.jsx("button",{onClick:A=>A.stopPropagation(),className:"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Actions",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(ze,{align:"end",children:[e.jsxs(ye,{onClick:A=>Ye(s.full_path,A),disabled:!s.transcript,children:[e.jsx("span",{children:"Rename"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})]}),s.transcript&&e.jsxs(ye,{onClick:A=>_e(s.full_path,A),disabled:!s.transcript,className:"text-blue-600 hover:text-blue-700",children:[e.jsx("span",{children:"Edit transcript"}),!s.transcript&&e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})]}),s.transcript&&e.jsxs(ye,{onClick:A=>G(s.full_path,s.source,A),disabled:!s.transcript,className:"text-green-600 hover:text-green-700",children:[e.jsx("span",{children:"Regenerate transcript"}),s.transcript?e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),it(s.full_path)&&e.jsxs(ye,{disabled:!0,children:[e.jsx("span",{children:"Processing transcript..."}),e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]})]})]})})]},s.full_path),e.jsx(jt,{ref:A=>{R.current[s.full_path]=A},"data-filename":s.full_path,children:e.jsx(Ge,{colSpan:7,className:"p-0",children:e.jsx(Kt,{visible:l.has(s.full_path),name:s.base_name,fullPath:s.full_path,className:"w-full",searchTerm:r,text:j.text,loading:j.loading,error:j.error,visibleLines:a[s.full_path]||[],expandContext:H,onEditSuccess:()=>{Se(s.full_path)},onSetRightPaneUrl:v,clipStart:$,clipEnd:_,clipTranscript:M,onSetClipStart:A=>z(A,s.full_path),onSetClipEnd:A=>V(A,s.full_path),onClearClip:x,onClipBlock:p})})})]})})})]})]}),e.jsx(jn,{})]}),e.jsx(Mt,{isOpen:oe,filename:h,transcriptInitialValue:U,onTranscriptSave:me,onCancel:he,isTranscriptSubmitting:de}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg p-6 w-96 max-w-90vw",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Rename File"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:['Renaming "',((At=Ae.split("/").pop())==null?void 0:At.split("\\").pop())||Ae,'" (this will rename the video, transcript, and meta files)']}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-filename",className:"block text-sm font-medium mb-2",children:"New filename (without extension):"}),e.jsx("input",{id:"new-filename",type:"text",value:Ee,onChange:s=>Xe(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!Me&&Ee.trim()?tt():s.key==="Escape"&&Pt()},className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded focus:outline-none focus:ring-1 focus:ring-ring focus:border-transparent",placeholder:"Enter new filename",disabled:Me,autoFocus:!0})]}),st&&e.jsx("div",{className:"text-sm text-destructive",children:st}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:Pt,className:"px-4 py-2 text-sm border border-input bg-background text-foreground rounded hover:bg-accent focus:outline-none focus:ring-1 focus:ring-ring",disabled:Me,children:"Cancel"}),e.jsx("button",{onClick:tt,className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed",disabled:Me||!Ee.trim(),children:Me?"Renaming...":"Rename"})]})]})]})}),e.jsx(Tt,{isOpen:ot,videoPath:Le,source:We,onClose:()=>et(!1),onRegenerate:pe})]})}function Zn(){return e.jsx("div",{className:"w-full h-full flex items-center justify-center p-8 bg-background",children:e.jsxs("div",{className:"text-center text-foreground",children:[e.jsx("div",{className:"mb-6",children:e.jsx("svg",{className:"w-16 h-16 mx-auto text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("h3",{className:"text-xl font-medium mb-3 text-foreground",children:"Clip Editor"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"Click on any timestamp in a transcript to open the clip editor and create video clips from specific moments."})]})})}const gt=u.forwardRef(({className:t,type:n,...r},a)=>e.jsx("input",{type:n,className:$e("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...r}));gt.displayName="Input";const tn=u.forwardRef(({className:t,...n},r)=>e.jsx("textarea",{className:$e("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n}));tn.displayName="Textarea";function er({className:t,...n}){return e.jsx(Sn,{"data-slot":"checkbox",className:$e("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(Rn,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(In,{className:"size-3.5"})})})}const Wt=({buttons:t})=>{const n=t.reduce((a,i,l)=>{const b=i.group??0;return a[b]||(a[b]=[]),a[b].push({...i,originalIndex:l}),a},{}),r=Object.keys(n).map(Number).sort((a,i)=>a-i);return e.jsx("div",{className:"mt-2 space-y-3",children:r.map(a=>e.jsx("div",{className:"flex items-center gap-2 justify-center flex-wrap",children:n[a].map(i=>e.jsx(je,{variant:"outline",size:"sm",onClick:i.onClick,className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:i.color?{borderColor:i.color,color:i.color}:void 0,children:i.text},i.originalIndex))},a))})},dt=({filename:t,clip_url:n,start_time_formatted:r="00:00:00.000",end_time_formatted:a="00:00:10.000",font_size:i="",text:l="",display_text:b=!1,onBack:w,onStartTimeChange:y,onEndTimeChange:L})=>{const[g,f]=u.useState(r),[m,$]=u.useState(a),[_,M]=u.useState(i),[I,R]=u.useState(l),[S,O]=u.useState(b),[v,z]=u.useState(!1),[V,x]=u.useState(n||""),[p,D]=u.useState(!1),[F,W]=u.useState(!1),[X]=u.useState(t),[c,E]=u.useState({}),[k,q]=u.useState("video"),C=u.useRef(null),se=u.useRef(null),Y=N=>{const h=N.split(":"),o=parseInt(h[0],10),U=parseInt(h[1],10),Q=parseFloat(h[2]);return o*3600+U*60+Q},xe=N=>{N=Math.max(0,N);const h=Math.floor(N/3600),o=Math.floor(N%3600/60),U=N%60;return`${h.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${U.toFixed(3).padStart(6,"0")}`},ae=N=>/^(\d{2}):(\d{2}):(\d{2})\.(\d{3})$/.test(N),ge=(N="mp4")=>{if(!g||!m||!ae(g)||!ae(m))return"";const h=Y(g),o=Y(m);if(h<0||o<=h)return"";const U=new URLSearchParams({filename:t,start_time:h.toString(),end_time:o.toString(),format:N,cachebuster:Date.now().toString()});return I&&I.trim()!==""&&U.set("text",I),_&&_.trim()!==""&&U.set("font_size",_),S&&U.set("display_text","true"),"/api/clip?"+U.toString()},le=N=>{let h=`${X}_clip_start_${g}_end_${m}.${N}`;if(I&&I.trim()!==""){const o=I.trim().substring(0,50).replace(/[^a-zA-Z0-9\s\-_]/g,"").replace(/\s+/g,"_");o&&(h=o+`.${N}`)}return h},ve=async N=>{const h=ge(N),o=le(N);E(U=>({...U,[N]:!0}));try{const U=await fetch(h);if(!U.ok)throw new Error(`Failed to download file: ${U.statusText}`);const Q=await U.blob(),de={mp4:"video/mp4",gif:"image/gif",mp3:"audio/mpeg"},ne=new File([Q],o,{type:de[N]||"application/octet-stream"});await navigator.share({files:[ne]})}catch(U){console.error("Error sharing:",U);try{await navigator.share({title:`Clip from ${o}`,url:window.location.origin+h})}catch(Q){console.error("Error with fallback sharing:",Q)}}finally{E(U=>({...U,[N]:!1}))}},re=(N,h,o,U)=>{if(!ae(N))return;const de=Y(N)+h,ne=xe(de);o(ne),U&&U(de)},Ce=(N,h,o)=>[{text:"+1s",onClick:()=>re(N,1,h,o),color:"#22c55e",group:0},{text:"+0.5s",onClick:()=>re(N,.5,h,o),color:"#22c55e",group:0},{text:"+0.1s",onClick:()=>re(N,.1,h,o),color:"#22c55e",group:0},{text:"+0.01s",onClick:()=>re(N,.01,h,o),color:"#22c55e",group:0},{text:"-1s",onClick:()=>re(N,-1,h,o),color:"#ef4444",group:1},{text:"-0.5s",onClick:()=>re(N,-.5,h,o),color:"#ef4444",group:1},{text:"-0.1s",onClick:()=>re(N,-.1,h,o),color:"#ef4444",group:1},{text:"-0.01s",onClick:()=>re(N,-.01,h,o),color:"#ef4444",group:1}],ce=()=>{if(!ae(g)||!ae(m))return;const N=Y(g),h=Y(m);if(N<0||h<=N)return;const o=ge(k==="video"?"mp4":"gif");o&&x(o)};u.useEffect(()=>{var N;V&&((N=C.current)==null||N.load())},[V]);const Se=()=>{se.current&&clearTimeout(se.current),se.current=setTimeout(ce,500)},ue=()=>{z(!1),C.current&&window.scrollTo({top:0,behavior:"smooth"})},Ne=()=>{z(!1),window.scrollTo({top:0,behavior:"smooth"})},oe=(N,h,o)=>{if(h(N),ae(N)&&o){const U=Y(N);o(U)}};return u.useEffect(()=>{M(i),R(l),O(b),x(n||"")},[i,l,b,n]),u.useEffect(()=>{f(r)},[r]),u.useEffect(()=>{$(a)},[a]),u.useEffect(()=>{ae(g)&&ae(m)&&ce()},[g,m,k,I,_,S]),u.useEffect(()=>{W(typeof navigator.share=="function")},[]),u.useEffect(()=>(ce(),()=>{se.current&&clearTimeout(se.current)}),[t,r,a]),e.jsxs("div",{className:"container max-w-6xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:t}),w&&e.jsxs("button",{onClick:w,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(Fn,{className:"h-4 w-4"}),"Close"]})]}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("div",{className:"text-lg font-medium text-muted-foreground",children:[g," to ",m]})}),e.jsx(bt,{className:"relative overflow-hidden bg-black",children:e.jsxs(wt,{className:"p-0",children:[v&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center min-h-[300px] bg-black/95 backdrop-blur-sm z-10",children:[e.jsx("div",{className:"w-12 h-12 border-3 border-muted border-t-primary rounded-full animate-spin mb-6"}),e.jsx("div",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Processing..."}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Generating your clip, please wait"})]}),V&&e.jsx(e.Fragment,{children:k==="video"?e.jsxs("video",{ref:C,controls:!0,autoPlay:!0,playsInline:!0,className:"w-full h-auto block",onLoadedData:ue,onError:Ne,children:[e.jsx("source",{src:V,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsx("img",{src:V,alt:"Clip preview",className:"w-full h-auto block",onLoad:ue,onError:Ne})})]})}),e.jsx(bt,{children:e.jsxs(wt,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-start",children:e.jsxs(je,{onClick:ce,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Hn,{className:"h-4 w-4"}),"Regenerate"]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"start_time",className:"text-sm font-medium",children:"Start Time (hh:mm:ss.sss)"}),e.jsx(gt,{id:"start_time",type:"text",value:g,onChange:N=>oe(N.target.value,f,y),pattern:"^(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d{3})$",placeholder:"00:00:00.000",className:"font-mono text-xs tracking-wider",required:!0}),p&&e.jsx(Wt,{buttons:Ce(g,f,y)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"end_time",className:"text-sm font-medium",children:"End Time (hh:mm:ss.sss)"}),e.jsx(gt,{id:"end_time",type:"text",value:m,onChange:N=>oe(N.target.value,$,L),pattern:"^(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d{3})$",placeholder:"00:00:00.000",className:"font-mono text-xs tracking-wider",required:!0}),p&&e.jsx(Wt,{buttons:Ce(m,$,L)})]})]})}),!p&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(je,{onClick:()=>D(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(zn,{className:"h-4 w-4"}),"Show Time Controls"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Preview"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"preview",value:"video",checked:k==="video",onChange:N=>q(N.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm",children:"Video"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"preview",value:"gif",checked:k==="gif",onChange:N=>q(N.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm",children:"GIF"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("label",{htmlFor:"font_size",className:"text-sm font-medium",children:"Font Size"}),e.jsx(gt,{id:"font_size",type:"number",value:_,onChange:N=>{M(N.target.value),Se()},min:"10",max:"500",placeholder:"Auto",className:"w-20"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"text",className:"text-sm font-medium",children:"Text Overlay"}),e.jsx(tn,{id:"text",value:I,onChange:N=>{R(N.target.value),Se()},placeholder:"Enter text to overlay on video",className:"min-h-[100px] resize-y"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(er,{id:"display_text",checked:S,onCheckedChange:N=>{O(N),ce()}}),e.jsx("label",{htmlFor:"display_text",className:"text-sm font-medium cursor-pointer",children:"Show Text Overlay"})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center flex-wrap",children:[e.jsx(je,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#22c55e",color:"#22c55e"},children:e.jsxs("a",{href:ge("mp4"),download:le("mp4"),className:"inline-flex items-center gap-2",children:[e.jsx(kt,{className:"w-3 h-3"}),"Download MP4"]})}),e.jsx(je,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#22c55e",color:"#22c55e"},children:e.jsxs("a",{href:ge("gif"),download:le("gif"),className:"inline-flex items-center gap-2",children:[e.jsx(kt,{className:"w-3 h-3"}),"Download GIF"]})}),e.jsx(je,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#22c55e",color:"#22c55e"},children:e.jsxs("a",{href:ge("mp3"),download:le("mp3"),className:"inline-flex items-center gap-2",children:[e.jsx(kt,{className:"w-3 h-3"}),"Download MP3"]})})]}),F&&e.jsxs("div",{className:"flex items-center gap-1 justify-center flex-wrap",children:[e.jsxs(je,{onClick:()=>ve("mp4"),variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#3b82f6",color:"#3b82f6"},disabled:c.mp4,children:[c.mp4?e.jsx("div",{className:"w-3 h-3 mr-1 border border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Nt,{className:"w-3 h-3 mr-1"}),c.mp4?"Sharing...":"Share MP4"]}),e.jsxs(je,{onClick:()=>ve("gif"),variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#3b82f6",color:"#3b82f6"},disabled:c.gif,children:[c.gif?e.jsx("div",{className:"w-3 h-3 mr-1 border border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Nt,{className:"w-3 h-3 mr-1"}),c.gif?"Sharing...":"Share GIF"]}),e.jsxs(je,{onClick:()=>ve("mp3"),variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#3b82f6",color:"#3b82f6"},disabled:c.mp3,children:[c.mp3?e.jsx("div",{className:"w-3 h-3 mr-1 border border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Nt,{className:"w-3 h-3 mr-1"}),c.mp3?"Sharing...":"Share MP3"]})]})]})]})})]})};function tr(t){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const nn=d.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),ft=()=>{const t=d.useContext(nn);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};tr(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function nr(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function rr(){return Ot(/^Mac/)}function sr(){return Ot(/^iPhone/)}function Ut(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function ar(){return Ot(/^iPad/)||rr()&&navigator.maxTouchPoints>1}function rn(){return sr()||ar()}function Ot(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const or=24,ir=typeof window<"u"?u.useLayoutEffect:u.useEffect;function Vt(...t){return(...n)=>{for(let r of t)typeof r=="function"&&r(...n)}}const Ct=typeof document<"u"&&window.visualViewport;function qt(t){let n=window.getComputedStyle(t);return/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY)}function sn(t){for(qt(t)&&(t=t.parentElement);t&&!qt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const lr=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let pt=0,St;function cr(t={}){let{isDisabled:n}=t;ir(()=>{if(!n)return pt++,pt===1&&rn()&&(St=dr()),()=>{pt--,pt===0&&(St==null||St())}},[n])}function dr(){let t,n=0,r=f=>{t=sn(f.target),!(t===document.documentElement&&t===document.body)&&(n=f.changedTouches[0].pageY)},a=f=>{if(!t||t===document.documentElement||t===document.body){f.preventDefault();return}let m=f.changedTouches[0].pageY,$=t.scrollTop,_=t.scrollHeight-t.clientHeight;_!==0&&(($<=0&&m>n||$>=_&&m<n)&&f.preventDefault(),n=m)},i=f=>{let m=f.target;$t(m)&&m!==document.activeElement&&(f.preventDefault(),m.style.transform="translateY(-2000px)",m.focus(),requestAnimationFrame(()=>{m.style.transform=""}))},l=f=>{let m=f.target;$t(m)&&(m.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{m.style.transform="",Ct&&(Ct.height<window.innerHeight?requestAnimationFrame(()=>{Yt(m)}):Ct.addEventListener("resize",()=>Yt(m),{once:!0}))}))},b=()=>{window.scrollTo(0,0)},w=window.pageXOffset,y=window.pageYOffset,L=Vt(ur(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let g=Vt(ut(document,"touchstart",r,{passive:!1,capture:!0}),ut(document,"touchmove",a,{passive:!1,capture:!0}),ut(document,"touchend",i,{passive:!1,capture:!0}),ut(document,"focus",l,!0),ut(window,"scroll",b));return()=>{L(),g(),window.scrollTo(w,y)}}function ur(t,n,r){let a=t.style[n];return t.style[n]=r,()=>{t.style[n]=a}}function ut(t,n,r,a){return t.addEventListener(n,r,a),()=>{t.removeEventListener(n,r,a)}}function Yt(t){let n=document.scrollingElement||document.documentElement;for(;t&&t!==n;){let r=sn(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let a=r.getBoundingClientRect().top,i=t.getBoundingClientRect().top,l=t.getBoundingClientRect().bottom;const b=r.getBoundingClientRect().bottom+or;l>b&&(r.scrollTop+=i-a)}t=r.parentElement}}function $t(t){return t instanceof HTMLInputElement&&!lr.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function mr(t,n){typeof t=="function"?t(n):t!=null&&(t.current=n)}function fr(...t){return n=>t.forEach(r=>mr(r,n))}function an(...t){return u.useCallback(fr(...t),t)}const on=new WeakMap;function ke(t,n,r=!1){if(!t||!(t instanceof HTMLElement))return;let a={};Object.entries(n).forEach(([i,l])=>{if(i.startsWith("--")){t.style.setProperty(i,l);return}a[i]=t.style[i],t.style[i]=l}),!r&&on.set(t,a)}function hr(t,n){if(!t||!(t instanceof HTMLElement))return;let r=on.get(t);r&&(t.style[n]=r[n])}const we=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function xt(t,n){if(!t)return null;const r=window.getComputedStyle(t),a=r.transform||r.webkitTransform||r.mozTransform;let i=a.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[we(n)?13:12]):(i=a.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[we(n)?5:4]):null)}function pr(t){return 8*(Math.log(t+1)-2)}function Rt(t,n){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,n),()=>{t.style.cssText=r}}function xr(...t){return(...n)=>{for(const r of t)typeof r=="function"&&r(...n)}}const fe={DURATION:.5,EASE:[.32,.72,0,1]},ln=.4,gr=.25,vr=100,cn=8,rt=16,Dt=26,Et="vaul-dragging";function dn(t){const n=d.useRef(t);return d.useEffect(()=>{n.current=t}),d.useMemo(()=>(...r)=>n.current==null?void 0:n.current.call(n,...r),[])}function br({defaultProp:t,onChange:n}){const r=d.useState(t),[a]=r,i=d.useRef(a),l=dn(n);return d.useEffect(()=>{i.current!==a&&(l(a),i.current=a)},[a,i,l]),r}function un({prop:t,defaultProp:n,onChange:r=()=>{}}){const[a,i]=br({defaultProp:n,onChange:r}),l=t!==void 0,b=l?t:a,w=dn(r),y=d.useCallback(L=>{if(l){const f=typeof L=="function"?L(t):L;f!==t&&w(f)}else i(L)},[l,t,i,w]);return[b,y]}function wr({activeSnapPointProp:t,setActiveSnapPointProp:n,snapPoints:r,drawerRef:a,overlayRef:i,fadeFromIndex:l,onSnapPointChange:b,direction:w="bottom",container:y,snapToSequentialPoint:L}){const[g,f]=un({prop:t,defaultProp:r==null?void 0:r[0],onChange:n}),[m,$]=d.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);d.useEffect(()=>{function x(){$({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]);const _=d.useMemo(()=>g===(r==null?void 0:r[r.length-1])||null,[r,g]),M=d.useMemo(()=>{var x;return(x=r==null?void 0:r.findIndex(p=>p===g))!=null?x:null},[r,g]),I=r&&r.length>0&&(l||l===0)&&!Number.isNaN(l)&&r[l]===g||!r,R=d.useMemo(()=>{const x=y?{width:y.getBoundingClientRect().width,height:y.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var p;return(p=r==null?void 0:r.map(D=>{const F=typeof D=="string";let W=0;if(F&&(W=parseInt(D,10)),we(w)){const c=F?W:m?D*x.height:0;return m?w==="bottom"?x.height-c:-x.height+c:c}const X=F?W:m?D*x.width:0;return m?w==="right"?x.width-X:-x.width+X:X}))!=null?p:[]},[r,m,y]),S=d.useMemo(()=>M!==null?R==null?void 0:R[M]:null,[R,M]),O=d.useCallback(x=>{var p;const D=(p=R==null?void 0:R.findIndex(F=>F===x))!=null?p:null;b(D),ke(a.current,{transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,transform:we(w)?`translate3d(0, ${x}px, 0)`:`translate3d(${x}px, 0, 0)`}),R&&D!==R.length-1&&l!==void 0&&D!==l&&D<l?ke(i.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,opacity:"0"}):ke(i.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,opacity:"1"}),f(r==null?void 0:r[Math.max(D,0)])},[a.current,r,R,l,i,f]);d.useEffect(()=>{if(g||t){var x;const p=(x=r==null?void 0:r.findIndex(D=>D===t||D===g))!=null?x:-1;R&&p!==-1&&typeof R[p]=="number"&&O(R[p])}},[g,t,r,R,O]);function v({draggedDistance:x,closeDrawer:p,velocity:D,dismissible:F}){if(l===void 0)return;const W=w==="bottom"||w==="right"?(S??0)-x:(S??0)+x,X=M===l-1,c=M===0,E=x>0;if(X&&ke(i.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`}),!L&&D>2&&!E){F?p():O(R[0]);return}if(!L&&D>2&&E&&R&&r){O(R[r.length-1]);return}const k=R==null?void 0:R.reduce((C,se)=>typeof C!="number"||typeof se!="number"?C:Math.abs(se-W)<Math.abs(C-W)?se:C),q=we(w)?window.innerHeight:window.innerWidth;if(D>ln&&Math.abs(x)<q*.4){const C=E?1:-1;if(C>0&&_&&r){O(R[r.length-1]);return}if(c&&C<0&&F&&p(),M===null)return;O(R[M+C]);return}O(k)}function z({draggedDistance:x}){if(S===null)return;const p=w==="bottom"||w==="right"?S-x:S+x;(w==="bottom"||w==="right")&&p<R[R.length-1]||(w==="top"||w==="left")&&p>R[R.length-1]||ke(a.current,{transform:we(w)?`translate3d(0, ${p}px, 0)`:`translate3d(${p}px, 0, 0)`})}function V(x,p){if(!r||typeof M!="number"||!R||l===void 0)return null;const D=M===l-1;if(M>=l&&p)return 0;if(D&&!p)return 1;if(!I&&!D)return null;const W=D?M+1:M-1,X=D?R[W]-R[W-1]:R[W+1]-R[W],c=x/Math.abs(X);return D?1-c:c}return{isLastSnapPoint:_,activeSnapPoint:g,shouldFade:I,getPercentageDragged:V,setActiveSnapPoint:f,activeSnapPointIndex:M,onRelease:v,onDrag:z,snapPointsOffset:R}}const jr=()=>()=>{};function yr(){const{direction:t,isOpen:n,shouldScaleBackground:r,setBackgroundColorOnScale:a,noBodyStyles:i}=ft(),l=d.useRef(null),b=u.useMemo(()=>document.body.style.backgroundColor,[]);function w(){return(window.innerWidth-Dt)/window.innerWidth}d.useEffect(()=>{if(n&&r){l.current&&clearTimeout(l.current);const y=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!y)return;xr(a&&!i?Rt(document.body,{background:"black"}):jr,Rt(y,{transformOrigin:we(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${fe.DURATION}s`,transitionTimingFunction:`cubic-bezier(${fe.EASE.join(",")})`}));const L=Rt(y,{borderRadius:`${cn}px`,overflow:"hidden",...we(t)?{transform:`scale(${w()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${w()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{L(),l.current=window.setTimeout(()=>{b?document.body.style.background=b:document.body.style.removeProperty("background")},fe.DURATION*1e3)}}},[n,r,b])}let mt=null;function kr({isOpen:t,modal:n,nested:r,hasBeenOpened:a,preventScrollRestoration:i,noBodyStyles:l}){const[b,w]=d.useState(()=>typeof window<"u"?window.location.href:""),y=d.useRef(0),L=d.useCallback(()=>{if(Ut()&&mt===null&&t&&!l){mt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:f,innerHeight:m}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-y.current}px`,left:`${-f}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const $=m-window.innerHeight;$&&y.current>=m&&(document.body.style.top=`${-(y.current+$)}px`)}),300)}},[t]),g=d.useCallback(()=>{if(Ut()&&mt!==null&&!l){const f=-parseInt(document.body.style.top,10),m=-parseInt(document.body.style.left,10);Object.assign(document.body.style,mt),window.requestAnimationFrame(()=>{if(i&&b!==window.location.href){w(window.location.href);return}window.scrollTo(m,f)}),mt=null}},[b]);return d.useEffect(()=>{function f(){y.current=window.scrollY}return f(),window.addEventListener("scroll",f),()=>{window.removeEventListener("scroll",f)}},[]),d.useEffect(()=>{if(n)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||g()}},[n,g]),d.useEffect(()=>{r||!a||(t?(!window.matchMedia("(display-mode: standalone)").matches&&L(),n||window.setTimeout(()=>{g()},500)):g())},[t,a,b,n,r,L,g]),{restorePositionSetting:g}}function Nr({open:t,onOpenChange:n,children:r,onDrag:a,onRelease:i,snapPoints:l,shouldScaleBackground:b=!1,setBackgroundColorOnScale:w=!0,closeThreshold:y=gr,scrollLockTimeout:L=vr,dismissible:g=!0,handleOnly:f=!1,fadeFromIndex:m=l&&l.length-1,activeSnapPoint:$,setActiveSnapPoint:_,fixed:M,modal:I=!0,onClose:R,nested:S,noBodyStyles:O=!1,direction:v="bottom",defaultOpen:z=!1,disablePreventScroll:V=!0,snapToSequentialPoint:x=!1,preventScrollRestoration:p=!1,repositionInputs:D=!0,onAnimationEnd:F,container:W,autoFocus:X=!1}){var c,E;const[k=!1,q]=un({defaultProp:z,prop:t,onChange:H=>{n==null||n(H),!H&&!S&&st(),setTimeout(()=>{F==null||F(H)},fe.DURATION*1e3),H&&!I&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),H||(document.body.style.pointerEvents="auto")}}),[C,se]=d.useState(!1),[Y,xe]=d.useState(!1),[ae,ge]=d.useState(!1),le=d.useRef(null),ve=d.useRef(null),re=d.useRef(null),Ce=d.useRef(null),ce=d.useRef(null),Se=d.useRef(!1),ue=d.useRef(null),Ne=d.useRef(0),oe=d.useRef(!1),N=d.useRef(!z),h=d.useRef(0),o=d.useRef(null),U=d.useRef(((c=o.current)==null?void 0:c.getBoundingClientRect().height)||0),Q=d.useRef(((E=o.current)==null?void 0:E.getBoundingClientRect().width)||0),de=d.useRef(0),ne=d.useCallback(H=>{l&&H===Ee.length-1&&(ve.current=new Date)},[]),{activeSnapPoint:Pe,activeSnapPointIndex:Re,setActiveSnapPoint:Ae,onRelease:Ke,snapPointsOffset:Ee,onDrag:Xe,shouldFade:Me,getPercentageDragged:Ze}=wr({snapPoints:l,activeSnapPointProp:$,setActiveSnapPointProp:_,drawerRef:o,fadeFromIndex:m,overlayRef:le,onSnapPointChange:ne,direction:v,container:W,snapToSequentialPoint:x});cr({isDisabled:!k||Y||!I||ae||!C||!D||!V});const{restorePositionSetting:st}=kr({isOpen:k,modal:I,nested:S??!1,hasBeenOpened:C,preventScrollRestoration:p,noBodyStyles:O});function Te(){return(window.innerWidth-Dt)/window.innerWidth}function ot(H){var ee,te;!g&&!l||o.current&&!o.current.contains(H.target)||(U.current=((ee=o.current)==null?void 0:ee.getBoundingClientRect().height)||0,Q.current=((te=o.current)==null?void 0:te.getBoundingClientRect().width)||0,xe(!0),re.current=new Date,rn()&&window.addEventListener("touchend",()=>Se.current=!1,{once:!0}),H.target.setPointerCapture(H.pointerId),Ne.current=we(v)?H.pageY:H.pageX)}function et(H,ee){var te;let K=H;const ie=(te=window.getSelection())==null?void 0:te.toString(),T=o.current?xt(o.current,v):null,G=new Date;if(K.tagName==="SELECT"||K.hasAttribute("data-vaul-no-drag")||K.closest("[data-vaul-no-drag]"))return!1;if(v==="right"||v==="left")return!0;if(ve.current&&G.getTime()-ve.current.getTime()<500)return!1;if(T!==null&&(v==="bottom"?T>0:T<0))return!0;if(ie&&ie.length>0)return!1;if(ce.current&&G.getTime()-ce.current.getTime()<L&&T===0||ee)return ce.current=G,!1;for(;K;){if(K.scrollHeight>K.clientHeight){if(K.scrollTop!==0)return ce.current=new Date,!1;if(K.getAttribute("role")==="dialog")return!0}K=K.parentNode}return!0}function Le(H){if(o.current&&Y){const ee=v==="bottom"||v==="right"?1:-1,te=(Ne.current-(we(v)?H.pageY:H.pageX))*ee,K=te>0,ie=l&&!g&&!K;if(ie&&Re===0)return;const T=Math.abs(te),G=document.querySelector("[data-vaul-drawer-wrapper]"),pe=v==="bottom"||v==="top"?U.current:Q.current;let be=T/pe;const _e=Ze(T,K);if(_e!==null&&(be=_e),ie&&be>=1||!Se.current&&!et(H.target,K))return;if(o.current.classList.add(Et),Se.current=!0,ke(o.current,{transition:"none"}),ke(le.current,{transition:"none"}),l&&Xe({draggedDistance:te}),K&&!l){const he=pr(te),Ye=Math.min(he*-1,0)*ee;ke(o.current,{transform:we(v)?`translate3d(0, ${Ye}px, 0)`:`translate3d(${Ye}px, 0, 0)`});return}const me=1-be;if((Me||m&&Re===m-1)&&(a==null||a(H,be),ke(le.current,{opacity:`${me}`,transition:"none"},!0)),G&&le.current&&b){const he=Math.min(Te()+be*(1-Te()),1),Ye=8-be*8,tt=Math.max(0,14-be*14);ke(G,{borderRadius:`${Ye}px`,transform:we(v)?`scale(${he}) translate3d(0, ${tt}px, 0)`:`scale(${he}) translate3d(${tt}px, 0, 0)`,transition:"none"},!0)}if(!l){const he=T*ee;ke(o.current,{transform:we(v)?`translate3d(0, ${he}px, 0)`:`translate3d(${he}px, 0, 0)`})}}}d.useEffect(()=>{window.requestAnimationFrame(()=>{N.current=!0})},[]),d.useEffect(()=>{var H;function ee(){if(!o.current||!D)return;const te=document.activeElement;if($t(te)||oe.current){var K;const ie=((K=window.visualViewport)==null?void 0:K.height)||0,T=window.innerHeight;let G=T-ie;const pe=o.current.getBoundingClientRect().height||0,be=pe>T*.8;de.current||(de.current=pe);const _e=o.current.getBoundingClientRect().top;if(Math.abs(h.current-G)>60&&(oe.current=!oe.current),l&&l.length>0&&Ee&&Re){const me=Ee[Re]||0;G+=me}if(h.current=G,pe>ie||oe.current){const me=o.current.getBoundingClientRect().height;let he=me;me>ie&&(he=ie-(be?_e:Dt)),M?o.current.style.height=`${me-Math.max(G,0)}px`:o.current.style.height=`${Math.max(he,ie-_e)}px`}else nr()||(o.current.style.height=`${de.current}px`);l&&l.length>0&&!oe.current?o.current.style.bottom="0px":o.current.style.bottom=`${Math.max(G,0)}px`}}return(H=window.visualViewport)==null||H.addEventListener("resize",ee),()=>{var te;return(te=window.visualViewport)==null?void 0:te.removeEventListener("resize",ee)}},[Re,l,Ee]);function De(H){Oe(),R==null||R(),H||q(!1),setTimeout(()=>{l&&Ae(l[0])},fe.DURATION*1e3)}function We(){if(!o.current)return;const H=document.querySelector("[data-vaul-drawer-wrapper]"),ee=xt(o.current,v);ke(o.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`}),ke(le.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,opacity:"1"}),b&&ee&&ee>0&&k&&ke(H,{borderRadius:`${cn}px`,overflow:"hidden",...we(v)?{transform:`scale(${Te()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Te()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${fe.DURATION}s`,transitionTimingFunction:`cubic-bezier(${fe.EASE.join(",")})`},!0)}function Oe(){!Y||!o.current||(o.current.classList.remove(Et),Se.current=!1,xe(!1),Ce.current=new Date)}function it(H){if(!Y||!o.current)return;o.current.classList.remove(Et),Se.current=!1,xe(!1),Ce.current=new Date;const ee=xt(o.current,v);if(!H||!et(H.target,!1)||!ee||Number.isNaN(ee)||re.current===null)return;const te=Ce.current.getTime()-re.current.getTime(),K=Ne.current-(we(v)?H.pageY:H.pageX),ie=Math.abs(K)/te;if(ie>.05&&(ge(!0),setTimeout(()=>{ge(!1)},200)),l){Ke({draggedDistance:K*(v==="bottom"||v==="right"?1:-1),closeDrawer:De,velocity:ie,dismissible:g}),i==null||i(H,!0);return}if(v==="bottom"||v==="right"?K>0:K<0){We(),i==null||i(H,!0);return}if(ie>ln){De(),i==null||i(H,!1);return}var T;const G=Math.min((T=o.current.getBoundingClientRect().height)!=null?T:0,window.innerHeight);var pe;const be=Math.min((pe=o.current.getBoundingClientRect().width)!=null?pe:0,window.innerWidth),_e=v==="left"||v==="right";if(Math.abs(ee)>=(_e?be:G)*y){De(),i==null||i(H,!1);return}i==null||i(H,!0),We()}d.useEffect(()=>(k&&(ke(document.documentElement,{scrollBehavior:"auto"}),ve.current=new Date),()=>{hr(document.documentElement,"scrollBehavior")}),[k]);function Be(H){const ee=H?(window.innerWidth-rt)/window.innerWidth:1,te=H?-rt:0;ue.current&&window.clearTimeout(ue.current),ke(o.current,{transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,transform:we(v)?`scale(${ee}) translate3d(0, ${te}px, 0)`:`scale(${ee}) translate3d(${te}px, 0, 0)`}),!H&&o.current&&(ue.current=setTimeout(()=>{const K=xt(o.current,v);ke(o.current,{transition:"none",transform:we(v)?`translate3d(0, ${K}px, 0)`:`translate3d(${K}px, 0, 0)`})},500))}function Ie(H,ee){if(ee<0)return;const te=(window.innerWidth-rt)/window.innerWidth,K=te+ee*(1-te),ie=-rt+ee*rt;ke(o.current,{transform:we(v)?`scale(${K}) translate3d(0, ${ie}px, 0)`:`scale(${K}) translate3d(${ie}px, 0, 0)`,transition:"none"})}function qe(H,ee){const te=we(v)?window.innerHeight:window.innerWidth,K=ee?(te-rt)/te:1,ie=ee?-rt:0;ee&&ke(o.current,{transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,transform:we(v)?`scale(${K}) translate3d(0, ${ie}px, 0)`:`scale(${K}) translate3d(${ie}px, 0, 0)`})}return d.useEffect(()=>{I||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[I]),d.createElement(Ln,{defaultOpen:z,onOpenChange:H=>{!g&&!H||(H?se(!0):De(!0),q(H))},open:k},d.createElement(nn.Provider,{value:{activeSnapPoint:Pe,snapPoints:l,setActiveSnapPoint:Ae,drawerRef:o,overlayRef:le,onOpenChange:n,onPress:ot,onRelease:it,onDrag:Le,dismissible:g,shouldAnimate:N,handleOnly:f,isOpen:k,isDragging:Y,shouldFade:Me,closeDrawer:De,onNestedDrag:Ie,onNestedOpenChange:Be,onNestedRelease:qe,keyboardIsOpen:oe,modal:I,snapPointsOffset:Ee,activeSnapPointIndex:Re,direction:v,shouldScaleBackground:b,setBackgroundColorOnScale:w,noBodyStyles:O,container:W,autoFocus:X}},r))}const mn=d.forwardRef(function({...t},n){const{overlayRef:r,snapPoints:a,onRelease:i,shouldFade:l,isOpen:b,modal:w,shouldAnimate:y}=ft(),L=an(n,r),g=a&&a.length>0;if(!w)return null;const f=d.useCallback(m=>i(m),[i]);return d.createElement(Tn,{onMouseUp:f,ref:L,"data-vaul-overlay":"","data-vaul-snap-points":b&&g?"true":"false","data-vaul-snap-points-overlay":b&&l?"true":"false","data-vaul-animate":y!=null&&y.current?"true":"false",...t})});mn.displayName="Drawer.Overlay";const fn=d.forwardRef(function({onPointerDownOutside:t,style:n,onOpenAutoFocus:r,...a},i){const{drawerRef:l,onPress:b,onRelease:w,onDrag:y,keyboardIsOpen:L,snapPointsOffset:g,activeSnapPointIndex:f,modal:m,isOpen:$,direction:_,snapPoints:M,container:I,handleOnly:R,shouldAnimate:S,autoFocus:O}=ft(),[v,z]=d.useState(!1),V=an(i,l),x=d.useRef(null),p=d.useRef(null),D=d.useRef(!1),F=M&&M.length>0;yr();const W=(c,E,k=0)=>{if(D.current)return!0;const q=Math.abs(c.y),C=Math.abs(c.x),se=C>q,Y=["bottom","right"].includes(E)?1:-1;if(E==="left"||E==="right"){if(!(c.x*Y<0)&&C>=0&&C<=k)return se}else if(!(c.y*Y<0)&&q>=0&&q<=k)return!se;return D.current=!0,!0};d.useEffect(()=>{F&&window.requestAnimationFrame(()=>{z(!0)})},[]);function X(c){x.current=null,D.current=!1,w(c)}return d.createElement(_n,{"data-vaul-drawer-direction":_,"data-vaul-drawer":"","data-vaul-delayed-snap-points":v?"true":"false","data-vaul-snap-points":$&&F?"true":"false","data-vaul-custom-container":I?"true":"false","data-vaul-animate":S!=null&&S.current?"true":"false",...a,ref:V,style:g&&g.length>0?{"--snap-point-height":`${g[f??0]}px`,...n}:n,onPointerDown:c=>{R||(a.onPointerDown==null||a.onPointerDown.call(a,c),x.current={x:c.pageX,y:c.pageY},b(c))},onOpenAutoFocus:c=>{r==null||r(c),O||c.preventDefault()},onPointerDownOutside:c=>{if(t==null||t(c),!m||c.defaultPrevented){c.preventDefault();return}L.current&&(L.current=!1)},onFocusOutside:c=>{if(!m){c.preventDefault();return}},onPointerMove:c=>{if(p.current=c,R||(a.onPointerMove==null||a.onPointerMove.call(a,c),!x.current))return;const E=c.pageY-x.current.y,k=c.pageX-x.current.x,q=c.pointerType==="touch"?10:2;W({x:k,y:E},_,q)?y(c):(Math.abs(k)>q||Math.abs(E)>q)&&(x.current=null)},onPointerUp:c=>{a.onPointerUp==null||a.onPointerUp.call(a,c),x.current=null,D.current=!1,w(c)},onPointerOut:c=>{a.onPointerOut==null||a.onPointerOut.call(a,c),X(p.current)},onContextMenu:c=>{a.onContextMenu==null||a.onContextMenu.call(a,c),p.current&&X(p.current)}})});fn.displayName="Drawer.Content";const Cr=250,Sr=120,Rr=d.forwardRef(function({preventCycle:t=!1,children:n,...r},a){const{closeDrawer:i,isDragging:l,snapPoints:b,activeSnapPoint:w,setActiveSnapPoint:y,dismissible:L,handleOnly:g,isOpen:f,onPress:m,onDrag:$}=ft(),_=d.useRef(null),M=d.useRef(!1);function I(){if(M.current){O();return}window.setTimeout(()=>{R()},Sr)}function R(){if(l||t||M.current){O();return}if(O(),!b||b.length===0){L||i();return}if(w===b[b.length-1]&&L){i();return}const z=b.findIndex(x=>x===w);if(z===-1)return;const V=b[z+1];y(V)}function S(){_.current=window.setTimeout(()=>{M.current=!0},Cr)}function O(){_.current&&window.clearTimeout(_.current),M.current=!1}return d.createElement("div",{onClick:I,onPointerCancel:O,onPointerDown:v=>{g&&m(v),S()},onPointerMove:v=>{g&&$(v)},ref:a,"data-vaul-drawer-visible":f?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},d.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},n))});Rr.displayName="Drawer.Handle";function Er(t){const n=ft(),{container:r=n.container,...a}=t;return d.createElement(Mn,{container:r,...a})}const ht={Root:Nr,Content:fn,Overlay:mn,Portal:Er,Title:En};function Lt({...t}){return e.jsx(ht.Root,{"data-slot":"drawer",...t})}function Lr({...t}){return e.jsx(ht.Portal,{"data-slot":"drawer-portal",...t})}function _r({className:t,...n}){return e.jsx(ht.Overlay,{"data-slot":"drawer-overlay",className:$e("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}function _t({className:t,children:n,...r}){return e.jsxs(Lr,{"data-slot":"drawer-portal",children:[e.jsx(_r,{}),e.jsxs(ht.Content,{"data-slot":"drawer-content",className:$e("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",t),...r,children:[e.jsx("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),n]})]})}function Xt({className:t,...n}){return e.jsx("div",{"data-slot":"drawer-header",className:$e("flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",t),...n})}function Gt({className:t,...n}){return e.jsx(ht.Title,{"data-slot":"drawer-title",className:$e("text-foreground font-semibold",t),...n})}function Mr(){const t=Jt(),{selectedWatchDirs:n,selectedSources:r,setFiles:a,refreshFiles:i,showAllFiles:l,setShowAllFiles:b,page:w,setPage:y,pageSize:L,setPageSize:g,sortColumn:f,setSortColumn:m,sortDirection:$,setSortDirection:_,totalPages:M,totalRecords:I}=Qt(),[R,S]=u.useState(new Set),[O,v]=u.useState(""),[z,V]=u.useState(""),[x,p]=u.useState({}),[D,F]=u.useState(!1),[W]=u.useState([]),[X]=u.useState(null),[c]=u.useState("TODO delete"),[E,k]=u.useState(!0),[q,C]=u.useState(0),[se,Y]=u.useState(null),[xe,ae]=u.useState(0),[ge,le]=u.useState(!1),[ve,re]=u.useState(!1),[Ce,ce]=u.useState(!1),[Se,ue]=u.useState(!1),[Ne,oe]=u.useState(!1),[N,h]=u.useState(!1),[o,U]=u.useState(null),[Q,de]=u.useState(null),[ne,Pe]=u.useState(null),[Re,Ae]=u.useState(""),Ke=u.useRef({}),Ee=u.useRef({}),Xe=u.useRef({}),Me=u.useRef(null),Ze=!0;u.useEffect(()=>{const T=Me.current;if(!T||!Ze)return;const G=()=>{const pe=T.scrollTop;k(pe<=10),C(pe)};return T.addEventListener("scroll",G),G(),()=>{T.removeEventListener("scroll",G)}},[Ze]);const st=()=>{const T=Me.current;T&&T.scrollTo({top:0,behavior:"smooth"})},Te=async()=>{if(!O.trim()){p({}),V("");return}F(!0);try{const T=new URLSearchParams;T.append("query",O),n.length>0&&T.append("filter",n.join(",")),r.length>0&&T.append("sources",r.join(","));const G=await fetch(Ve(`/api/search?${T.toString()}`));if(G.ok){const pe=await G.json();if(pe.success){p(pe.data.map(me=>({[me.file_path]:me.matches.map(he=>he.line_number)})).reduce((me,he)=>({...me,...he}),{}));const _e=pe.data.map(me=>{const he=me.matches[0];return he&&he.video_info?he.video_info:null}).filter(me=>me!==null).filter((me,he,Ye)=>he===Ye.findIndex(tt=>tt.full_path===me.full_path));a(_e)}V(O)}}catch(T){console.error("Error searching:",T)}finally{F(!1)}},ot=()=>{b(T=>!T)},et=()=>{v(""),V(""),p({}),S(new Set),l&&i()},Le=T=>{const G=Math.floor(T/3600),pe=Math.floor(T%3600/60),be=T%60,_e=Math.floor(be),me=Math.round((be-_e)*1e3);return`${G.toString().padStart(2,"0")}:${pe.toString().padStart(2,"0")}:${_e.toString().padStart(2,"0")}.${me.toString().padStart(3,"0")}`},De=T=>{U(T)},We=T=>{de(T)},Oe=u.useCallback((T,G)=>{t?T?(ue(!0),oe(!1),h(!1)):ue(!1):(Y(T),re(!1),ce(!1))},[t]),it=()=>{t?(oe(!0),ue(!1),h(!1)):(re(!0),ce(!1),Y(null))},Be=()=>{t?(h(!0),ue(!1),oe(!1)):(ce(!0),re(!1),Y(null))},Ie=()=>{if(re(!1),o!==null&&Q!==null&&ne){const T=`/clip_player/${encodeURIComponent(ne)}?start_time=${o}&end_time=${Q}&display_text=false`,G=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(dt,{filename:ne,start_time_formatted:Le(o),end_time_formatted:Le(Q),font_size:"",text:Re,display_text:!1,onStartTimeChange:De,onEndTimeChange:We,onBack:()=>{t?ue(!1):(Y(null),te())}},ne)});Oe(G,T)}},qe=()=>{if(ce(!1),o!==null&&Q!==null&&ne){const T=`/clip_player/${encodeURIComponent(ne)}?start_time=${o}&end_time=${Q}&display_text=false`,G=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(dt,{filename:ne,start_time_formatted:Le(o),end_time_formatted:Le(Q),font_size:"",text:Re,display_text:!1,onStartTimeChange:De,onEndTimeChange:We,onBack:()=>{t?ue(!1):(Y(null),te())}},ne)});Oe(G,T)}},H=(T,G)=>{ne&&ne!==G?(U(T),de(null),Pe(G)):(U(T),Pe(G))},ee=(T,G)=>{ne&&ne!==G?(U(null),de(T),Pe(G)):(de(T),Pe(G))},te=()=>{U(null),de(null),Pe(null),Ae(""),Y(null),ue(!1),oe(!1),h(!1),re(!1),ce(!1)},K=(T,G,pe,be)=>{U(T),de(G),Pe(be),Ae(pe)},ie=()=>{if(o!==null&&Q!==null&&ne){const T=`/clip_player/${encodeURIComponent(ne)}?start_time=${o}&end_time=${Q}&display_text=false`,G=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(dt,{filename:ne,start_time_formatted:Le(o),end_time_formatted:Le(Q),font_size:"",text:Re,display_text:!1,onStartTimeChange:De,onEndTimeChange:We,onBack:()=>{t?(Oe(null),k(!0),setTimeout(()=>{Me.current&&(Me.current.scrollTop=q)},0)):Y(null)}},ne)});Oe(G,T)}};return u.useEffect(()=>{if(o!==null&&Q!==null&&ne){const T=`/clip_player/${encodeURIComponent(ne)}?start_time=${o}&end_time=${Q}&display_text=false`,G=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(dt,{filename:ne,start_time_formatted:Le(o),end_time_formatted:Le(Q),font_size:"",text:Re,display_text:!1,onStartTimeChange:De,onEndTimeChange:We,onBack:()=>{t?ue(!1):(Y(null),te())}},ne)});Oe(G,T)}else(o!==null||Q!==null)&&(t?ue(!1):Y(null))},[o,Q,ne,Oe,t]),u.useEffect(()=>{typeof window<"u"&&(window.handleSetRightPaneComponent=Oe)},[Oe]),e.jsxs(e.Fragment,{children:[e.jsx(qn,{show:!0,searchTerm:O,setSearchTerm:v,activeSearchTerm:z,setActiveSearchTerm:V,setSearchLineNumbers:p,setExpandedFiles:S,isSearching:D,queue:W,currentProcessingFile:X,isAtTop:E,clipStart:o,clipEnd:Q,selectedWatchDirs:n,setSelectedWatchDirs:()=>{},availableWatchDirs:[],selectedSources:r,setSelectedSources:()=>{},availableSources:[],showAllFiles:l,onToggleShowAllFiles:ot,onSearch:Te,onClearSearch:et,onScrollToTop:st,onConfigClick:it,onQueueClick:Be,mobileClipPlayerComponent:null,onPlayClip:ie}),e.jsxs("div",{className:"flex h-screen",children:[e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(Kn,{watchDirectory:c,isSmallScreen:t,activeSearchTerm:z,searchLineNumbers:x,setSearchLineNumbers:p,expandedFiles:R,setExpandedFiles:S,currentProcessingFile:X,leftPaneWidth:xe,setLeftPaneWidth:ae,isLeftPaneWidthMeasured:ge,setIsLeftPaneWidthMeasured:le,clipStart:o,clipEnd:Q,clipTranscript:ne,fileRowRefs:Ke,transcriptRowRefs:Ee,mobileTranscriptRowRefs:Xe,leftPaneRef:Me,onSetRightPaneUrl:Oe,onSetClipStart:H,onSetClipEnd:ee,onClearClip:te,onClipBlock:K,showAllFiles:l})}),!t&&e.jsx("div",{className:"w-1/3 border-l border-border flex flex-col scrollbar-hide pt-16",children:ve?e.jsx(Ht,{onClose:Ie}):Ce?e.jsx(It,{onClose:qe}):se||e.jsx(Zn,{})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Lt,{open:Se,onOpenChange:ue,children:e.jsx(_t,{children:e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:o!==null&&Q!==null&&ne&&e.jsx(dt,{filename:ne,start_time_formatted:Le(o),end_time_formatted:Le(Q),font_size:"",text:Re,display_text:!1,onStartTimeChange:De,onEndTimeChange:We,onBack:()=>ue(!1)},ne)})})}),e.jsx(Lt,{open:Ne,onOpenChange:oe,children:e.jsxs(_t,{children:[e.jsx(Xt,{children:e.jsx(Gt,{children:"Configuration"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Ht,{onClose:()=>oe(!1)})})]})}),e.jsx(Lt,{open:N,onOpenChange:h,children:e.jsxs(_t,{children:[e.jsx(Xt,{children:e.jsx(Gt,{children:"Processing Queue"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(It,{onClose:()=>h(!1)})})]})})]})]})}function Fr(){return e.jsx(Mr,{})}export{Fr as default};
