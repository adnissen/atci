import{j as s}from"./radix-CDPlHJ-s.js";import{u as ce,r as i}from"./router-Cji3JhtE.js";import{a as m,T as me,f as pe,d as ue,g as z}from"./index.js";import{f as he,R as fe,A as G,C as f,T as xe,P as ge,a as K,D as T}from"./icons-D0PEVxHe.js";import"./react-vendor-DJG_os-6.js";import"./utils-BMpDO24p.js";function Ne({onClose:x}={}){var J;const D=ce(),[o,c]=i.useState({watch_directories:[""],whispercli_path:"",model_path:"",ffmpeg_path:"",ffprobe_path:"",processing_success_command:"",processing_failure_command:""}),[g,j]=i.useState(!1),[F,n]=i.useState([]),[A,p]=i.useState(""),[Q,P]=i.useState(!1),[u,X]=i.useState([]),[Y,M]=i.useState(!1),[d,v]=i.useState("custom"),[$,I]=i.useState(null),[b,Z]=i.useState([]),[w,U]=i.useState(null),[y,ee]=i.useState(null),[_,V]=i.useState(!1),[L,E]=i.useState(!1),[O,N]=i.useState("");i.useEffect(()=>{S(),q(),C(),k()},[]);const q=async()=>{M(!0);try{const e=await fetch(m("/api/models/list"));if(e.ok){const t=await e.json();t.success&&t.data?X(t.data||[]):n([t.error||"Failed to fetch models"])}}catch(e){console.error("Error fetching models:",e)}finally{M(!1)}},se=async e=>{I(e);try{const t=await fetch(m("/api/models/download"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e})});if(t.ok)await q(),d===e&&c(a=>({...a,model_name:e,model_path:""}));else{const a=await t.json();n([a.message||"Failed to download model"])}}catch{n(["Network error: Failed to download model"])}finally{I(null)}},C=async()=>{try{const e=await fetch(m("/api/tools/list"));if(e.ok){const t=await e.json();t.success&&t.data?Z(t.data||[]):n([t.error||"Failed to fetch tools"])}else console.error("Failed to fetch tools")}catch(e){console.error("Error fetching tools:",e)}},k=async()=>{V(!0),N("");try{const e=await fetch(m("/api/version/latest"));if(e.ok){const t=await e.json();t.success&&t.data?ee(t.data):n(a=>[...a,t.error||"Failed to fetch version info"])}else console.error("Failed to fetch version info")}catch(e){console.error("Error fetching version info:",e)}finally{V(!1)}},te=async()=>{E(!0),N(""),n([]);try{const e=await fetch(m("/api/update"),{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();e.ok&&t.success?(N(t.data||"Update completed successfully!"),setTimeout(()=>{k()},2e3)):n([t.error||"Update failed"])}catch(e){console.error("Error performing update:",e),n([e.message||"Network error: Failed to perform update"])}finally{E(!1)}},R=async e=>{U(e);try{const t=await fetch(m("/api/tools/download"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:e})});if(t.ok)await C(),await S(),p(`${e} downloaded successfully`);else{const a=await t.json();n([a.message||`Failed to download ${e}`])}}catch(t){console.error("Error downloading tool:",t),n([t.message||`Failed to download ${e}`])}finally{U(null)}},W=async e=>{try{const t=await fetch(m("/api/tools/use-downloaded"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool_name:e})});if(t.ok)await S(),await C(),p(`Now using downloaded ${e}`);else{const a=await t.json();n([a.message||`Failed to use downloaded ${e}`])}}catch(t){console.error("Error setting tool path:",t),n([t.message||`Failed to use downloaded ${e}`])}},ae=async e=>{const t=b.find(a=>a.name===e);t&&t.system_path?(c(a=>({...a,[`${e}_path`]:t.system_path})),p("")):n([`System path not found for ${e}`])},oe=async e=>{const t=b.find(a=>a.name===e);t&&t.system_path?(c(a=>({...a,[`${e}_path`]:t.system_path})),p("")):n([`System path not found for ${e}`])},S=async()=>{var e;P(!0);try{const t=await fetch(m("/api/config"),{headers:{Accept:"application/json","Content-Type":"application/json"}});if(t.ok){const a=await t.json();if(a.success&&((e=a.data)!=null&&e.config)){const r=a.data.config,l={watch_directories:r.watch_directories&&r.watch_directories.length>0?r.watch_directories:[""],whispercli_path:r.whispercli_path||"",model_path:r.model_path||"",model_name:r.model_name||"",ffmpeg_path:r.ffmpeg_path||"",ffprobe_path:r.ffprobe_path||"",password:r.password||"",processing_success_command:r.processing_success_command||"",processing_failure_command:r.processing_failure_command||""};c(l),l.model_name?v(l.model_name):l.model_path&&v("custom")}}}catch(t){console.error("Error fetching configuration:",t)}finally{P(!1)}},B=()=>{var a,r;const e=o.watch_directories.some(l=>l.trim()!==""),t=d==="custom"&&((a=o.model_path)==null?void 0:a.trim())!==""||d!=="custom"&&((r=u.find(l=>l.name===d))==null?void 0:r.downloaded);return e&&o.whispercli_path.trim()!==""&&o.ffmpeg_path.trim()!==""&&o.ffprobe_path.trim()!==""&&t},h=(e,t)=>{c(a=>({...a,[e]:t}))},re=(e,t)=>{const a=[...o.watch_directories];a[e]=t,c(r=>({...r,watch_directories:a}))},ne=()=>{c(e=>({...e,watch_directories:[...e.watch_directories,""]}))},ie=e=>{if(o.watch_directories.length>1){const t=o.watch_directories.filter((a,r)=>r!==e);c(a=>({...a,watch_directories:t}))}},de=()=>{x?x():D("/")},le=e=>{v(e),e==="custom"?c(t=>({...t,model_name:void 0,model_path:t.model_path||""})):u.find(a=>a.name===e)&&c(a=>({...a,model_name:e,model_path:""}))},H=async(e=!1)=>{j(!0),n([]),p("");const t=o.watch_directories.filter(r=>r.trim()!=="");if(t.length===0){n(["At least one watch directory is required"]),j(!1);return}const a={watch_directories:t,whispercli_path:o.whispercli_path,ffmpeg_path:o.ffmpeg_path,ffprobe_path:o.ffprobe_path};d==="custom"?a.model_path=o.model_path:a.model_name=d,o.password!==void 0&&(a.password=o.password),o.processing_success_command!==void 0&&(a.processing_success_command=o.processing_success_command),o.processing_failure_command!==void 0&&(a.processing_failure_command=o.processing_failure_command);try{const r=await fetch(m("/api/config"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)}),l=await r.json();r.ok&&l.success?(p("Configuration saved successfully!"),e&&setTimeout(()=>{x?x():D("/")},1e3)):n(l.errors||[l.message||"Failed to save configuration"])}catch{n(["Network error: Failed to save configuration"])}finally{j(!1)}};return s.jsx("div",{className:"h-full overflow-auto",children:Q?s.jsx("div",{className:"text-center py-8",children:s.jsx("div",{className:"text-lg text-muted-foreground",children:"Loading configuration..."})}):s.jsxs("div",{className:"p-6 h-full",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Configuration"}),x&&s.jsxs("button",{onClick:de,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[s.jsx(he,{className:"h-4 w-4"}),"Close"]})]}),s.jsxs("div",{className:"mb-6 border border-border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Application Version"}),s.jsxs("button",{type:"button",onClick:k,disabled:_,className:"flex items-center gap-1 px-2 py-1 text-xs text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50",title:"Refresh version information",children:[s.jsx(fe,{className:`h-3 w-3 ${_?"animate-spin":""}`}),"Refresh"]})]}),_?s.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading version information..."}):y?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"text-xs space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Current Version:"}),s.jsx("span",{className:"font-mono text-foreground",children:y.current_version})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-muted-foreground",children:"Latest Version:"}),s.jsx("span",{className:"font-mono text-foreground",children:y.latest_version})]})]}),y.update_available?s.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("div",{className:"flex items-center gap-1 text-xs text-orange-600",children:[s.jsx(G,{className:"h-3 w-3"}),"Update available"]})}),s.jsxs("button",{type:"button",onClick:te,disabled:L,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(G,{className:"h-3 w-3"}),L?"Updating...":"Update Now"]})]}):s.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-border",children:[s.jsx(f,{className:"h-3 w-3 text-green-600"}),s.jsx("span",{className:"text-xs text-green-600",children:"Up to date"})]}),O&&s.jsx("div",{className:"mt-2 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-800",children:O})]}):s.jsx("div",{className:"text-sm text-muted-foreground",children:"Failed to load version information"})]}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),H(!1)},className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Watch Directories"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"border border-input rounded-md",children:s.jsx(me,{children:s.jsx(pe,{children:o.watch_directories.map((e,t)=>s.jsxs(ue,{children:[s.jsx(z,{className:"p-2",children:s.jsx("input",{type:"text",value:e,onChange:a=>re(t,a.target.value),placeholder:"/path/to/your/videos",className:"w-full px-2 py-1 text-sm border-0 bg-transparent text-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:ring-inset rounded"})}),s.jsx(z,{className:"p-2 w-10",children:s.jsx("button",{type:"button",onClick:()=>ie(t),disabled:o.watch_directories.length===1,className:"p-1 text-destructive hover:bg-destructive/10 rounded disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent",title:"Remove directory",children:s.jsx(xe,{className:"h-3 w-3"})})})]},t))})})}),s.jsxs("button",{type:"button",onClick:ne,className:"flex items-center gap-1 px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded hover:bg-secondary/80",children:[s.jsx(ge,{className:"h-3 w-3"}),"Add Directory"]})]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Directories to monitor for video files. At least one directory is required."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Whisper-CLI Tool"}),b.filter(e=>e.name==="whisper-cli").map(e=>s.jsxs("div",{className:"border border-border rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Whisper CLI"}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:["Platform: ",e.platform]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-xs space-y-1",children:[e.system_available&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Available in system PATH: ",e.system_path]}),e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Downloaded to: ",e.downloaded_path]}),!e.system_available&&!e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[s.jsx(K,{className:"h-3 w-3"}),"Not found in system PATH or downloads"]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"whispercli_path",className:"block text-xs font-medium text-foreground mb-1",children:"Current Path"}),s.jsx("input",{type:"text",id:"whispercli_path",value:o.whispercli_path,onChange:t=>h("whispercli_path",t.target.value),placeholder:"/path/to/whisper-cli",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent text-sm",required:!0})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[!e.downloaded&&s.jsxs("button",{type:"button",onClick:()=>R(e.name),disabled:w!==null,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(T,{className:"h-3 w-3"}),w===e.name?"Downloading...":"Download"]}),e.downloaded&&s.jsx("button",{type:"button",onClick:()=>W(e.name),className:"px-3 py-1.5 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Use Downloaded Version"}),e.system_available&&s.jsx("button",{type:"button",onClick:()=>oe(e.name),className:"px-3 py-1.5 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Use System Version"})]})]})]},e.name))]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-foreground mb-1",children:"Model Selection"}),s.jsxs("select",{value:d,onChange:e=>le(e.target.value),className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",disabled:Y,children:[s.jsx("option",{value:"custom",children:"Custom Model Path"}),u.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("optgroup",{label:"Downloaded Models",children:u.filter(e=>e.downloaded).map(e=>s.jsxs("option",{value:e.name,children:[e.name," ✓"]},e.name))}),s.jsx("optgroup",{label:"Available Models",children:u.filter(e=>!e.downloaded).map(e=>s.jsx("option",{value:e.name,children:e.name},e.name))})]})]}),d==="custom"?s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"text",value:o.model_path||"",onChange:e=>h("model_path",e.target.value),placeholder:"/path/to/your/whisper.cpp/model.bin",className:"w-full mt-2 px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",required:d==="custom"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Path to the Whisper model file (.bin)"})]}):d!=="custom"&&s.jsx(s.Fragment,{children:(J=u.find(e=>e.name===d))!=null&&J.downloaded?s.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-green-600",children:[s.jsx(f,{className:"h-4 w-4"}),"Model is downloaded and ready to use"]}):s.jsxs("button",{type:"button",onClick:()=>se(d),disabled:$!==null,className:"mt-2 flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(T,{className:"h-3 w-3"}),$===d?"Downloading...":"Download Model"]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"FFmpeg Tools"}),b.filter(e=>e.name==="ffmpeg"||e.name==="ffprobe").map(e=>s.jsxs("div",{className:"border border-border rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-sm font-medium text-foreground capitalize",children:e.name}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:["Platform: ",e.platform]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"text-xs space-y-1",children:[e.system_available&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Available in system PATH: ",e.system_path]}),e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[s.jsx(f,{className:"h-3 w-3"}),"Downloaded to: ",e.downloaded_path]}),!e.system_available&&!e.downloaded&&s.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[s.jsx(K,{className:"h-3 w-3"}),"Not found in system PATH or downloads"]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:`${e.name}_path`,className:"block text-xs font-medium text-foreground mb-1",children:"Current Path"}),s.jsx("input",{type:"text",id:`${e.name}_path`,value:o[`${e.name}_path`],onChange:t=>h(`${e.name}_path`,t.target.value),placeholder:`/path/to/${e.name}`,className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent text-sm",required:!0})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[!e.downloaded&&s.jsxs("button",{type:"button",onClick:()=>R(e.name),disabled:w!==null,className:"flex items-center gap-2 px-3 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(T,{className:"h-3 w-3"}),w===e.name?"Downloading...":"Download"]}),e.downloaded&&s.jsx("button",{type:"button",onClick:()=>W(e.name),className:"px-3 py-1.5 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Use Downloaded Version"}),e.system_available&&s.jsx("button",{type:"button",onClick:()=>ae(e.name),className:"px-3 py-1.5 text-xs bg-gray-600 text-white rounded hover:bg-gray-700",children:"Use System Version"})]})]})]},e.name))]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-foreground mb-1",children:"API Password (optional)"}),s.jsx("input",{type:"password",id:"password",value:o.password||"",onChange:e=>h("password",e.target.value),placeholder:"Set or clear API password (leave blank to disable)",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"If set, all API requests require this password (via Basic Auth or cookie)."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Processing Commands"}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"processing_success_command",className:"block text-sm font-medium text-foreground mb-1",children:"Success Command (optional)"}),s.jsx("input",{type:"text",id:"processing_success_command",value:o.processing_success_command||"",onChange:e=>h("processing_success_command",e.target.value),placeholder:"/path/to/script.sh",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Command to execute when video processing succeeds. The video file path will be piped to the command's stdin."})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"processing_failure_command",className:"block text-sm font-medium text-foreground mb-1",children:"Failure Command (optional)"}),s.jsx("input",{type:"text",id:"processing_failure_command",value:o.processing_failure_command||"",onChange:e=>h("processing_failure_command",e.target.value),placeholder:"/path/to/error-handler.sh",className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded-md focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Command to execute when video processing fails. The video file path will be piped to the command's stdin."})]})]}),F.length>0&&s.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-3",children:s.jsx("div",{className:"text-sm text-destructive",children:s.jsx("ul",{className:"list-disc list-inside space-y-1",children:F.map((e,t)=>s.jsx("li",{children:e},t))})})}),A&&s.jsx("div",{className:"bg-accent/10 border border-accent/20 rounded-md p-3",children:s.jsx("div",{className:"text-sm text-accent-foreground",children:A})}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{type:"submit",disabled:g||!B(),className:"px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Saving...":"Save"}),s.jsx("button",{type:"button",onClick:()=>H(!0),disabled:g||!B(),className:"px-4 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/80 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Saving...":"Save and Close"})]})]})]})})}export{Ne as default};
