import{j as e,S as vn,C as wn,a as bn,T as jn,R as yn,b as kn,P as Nn,O as Cn}from"./radix-CDPlHJ-s.js";import{r as m,b as h}from"./router-Cji3JhtE.js";import{a as Sn}from"./utils-BMpDO24p.js";import{c as Ee,a as Ae,u as Gt,b as It,T as Rn,d as En,e as bt,f as tt,g as Ln,h as Je}from"./index.js";import{D as Pe,a as Fe,b as He,c as gt,d as Ke,e as Ze,f as ge,Q as At}from"./QueuePage-Cie3oKs_.js";import{b as jt,X as Mn,c as _n,d as Pt,e as Tn,f as $n,R as Dn,g as On,D as yt,h as kt}from"./icons-dUk6Lg-n.js";import Ft from"./ConfigPage-Cs3yB0E-.js";import"./react-vendor-DJG_os-6.js";const Bn=Sn("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),pe=m.forwardRef(({className:t,variant:n,size:r,asChild:a=!1,...o},i)=>{const j=a?vn:"button";return e.jsx(j,{className:Ee(Bn({variant:n,size:r,className:t})),ref:i,...o})});pe.displayName="Button";function In(t){const[n,r]=m.useState(()=>window.matchMedia(t).matches);return m.useEffect(()=>{const a=window.matchMedia(t),o=i=>{r(i.matches)};return a.addEventListener("change",o),r(a.matches),()=>{a.removeEventListener("change",o)}},[t]),n}function Qt(){return!In("(min-width: 640px)")}function An({searchTerm:t,setSearchTerm:n,activeSearchTerm:r,setActiveSearchTerm:a,setSearchLineNumbers:o,setExpandedFiles:i,isSearching:j,isOpen:b,onClose:k,onSearch:S,onClearSearch:v,selectedWatchDirs:d,setSelectedWatchDirs:u,availableWatchDirs:D,selectedSources:R,setSelectedSources:$,availableSources:O}){const M=()=>{n(""),a(""),o({}),i(new Set),v()};return b?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20",children:e.jsx("div",{className:"bg-background border border-border rounded-lg shadow-lg w-full max-w-md mx-4",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Search"}),e.jsx("button",{onClick:k,className:"p-1 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search",value:t,onChange:_=>{const P=_.target.value;n(P),P.trim()===""&&(a(""),o({}),i(new Set))},onKeyDown:_=>{_.key==="Enter"&&(S(),k())},className:"w-full px-3 py-2 pr-10 text-sm border border-input bg-background text-foreground rounded focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",autoFocus:!0}),(t||r)&&e.jsx("button",{onClick:M,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",title:"Clear search",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(D.length>1||O.length>1)&&e.jsxs("div",{className:"mb-4 space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Search Filters"}),D.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Watch Directories"}),e.jsxs(Pe,{modal:!1,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs("button",{className:"w-full inline-flex items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[d.length===D.length||d.length===0?"All Directories":`${d.length} Director${d.length===1?"y":"ies"}`,e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(He,{align:"start",className:"w-80",children:[e.jsx(gt,{children:"Watch Directories"}),e.jsx(Ke,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Ze,{checked:d.length===D.length,onCheckedChange:_=>{u(_?[...D]:[])},children:"Select All"}),e.jsx(Ke,{}),D.map(_=>e.jsx(Ze,{checked:d.includes(_),onCheckedChange:P=>{u(P?[...d,_]:d.filter(N=>N!==_))},children:e.jsx("span",{className:"truncate",title:_,children:_.split("/").pop()||_})},_))]})]})]})]}),O.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Transcript Sources"}),e.jsxs(Pe,{modal:!1,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs("button",{className:"w-full inline-flex items-center justify-between whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[R.length===O.length?"All Sources":R.length===0?"No Sources":`${R.length} Source${R.length===1?"":"s"}`,e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(He,{align:"start",className:"w-80",children:[e.jsx(gt,{children:"Sources"}),e.jsx(Ke,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Ze,{checked:R.length===O.length,onCheckedChange:_=>{$(_?[...O]:[])},children:"Select All"}),e.jsx(Ke,{}),O.map(_=>e.jsx(Ze,{checked:R.includes(_),onCheckedChange:P=>{$(P?[...R,_]:R.filter(N=>N!==_))},children:_},_))]})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{S(),k()},disabled:j,className:"flex-1 px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:`w-4 h-4 ${j?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",strokeWidth:2}),e.jsx("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21",strokeWidth:2,strokeLinecap:"round"})]}),"Search"]}),e.jsx("button",{onClick:M,className:"px-4 py-2 text-sm border border-red-300 bg-red-50 text-red-700 rounded hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Clear"}),e.jsx("button",{onClick:k,className:"px-4 py-2 text-sm border border-input bg-background text-foreground rounded hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring",children:"Cancel"})]})]})})}):null}function Pn({show:t,searchTerm:n,setSearchTerm:r,activeSearchTerm:a,setActiveSearchTerm:o,setSearchLineNumbers:i,setExpandedFiles:j,isSearching:b,queue:k,isAtTop:S,clipStart:v,clipEnd:d,mobileClipPlayerComponent:u,selectedWatchDirs:D,setSelectedWatchDirs:R,availableWatchDirs:$,selectedSources:O,setSelectedSources:M,availableSources:_,showAllFiles:P,onToggleShowAllFiles:N,onSearch:U,onClearSearch:q,onScrollToTop:f,onConfigClick:p,onQueueClick:F,onPlayClip:H}){const[x,y]=m.useState(!1),c=Qt(),V=()=>{r(""),o(""),i({}),j(new Set),q()};return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:`fixed top-0 left-0 right-0 bg-background/95 border-b border-border px-2 sm:px-4 z-10 backdrop-blur-sm ${c?"py-1":"py-2"}`,children:e.jsx("div",{className:"w-full",children:c?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-center gap-1",children:[e.jsx("div",{className:"flex items-center flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-lg",children:"atci"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(pe,{onClick:p,variant:"ghost",size:"sm",className:"px-2 py-1 rounded hover:bg-accent group text-xs gap-1",title:"Edit configuration",children:[e.jsx("svg",{className:"w-4 h-4 group-hover:animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"})}),e.jsx("span",{children:"Config"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(pe,{onClick:F,variant:"ghost",size:"sm",className:"px-2 py-1 rounded hover:bg-accent text-xs gap-1",title:"View processing queue",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),e.jsx("span",{children:"Queue"})]}),k.length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1",children:k.length})]}),e.jsxs(pe,{onClick:H,disabled:v==null||d===null||d===void 0||!H||u!==null,variant:"ghost",size:"sm",className:"px-2 py-1 rounded hover:bg-accent disabled:opacity-50 disabled:cursor-not-allowed text-xs gap-1",title:u!==null?"Clip player is already open":v!=null&&d!==null&&d!==void 0?"Play Clip":"No clip selected",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),e.jsx("span",{children:"Clip"})]})]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"looking for something?",value:n,onChange:T=>{const X=T.target.value;r(X),X.trim()===""&&(o(""),i({}),j(new Set))},onKeyDown:T=>T.key==="Enter"&&U(),className:"w-full px-3 py-1.5 bg-muted text-foreground text-sm rounded-full border border-border focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),(n||a)&&e.jsx("button",{onClick:V,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-0.5 text-muted-foreground hover:text-foreground transition-colors rounded-full hover:bg-accent",title:"Clear search",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx(pe,{onClick:()=>{P&&N(),U()},disabled:b,variant:P&&!a?"secondary":"default",className:`px-3 py-1.5 rounded-full text-sm font-medium disabled:opacity-50 ${P&&!a?"":"bg-primary hover:bg-primary/90 text-primary-foreground"}`,children:b?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",strokeWidth:2}),e.jsx("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21",strokeWidth:2,strokeLinecap:"round"})]}):"Search"}),e.jsx(pe,{onClick:()=>{V(),P||N(),f()},variant:P&&!a?"default":"secondary",className:"px-3 py-1.5 rounded-full text-sm font-medium",children:"All"})]})]}):e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("div",{className:"flex items-center flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-lg",children:"atci"})}),e.jsx("div",{className:"flex-1 max-w-md mx-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"looking for something?",value:n,onChange:T=>{const X=T.target.value;r(X),X.trim()===""&&(o(""),i({}),j(new Set))},onKeyDown:T=>T.key==="Enter"&&U(),className:"w-full px-4 py-2 bg-muted text-foreground rounded-full border border-border focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),(n||a)&&e.jsx("button",{onClick:V,className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 text-muted-foreground hover:text-foreground transition-colors rounded-full hover:bg-accent",title:"Clear search",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"flex gap-1 items-center flex-shrink-0",children:[e.jsx(pe,{onClick:()=>{P&&N(),U()},disabled:b,variant:P&&!a?"secondary":"default",className:`px-4 py-2 rounded-full text-sm font-medium disabled:opacity-50 ${P&&!a?"":"bg-primary hover:bg-primary/90 text-primary-foreground"}`,children:b?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"11",cy:"11",r:"7",strokeWidth:2}),e.jsx("line",{x1:"16.5",y1:"16.5",x2:"21",y2:"21",strokeWidth:2,strokeLinecap:"round"})]}):"Search"}),e.jsx(pe,{onClick:()=>{V(),P||N(),f()},variant:P&&!a?"default":"secondary",className:"px-4 py-2 rounded-full text-sm font-medium",children:"All"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{onClick:F,variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-accent",title:"View processing queue",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})}),k.length>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full min-w-[18px] h-[18px] flex items-center justify-center px-1",children:k.length})]}),e.jsx(pe,{variant:"ghost",size:"sm",onClick:()=>{S||f()},disabled:S,title:S?"Already at top":"Scroll to top",className:"p-2 rounded-full hover:bg-accent disabled:opacity-50",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}),e.jsx(pe,{onClick:p,variant:"ghost",size:"sm",className:"p-2 rounded-full hover:bg-accent group",title:"Edit configuration",children:e.jsx("svg",{className:"w-5 h-5 group-hover:animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"})})})]})]})})}),e.jsx(An,{searchTerm:n,setSearchTerm:r,activeSearchTerm:a,setActiveSearchTerm:o,setSearchLineNumbers:i,setExpandedFiles:j,isSearching:b,isOpen:x,onClose:()=>y(!1),onSearch:U,onClearSearch:q,selectedWatchDirs:D,setSelectedWatchDirs:R,availableWatchDirs:$,selectedSources:O,setSelectedSources:M,availableSources:_})]})}const Mt=({isOpen:t,filename:n,transcriptInitialValue:r,onTranscriptSave:a,onCancel:o,isTranscriptSubmitting:i,transcriptTargetLineNumber:j})=>{const[b,k]=h.useState(r),S=h.useRef(null);h.useEffect(()=>{t&&k(r)},[t,r]),h.useEffect(()=>{t&&j&&S.current&&setTimeout(()=>{const d=S.current;if(!d)return;const u=d.value.split(`
`);if(j<=u.length){let D=0;for(let O=0;O<j-1;O++)D+=u[O].length+1;d.setSelectionRange(D,D),d.focus();const R=d.scrollHeight/u.length,$=(j-1)*R;d.scrollTop=$-d.clientHeight/2}},100)},[t,j]);const v=()=>{a(b)};return t?e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-card border border-border rounded-lg max-w-5xl w-full mx-4 max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:["Edit Transcript - ",n]}),e.jsx("button",{onClick:o,className:"p-1 text-muted-foreground hover:text-foreground hover:bg-accent rounded transition-colors",title:"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-md font-medium text-foreground",children:"Transcript (.txt)"}),e.jsx("button",{onClick:v,disabled:i,className:"px-3 py-1.5 text-xs font-normal text-primary-foreground bg-primary border border-transparent rounded hover:bg-primary/90 disabled:opacity-50 transition-colors",children:i?"Saving...":"Save Transcript"})]}),e.jsx("textarea",{ref:S,value:b,onChange:d=>k(d.target.value),className:"w-full h-64 p-3 border border-input bg-background text-foreground rounded-md font-mono text-sm leading-6 focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent",placeholder:"Enter transcript content...",readOnly:i})]})})]})}):null},Ht=({open:t,onOpenChange:n,selectedTime:r,clipStart:a,clipEnd:o,clipTranscript:i,currentTranscript:j,onSetClipStart:b,onSetClipEnd:k,onClearClip:S,onClipBlock:v,blockStartTime:d,blockEndTime:u,children:D})=>{const R=i!==null&&i!==j,$=!R&&o!==null&&r>=o,O=!R&&a!==null&&r<=a;return e.jsxs(Pe,{modal:!1,open:t,onOpenChange:n,children:[e.jsx(Fe,{asChild:!0,children:D}),e.jsxs(He,{align:"start",side:"right",sideOffset:8,children:[e.jsxs(ge,{onClick:()=>b(r),disabled:$,className:`flex items-center gap-2 ${$?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(jt,{size:16,className:"text-green-600"}),"Set Clip Start"]}),e.jsxs(ge,{onClick:()=>k(r),disabled:O,className:`flex items-center gap-2 ${O?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(jt,{size:16,className:"text-red-600"}),"Set Clip End"]}),v&&d!==void 0&&u!==void 0&&e.jsxs(ge,{onClick:()=>v(d,u),className:"flex items-center gap-2",children:[e.jsx(jt,{size:16,className:"text-purple-600"}),"Clip Block"]}),(a!==null||o!==null)&&e.jsxs(ge,{onClick:S,className:"flex items-center gap-2",children:[e.jsx(Mn,{size:16,className:"text-gray-600"}),"Clear Clip"]})]})]})},Fn=h.memo(({startTime:t,endTime:n,visible:r,text:a,name:o,fullPath:i,isSearchResult:j=!1,lineNumbers:b,onEditSuccess:k,fullTranscript:S="",isSmallScreen:v=!1,onSetRightPaneUrl:d,clipStart:u,clipEnd:D,clipTranscript:R,onSetClipStart:$,onSetClipEnd:O,onClearClip:M,onClipBlock:_})=>{const[P,N]=h.useState(!1),[U,q]=h.useState(!1),[f,p]=h.useState(!1),[F,H]=h.useState(null),[x,y]=h.useState(null),[c,V]=h.useState(!1),[T,X]=h.useState(null),E=g=>{const l=g.split(":"),W=parseInt(l[0],10),ce=parseInt(l[1],10),ie=l[2].split("."),Se=parseInt(ie[0],10),$e=parseInt(ie[1]||"0",10);return W*3600+ce*60+Se+$e/1e3},te=h.useMemo(()=>{if(!t||!n||u===null||u===void 0||R!==o)return!1;const g=E(t),l=E(n);return u>=g&&u<=l},[t,n,u,R,o]),Z=h.useMemo(()=>{if(!t||!n||D===null||D===void 0||R!==o)return!1;const g=E(t),l=E(n);return D>=g&&D<=l},[t,n,D,R,o]),be=h.useMemo(()=>{if(!t||!n||u===null||u===void 0||D===null||D===void 0||R!==i)return!1;const g=E(t),l=E(n);return g>=u&&l<=D},[t,n,u,D,R,o]),ee=te||Z||be,he=(g,l)=>{X({time:g,type:l}),V(!0)};if(h.useEffect(()=>{},[a]),h.useEffect(()=>{},[t,n]),h.useEffect(()=>{const g=l=>{const W=l.target;if(W.classList.contains("timestamp-link")){l.preventDefault();const ce=W.getAttribute("data-url");ce&&d&&d(ce)}};return document.addEventListener("click",g),()=>{document.removeEventListener("click",g)}},[d]),!r||a==="WEBVTT")return null;const oe=h.useMemo(()=>{const g=/(\d{2}:\d{2}:\d{2}\.\d{3})/g;return a.replace(g,l=>{const W=E(l);return`<span class="text-sky-700 hover:text-sky-600 underline cursor-pointer timestamp-link" data-timestamp="${l}" data-url="/player/${encodeURIComponent(o)}?time=${W}">${l}</span>`})},[a,o]),ve=()=>{N(!0)},ue=async g=>{var l;if(g.trim()===S.trim()){N(!1);return}q(!0);try{const W=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"),ce=await fetch(Ae("/api/transcripts/replace"),{method:"POST",headers:{"X-CSRF-Token":W||"","Content-Type":"application/json"},body:JSON.stringify({video_path:o,new_content:g})});if(ce.ok)k&&k(),N(!1);else{const ie=await ce.json();alert(`Error: ${ie.error||"Failed to update transcript"}`)}}catch(W){console.error("Error updating transcript:",W),alert("Error: Failed to update transcript. Please try again.")}finally{q(!1)}},se=()=>{N(!1)},me=()=>{p(!0)},ne=async g=>{var l;if(g.trim()===S.trim()){p(!1);return}q(!0);try{const W=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"),ce=await fetch(Ae("/api/transcripts/replace"),{method:"POST",headers:{"X-CSRF-Token":W||"","Content-Type":"application/json"},body:JSON.stringify({video_path:i,new_content:g})});if(ce.ok)k&&k(),p(!1);else{const ie=await ce.json();alert(`Error: ${ie.error||"Failed to update timestamp"}`)}}catch(W){console.error("Error updating timestamp:",W),alert("Error: Failed to update timestamp. Please try again.")}finally{q(!1)}},ke=()=>{p(!1)};if(t&&n&&t===n)return e.jsx(e.Fragment,{});const G=b[0],le=b[b.length-1],C=()=>{const g=[];return j&&ee?g.push("bg-gradient-to-r","from-primary/10","to-amber-500/10","border-l-4","border-primary","pl-2"):j?g.push("bg-primary/10","border-l-4","border-primary","pl-2"):ee&&g.push("bg-amber-500/10","border-l-4","border-amber-500","pl-2"),g.join(" ")};return e.jsxs("div",{className:C(),children:[ee&&e.jsx("div",{className:"flex items-center gap-1 text-xs text-amber-600 dark:text-amber-400 mb-1",children:e.jsx("span",{className:"bg-amber-500/20 px-1 py-0.5 rounded text-amber-700 dark:text-amber-300 font-medium",children:"Clip"})}),t&&n&&e.jsx("div",{className:"group",children:e.jsxs("span",{className:"relative",children:[e.jsx("div",{className:"flex items-center gap-1 min-w-0",children:e.jsxs("div",{className:"text-muted-foreground text-sm font-mono flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:`text-xs mr-2 flex-shrink-0 text-right w-8 cursor-pointer transition-colors duration-200 ${F===G||x==="timestamp"?"text-blue-600 hover:text-blue-700":"text-muted-foreground hover:text-blue-500"}`,onClick:()=>y(x==="timestamp"?null:"timestamp"),onMouseEnter:()=>H(G),onMouseLeave:()=>H(null),children:G}),e.jsxs("span",{className:"min-w-0",children:[e.jsx(Ht,{open:c&&(T==null?void 0:T.type)==="start",onOpenChange:g=>{V(g),g||X(null)},selectedTime:(T==null?void 0:T.time)||(t?E(t):0),clipStart:u??null,clipEnd:D??null,clipTranscript:R??null,currentTranscript:o,onSetClipStart:$||(()=>{}),onSetClipEnd:O||(()=>{}),onClearClip:M||(()=>{}),onClipBlock:_?(g,l)=>_(g,l,a,i):void 0,blockStartTime:t?E(t):void 0,blockEndTime:n?E(n):void 0,children:e.jsx("span",{onClick:()=>t&&he(E(t),"start"),className:"text-sky-700 hover:text-sky-600 underline cursor-pointer",onMouseEnter:()=>H(G),onMouseLeave:()=>H(null),children:t})})," --> ",e.jsx(Ht,{open:c&&(T==null?void 0:T.type)==="end",onOpenChange:g=>{V(g),g||X(null)},selectedTime:(T==null?void 0:T.time)||(n?E(n):0),clipStart:u??null,clipEnd:D??null,clipTranscript:R??null,currentTranscript:o,onSetClipStart:$||(()=>{}),onSetClipEnd:O||(()=>{}),onClearClip:M||(()=>{}),onClipBlock:_?(g,l)=>_(g,l,a,i):void 0,blockStartTime:t?E(t):void 0,blockEndTime:n?E(n):void 0,children:e.jsx("span",{onClick:()=>n&&he(E(n),"end"),className:"text-sky-700 hover:text-sky-600 underline cursor-pointer",onMouseEnter:()=>H(G),onMouseLeave:()=>H(null),children:n})})]})]})}),e.jsx("div",{className:"flex items-center gap-1 min-w-0",children:e.jsxs("div",{className:"text-muted-foreground text-sm font-mono flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:`text-xs mr-2 flex-shrink-0 text-right w-8 cursor-pointer transition-colors duration-200 ${F===le||x==="content"?"text-blue-600 hover:text-blue-700":"text-muted-foreground hover:text-blue-500"}`,onClick:()=>y(x==="content"?null:"content"),onMouseEnter:()=>H(le),onMouseLeave:()=>H(null),children:le}),e.jsx("div",{className:"text-foreground font-mono text-sm leading-relaxed whitespace-pre-wrap break-words flex-1 min-w-0",dangerouslySetInnerHTML:{__html:oe},onMouseEnter:()=>H(le),onMouseLeave:()=>H(null)})]})}),x&&e.jsx("div",{className:"absolute left-0 top-0 z-10 dropdown-menu-container",children:e.jsxs(Pe,{modal:!1,open:x==="timestamp"||x==="content",onOpenChange:g=>!g&&y(null),children:[e.jsx(Fe,{asChild:!0,children:e.jsx("div",{className:"invisible"})}),e.jsxs(He,{align:"start",side:"right",sideOffset:8,children:[e.jsx(ge,{asChild:!0,children:e.jsxs("a",{href:`/api/frame?filename=${encodeURIComponent(i)}&time=${E(t)+(E(n)-E(t))/2}&text=${encodeURIComponent(a)}`,target:"_blank",className:"flex items-center gap-2 w-full",children:[e.jsx(_n,{size:16,className:"text-[#6d28d9]"}),"View Frame"]})}),e.jsxs(ge,{onClick:()=>me(),className:"flex items-center gap-2",children:[e.jsx(Pt,{size:16,className:"text-[#3b82f6]"}),"Edit Line"]})]})]})})]})}),a!=null&&!t&&!n&&e.jsx("div",{className:"group",children:e.jsxs("span",{className:"relative",children:[e.jsx("div",{className:"flex items-center gap-1 min-w-0",children:e.jsxs("div",{className:"text-muted-foreground text-sm font-mono flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:`text-xs mr-2 flex-shrink-0 text-right w-8 cursor-pointer transition-colors duration-200 ${F===le||x==="content"?"text-blue-600 hover:text-blue-700":"text-muted-foreground hover:text-blue-500"}`,onClick:()=>y(x==="content"?null:"content"),onMouseEnter:()=>H(le),onMouseLeave:()=>H(null),children:le}),e.jsx("div",{className:"text-foreground font-mono text-sm leading-relaxed whitespace-pre-wrap break-words flex-1 min-w-0",dangerouslySetInnerHTML:{__html:oe},onMouseEnter:()=>H(le),onMouseLeave:()=>H(null)})]})}),x==="content"&&e.jsx("div",{className:"absolute left-0 top-0 z-10 dropdown-menu-container",children:e.jsxs(Pe,{modal:!1,open:!0,onOpenChange:g=>!g&&y(null),children:[e.jsx(Fe,{asChild:!0,children:e.jsx("div",{className:"invisible"})}),e.jsx(He,{align:"start",side:"right",sideOffset:8,children:e.jsxs(ge,{onClick:ve,className:"flex items-center gap-2",children:[e.jsx(Pt,{size:16,className:"text-[#3b82f6]"}),"Edit Line"]})})]})})]})}),e.jsx(Mt,{isOpen:P,filename:i,transcriptInitialValue:S,onTranscriptSave:ue,onCancel:se,isTranscriptSubmitting:U,transcriptTargetLineNumber:le}),e.jsx(Mt,{isOpen:f,filename:i,transcriptInitialValue:S,onTranscriptSave:ne,onCancel:ke,isTranscriptSubmitting:U,transcriptTargetLineNumber:G})]})}),Jt=({visible:t=!1,name:n,fullPath:r,className:a="",searchTerm:o="",text:i="",loading:j=!1,error:b=null,visibleLines:k=[],expandContext:S,onEditSuccess:v,isSmallScreen:d=!1,onSetRightPaneUrl:u,clipStart:D,clipEnd:R,clipTranscript:$,onSetClipStart:O,onSetClipEnd:M,onClearClip:_,onClipBlock:P})=>{const N=h.useRef(null),U=x=>{const y=/\d{2}:\d{2}:\d{2}\.\d{3}/g,c=x.match(y);return c&&c.length>=2&&x.includes("-->")?{hasRange:!0,time1:c[0],time2:c[1]}:{hasRange:!1}},q=(x,y)=>{const c=x.split(`
`).flatMap(E=>E.split("\r")),V=[],T=o.toLowerCase(),X=y.length===1&&y[0]===-1||y.length===0;for(let E=0;E<c.length;E++){const te=c[E],Z=U(te);if(Z.hasRange&&Z.time1&&Z.time2){const be=E<c.length-1?c[E+1]:"",ee=be.toLowerCase(),he=o?ee.includes(T):!1,oe=[E+1,E+2],ve=X||oe.some(ue=>y.includes(ue));V.push({startTime:Z.time1,endTime:Z.time2,text:be,visible:ve,isSearchResult:he,originalIndex:V.length,lineNumbers:oe}),E++}else{const be=te.toLowerCase(),ee=o?be.includes(T):!1,he=[E+1],oe=X||he.some(ve=>y.includes(ve));V.push({text:te,visible:oe,isSearchResult:ee,originalIndex:V.length,lineNumbers:he})}}return V},f=h.useMemo(()=>q(i,k),[i,k,o]),p=h.useMemo(()=>{const x=k.length===1&&k[0]===-1;if(k.length===0||x)return f.map(V=>({type:"block",data:V}));const y=[];let c=0;for(let V=0;V<f.length;V++){const T=f[V];if(T.visible){c>0&&(y.push({type:"message",data:{count:c,line:T.lineNumbers[T.lineNumbers.length-1],direction:"up"}}),c=0),y.push({type:"block",data:T});let X=0;for(let E=V+1;E<f.length;E++){const te=f[E];if(te.visible)break;X+=te.lineNumbers.length}X>0&&y.push({type:"message",data:{count:X,line:T.lineNumbers[T.lineNumbers.length-1],direction:"down"}})}else c+=T.lineNumbers.length}return y},[f,k]),F=h.useMemo(()=>p.map((x,y)=>({...x,virtualIndex:y,originalIndex:y})),[p]),H=(x,y)=>{S(r,y,x)};return t?e.jsx("div",{className:`w-full ${d?"px-4 py-4 bg-transparent":"p-3 sm:p-6 bg-card border border-border"} ${a}`,children:e.jsxs("div",{className:"space-y-4",children:[j&&e.jsx("div",{className:"text-muted-foreground",children:"Loading transcript..."}),b&&e.jsxs("div",{className:"text-destructive",children:["Error: ",b]}),!j&&!b&&e.jsxs("div",{className:"text-muted-foreground text-left relative",children:[o&&f.filter(x=>x.isSearchResult).length===0&&e.jsxs("div",{className:"text-muted-foreground italic",children:['No matches found for "',o,'" in this transcript.']}),f.length>0&&e.jsx("div",{ref:N,className:"space-y-0.5 max-h-[600px] overflow-y-auto",style:{WebkitOverflowScrolling:"touch",scrollBehavior:"smooth"},children:F.map(x=>e.jsx("div",{children:x.type==="block"?e.jsx(Fn,{fullPath:r,startTime:x.data.startTime,endTime:x.data.endTime,visible:x.data.visible,text:x.data.text,name:n,isSearchResult:x.data.isSearchResult,lineNumbers:x.data.lineNumbers,onEditSuccess:v,fullTranscript:i,isSmallScreen:d,onSetRightPaneUrl:u,clipStart:D,clipEnd:R,clipTranscript:$,onSetClipStart:O,onSetClipEnd:M,onClearClip:_,onClipBlock:P}):e.jsx("div",{className:"text-muted-foreground italic",children:e.jsxs("span",{className:"cursor-pointer hover:text-primary hover:underline",onClick:()=>H(x.data.line,x.data.direction),children:["[",x.data.count," lines ",x.data.direction==="up"?"above":"below","]"]})})},x.type==="block"?`${x.data.originalIndex}-${x.virtualIndex}`:`message-${x.virtualIndex}`))})]})]})}):null},vt=m.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:Ee("rounded-xl border bg-card text-card-foreground shadow",t),...n}));vt.displayName="Card";const Kt=m.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:Ee("flex flex-col space-y-1.5 p-6",t),...n}));Kt.displayName="CardHeader";const Hn=m.forwardRef(({className:t,...n},r)=>e.jsx("h3",{ref:r,className:Ee("font-semibold leading-none tracking-tight",t),...n}));Hn.displayName="CardTitle";const zn=m.forwardRef(({className:t,...n},r)=>e.jsx("p",{ref:r,className:Ee("text-sm text-muted-foreground",t),...n}));zn.displayName="CardDescription";const wt=m.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:Ee("p-6 pt-0",t),...n}));wt.displayName="CardContent";const Zt=m.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:Ee("flex items-center p-6 pt-0",t),...n}));Zt.displayName="CardFooter";function _t({isOpen:t,videoPath:n,source:r,onClose:a,onRegenerate:o}){var U,q;const[,i]=m.useState([]),[,j]=m.useState([]),[b,k]=m.useState([]),[S,v]=m.useState(""),[d,u]=m.useState(!1),[D,R]=m.useState(null),[$,O]=m.useState(!1),M=f=>{if(!r)return!1;if(f.type==="subtitle"){const p=r.match(/subtitles.*\((\d+)\)/);return!!(p&&parseInt(p[1])===f.subtitle_stream_index)}else if(f.type==="whisper")return r===f.model;return!1};m.useEffect(()=>{t&&n&&_()},[t,n]);const _=async()=>{u(!0),R(null);try{const[f,p]=await Promise.all([fetch(Ae(`/api/video/subtitle-streams?path=${encodeURIComponent(n)}`)),fetch(Ae("/api/models/list"))]);let F=[],H=[];if(f.ok){const y=await f.json();y.success&&(F=y.data)}if(p.ok){const y=await p.json();y.success&&(H=y.data.filter(c=>c.downloaded))}i(F),j(H);const x=[];F.forEach(y=>{const c=y.language||"Unknown",V={id:`subtitle_${y.index}`,type:"subtitle",label:`Subtitles: ${c} (${y.index})`,subtitle_stream_index:y.index};M(V)&&(V.label+=" (last used)"),x.push(V)}),H.forEach(y=>{const c={id:`whisper_${y.name}`,type:"whisper",label:`Whisper Model: ${y.name}`,model:y.name};M(c)&&(c.label+=" (last used)"),x.push(c)}),k(x),v("")}catch(f){console.error("Error fetching regeneration data:",f),R("Failed to load regeneration options")}finally{u(!1)}},P=async()=>{if(!S)return;const f=b.find(p=>p.id===S);if(f){O(!0);try{await o(f.type==="whisper"?f.model:void 0,f.type==="subtitle"?f.subtitle_stream_index:void 0),a()}catch(p){console.error("Regeneration failed:",p),R("Failed to regenerate transcript")}finally{O(!1)}}},N=()=>{$||a()};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg p-6 w-96 max-w-90vw max-h-80vh overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Regenerate Transcript"}),e.jsx("button",{onClick:N,disabled:$,className:"text-muted-foreground hover:text-foreground disabled:opacity-50",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Choose a processing method for: ",((U=n.split("/").pop())==null?void 0:U.split("\\").pop())||n]}),d&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Loading options..."]})}),D&&e.jsx("div",{className:"text-sm text-destructive mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded",children:D}),!d&&!D&&b.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground mb-4 p-3 bg-muted border border-border rounded",children:"No processing options available. Make sure you have subtitle streams or downloaded Whisper models."}),!d&&!D&&b.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Processing Method:"}),e.jsxs(Pe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(pe,{variant:"outline",className:"w-full justify-between",disabled:$,children:[S&&((q=b.find(f=>f.id===S))==null?void 0:q.label)||"Select a processing method...",e.jsx("svg",{className:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsx(He,{className:"w-full min-w-[400px]",children:b.map(f=>e.jsxs(ge,{onClick:()=>v(f.id),className:"flex flex-col items-start p-3",children:[e.jsx("div",{className:"font-medium",children:f.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:f.type==="subtitle"?"Extract from embedded subtitles":"AI transcription"})]},f.id))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:N,disabled:$,className:"px-4 py-2 text-sm border border-input bg-background text-foreground rounded hover:bg-accent focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{onClick:P,disabled:$||!S,className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:$?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerating..."]}):"Regenerate"})]})]})]})}):null}function Wn({file:t,onExpand:n,isExpanded:r,isRegenerating:a,isReplacing:o,isProcessing:i,onRegenerate:j,onReplace:b,onRename:k,onRegenerateMeta:S,formatDate:v,getSourceChipColor:d,isSmallScreen:u=!1,mobileTranscriptRowRefs:D}){var N;const[R,$]=m.useState(!1),O=((N=t.name.split("/").pop())==null?void 0:N.split("\\").pop())||t.name,M=U=>{U.stopPropagation(),$(!0)},_=async(U,q)=>{await j({stopPropagation:()=>{}},U,q)};if(u){const U=e.jsxs("div",{className:"w-full bg-background py-4 px-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1 mr-2 min-w-0 text-left",id:"ref",ref:q=>{D.current[t.base_name]=q},children:[e.jsx("h3",{className:"font-medium text-base break-all overflow-hidden text-left",title:t.name,children:O}),t.source&&e.jsx("div",{className:"text-left",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2 ${d(t.source)}`,children:t.source})})]}),e.jsxs(Pe,{modal:!1,children:[e.jsx(Fe,{asChild:!0,children:e.jsx("button",{onClick:q=>q.stopPropagation(),className:"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Actions",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(He,{align:"end",children:[e.jsxs(ge,{onClick:q=>k(q),disabled:i||a||o,children:[e.jsx("span",{children:"Rename"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})]}),t.transcript&&e.jsxs(ge,{onClick:q=>b(q),disabled:o,className:"text-blue-600 hover:text-blue-700",children:[e.jsx("span",{children:"Edit transcript"}),!o&&e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})]}),t.transcript&&e.jsxs(ge,{onClick:M,disabled:a,className:"text-green-600 hover:text-green-700",children:[e.jsx("span",{children:"Regenerate transcript"}),a?e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),i&&e.jsxs(ge,{disabled:!0,children:[e.jsx("span",{children:"Processing transcript..."}),e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]})]})]})]}),e.jsx("div",{className:"space-y-3 mb-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Date:"}),e.jsx("div",{className:"font-medium break-words text-xs",children:v(t.created_at)})]}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Last Generated:"}),e.jsx("div",{className:"font-medium break-words text-xs",children:v(t.last_generated||"")})]}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Lines:"}),e.jsx("div",{className:"font-medium text-xs",children:t.line_count||0})]}),e.jsxs("div",{className:"min-w-0 text-left",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Length:"}),e.jsx("div",{className:"font-medium flex items-center gap-1 text-xs",children:t.length?t.length:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"-"}),e.jsx("button",{onClick:q=>S(q),disabled:a,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate video length",children:a?e.jsx("svg",{className:"w-3 h-3 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]})]})}),t.transcript&&e.jsx("button",{onClick:n,className:"w-full px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),"Hide Transcript"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Show Transcript"]})})]});return e.jsxs(e.Fragment,{children:[U,e.jsx(_t,{isOpen:R,videoPath:t.full_path||t.name,source:t.source,onClose:()=>$(!1),onRegenerate:_})]})}const P=e.jsxs(vt,{className:"w-full",children:[e.jsx(Kt,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 mr-2 min-w-0",children:[e.jsx("h3",{className:"font-medium text-base break-all overflow-hidden",title:t.name,children:O}),t.source&&e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2 ${d(t.source)}`,children:t.source})]}),e.jsxs(Pe,{modal:!1,children:[e.jsx(Fe,{asChild:!0,children:e.jsx("button",{onClick:U=>U.stopPropagation(),className:"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Actions",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(He,{align:"end",children:[e.jsxs(ge,{onClick:U=>k(U),disabled:i||a||o,children:[e.jsx("span",{children:"Rename"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})]}),t.transcript&&e.jsxs(ge,{onClick:U=>b(U),disabled:o,className:"text-blue-600 hover:text-blue-700",children:[e.jsx("span",{children:"Edit transcript"}),!o&&e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})]}),t.transcript&&e.jsxs(ge,{onClick:M,disabled:a,className:"text-green-600 hover:text-green-700",children:[e.jsx("span",{children:"Regenerate transcript"}),a?e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),i&&e.jsxs(ge,{disabled:!0,children:[e.jsx("span",{children:"Processing transcript..."}),e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]})]})]})]})}),e.jsx(wt,{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"}),e.jsx("div",{className:"font-medium break-words",children:v(t.created_at)})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Generated:"}),e.jsx("div",{className:"font-medium break-words",children:v(t.last_generated||"")})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Lines:"}),e.jsx("div",{className:"font-medium",children:t.line_count||0})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-muted-foreground",children:"Length:"}),e.jsx("div",{className:"font-medium flex items-center justify-center gap-1",children:t.length?t.length:e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"-"}),e.jsx("button",{onClick:U=>S(U),disabled:a,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate video length",children:a?e.jsx("svg",{className:"w-3 h-3 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]})]})}),t.transcript&&e.jsx(Zt,{className:"pt-3",children:e.jsx("button",{onClick:n,className:"w-full px-4 py-2 text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 rounded-md transition-colors flex items-center justify-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),"Hide Transcript"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),"Show Transcript"]})})})]});return e.jsxs(e.Fragment,{children:[P,e.jsx(_t,{isOpen:R,videoPath:t.full_path||t.name,source:t.source,onClose:()=>$(!1),onRegenerate:_})]})}function Un({sortedFiles:t,activeSearchTerm:n,searchResults:r,showAllFiles:a,transcriptData:o,expandedFiles:i,searchLineNumbers:j,onExpandFile:b,onRegenerate:k,onReplace:S,onRename:v,onFetchTranscript:d,onSetRightPaneUrl:u,formatDate:D,getSourceChipColor:R,expandContext:$,clipStart:O,clipEnd:M,clipTranscript:_,onSetClipStart:P,onSetClipEnd:N,onClearClip:U,onClipBlock:q,mobileTranscriptRowRefs:f}){return e.jsx("div",{className:"divide-y divide-border",children:t.map(p=>{if(!(n?r.includes(p.full_path):a))return null;const H=o[p.full_path]||{text:"",loading:!1,error:null},x=i.has(p.full_path);return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{id:"ref",children:e.jsx(Wn,{file:p,onExpand:()=>b(p.full_path),isExpanded:x,isRegenerating:!p.transcript,isReplacing:!p.transcript,isProcessing:!1,onRegenerate:y=>k(p.full_path,p.source,y),onReplace:y=>S(p.full_path,y),onRename:y=>v(p.full_path,y),onRegenerateMeta:y=>k(p.full_path,p.source,y),formatDate:D,getSourceChipColor:R,isSmallScreen:!0,mobileTranscriptRowRefs:f})}),x&&e.jsx(Jt,{visible:!0,name:p.base_name,fullPath:p.full_path,className:"w-full",searchTerm:n,text:H.text,loading:H.loading,error:H.error,visibleLines:j[p.full_path]||[],expandContext:$,onEditSuccess:()=>{d(p.full_path)},isSmallScreen:!0,onSetRightPaneUrl:u,clipStart:O,clipEnd:M,clipTranscript:_,onSetClipStart:y=>P(y,p.full_path),onSetClipEnd:y=>N(y,p.full_path),onClearClip:U,onClipBlock:q})]},p.base_name)})})}function Vn({watchDirectory:t,isSmallScreen:n,activeSearchTerm:r,searchLineNumbers:a,setSearchLineNumbers:o,expandedFiles:i,setExpandedFiles:j,transcriptData:b,setTranscriptData:k,currentProcessingFile:S,showAllFiles:v,leftPaneWidth:d,setLeftPaneWidth:u,isLeftPaneWidthMeasured:D,setIsLeftPaneWidthMeasured:R,clipStart:$,clipEnd:O,clipTranscript:M,fileRowRefs:_,transcriptRowRefs:P,mobileTranscriptRowRefs:N,leftPaneRef:U,onSetRightPaneUrl:q,onSetClipStart:f,onSetClipEnd:p,onClearClip:F,onClipBlock:H}){var Ot;const{files:x,refreshFiles:y,selectedWatchDirs:c,setSelectedWatchDirs:V,availableWatchDirs:T,selectedSources:X,setSelectedSources:E,availableSources:te}=Gt(),[Z,be]=It("sortColumn","created_at"),[ee,he]=It("sortDirection","desc"),[oe,ve]=m.useState(!1),[ue,se]=m.useState(!1),[me,ne]=m.useState(""),[ke,G]=m.useState(""),[le,C]=m.useState(!1),[g,l]=m.useState(!1),[W,ce]=m.useState(""),[ie,Se]=m.useState(""),[$e,De]=m.useState(!1),[et,Oe]=m.useState(""),[je,ze]=m.useState(!1),[Be,Le]=m.useState(""),[at,Qe]=m.useState(void 0),ot=s=>{var w;return S?((w=S.video_path.split("/").pop())==null?void 0:w.replace(/\.(mp4|MP4)$/,""))===s:!1},Me=Object.keys(a).filter(s=>a[s]&&a[s].length>0),We=n||D&&d<753;m.useEffect(()=>{if(!U.current)return;const s=new ResizeObserver(L=>{for(const w of L)u(w.contentRect.width),R(!0)});return s.observe(U.current),()=>{s.disconnect()}},[u,R]),m.useEffect(()=>{B()},[i]);const _e=[...x].sort((s,L)=>{let w,I;switch(Z){case"created_at":w=s.created_at||"",I=L.created_at||"";break;case"last_generated":w=s.last_generated||"",I=L.last_generated||"";break;case"name":w=s.name||"",I=L.name||"";break;case"line_count":w=s.line_count||0,I=L.line_count||0;break;case"length":w=s.length||"0:00",I=L.length||"0:00";break;case"source":w=s.source||"",I=L.source||"";break;default:return 0}if(Z==="created_at"||Z==="last_generated"){const A=new Date(w.replace(" ","T")).getTime(),ae=new Date(I.replace(" ","T")).getTime();return ee==="asc"?A-ae:ae-A}return typeof w=="string"&&typeof I=="string"?ee==="asc"?w.localeCompare(I):I.localeCompare(w):ee==="asc"?w-I:I-w}),Ue=(s,L,w)=>{const I=a[s];if(!I)return;const A=[...I];if(L==="up")for(let ae=1;ae<=16;ae++){const K=w-ae;K>0&&!A.includes(K)&&A.push(K)}else for(let ae=1;ae<=16;ae++){const K=w+ae;A.includes(K)||A.push(K)}o(ae=>({...ae,[s]:A}))},Ve=s=>{Z===s?he(L=>L==="asc"?"desc":"asc"):(be(s),he("asc"))},qe=s=>Z!==s?e.jsx("svg",{className:"w-4 h-4 text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):ee==="asc"?e.jsx("svg",{className:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{className:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),z=s=>{if(!s)return"bg-gray-200 text-gray-700 dark:bg-gray-700 dark:text-gray-300";const L={tiny:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",base:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",small:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",medium:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",large:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",subtitles:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",manual:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200"};for(const[w,I]of Object.entries(L))if(s.includes(w))return I;return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"},re=(s,L=!0)=>{if(!s||s==="N/A")return"N/A";try{const w=new Date(s.replace(" ","T"));if(isNaN(w.getTime()))return"N/A";const I=(w.getMonth()+1).toString().padStart(2,"0"),A=w.getDate().toString().padStart(2,"0"),ae=w.getFullYear();if(!L)return`${I}-${A}-${ae}`;let K=w.getHours();const Ge=w.getMinutes().toString().padStart(2,"0"),it=K>=12?"pm":"am";return K=K%12,K=K||12,`${I}-${A}-${ae} ${K}:${Ge}${it}`}catch{return"N/A"}},Ne=async s=>{k(L=>({...L,[s]:{text:"",loading:!0,error:null}}));try{const L=await fetch(Ae(`/api/transcripts?video_path=${encodeURIComponent(s)}`));if(!L.ok)throw new Error(`Failed to fetch transcript: ${L.status} ${L.statusText}`);const w=await L.json();if(w.success){const I=w.data;k(A=>({...A,[s]:{text:I,loading:!1,error:null}}))}else throw new Error(`Failed to fetch transcript: ${w.error}`)}catch(L){k(w=>({...w,[s]:{text:"",loading:!1,error:L instanceof Error?L.message:"An unknown error occurred"}}))}},B=async()=>{const L=Array.from(i).filter(w=>{const I=b[w];return!I||!I.loading&&!I.text&&!I.error});await Promise.all(L.map(w=>Ne(w)))},J=(s,L,w)=>{w.stopPropagation(),Le(s),Qe(L),ze(!0)},Q=async(s,L)=>{await Y(Be,{stopPropagation:()=>{}},s,L)},Y=async(s,L,w,I)=>{var ae;L.stopPropagation();const A=(ae=document.querySelector('meta[name="csrf-token"]'))==null?void 0:ae.getAttribute("content");try{const K={video_path:s};w&&(K.model=w),I!==void 0&&(K.subtitle_stream_index=I);const Ge=await fetch(Ae("/api/transcripts/regenerate"),{method:"POST",headers:{"X-CSRF-Token":A||"","Content-Type":"application/json"},body:JSON.stringify(K)});if(Ge.ok)await y();else{const it=await Ge.json().catch(()=>({error:"Unknown error"}));console.error("Failed to regenerate transcript:",it.error),alert(`Failed to regenerate transcript: ${it.error}`)}}catch(K){console.error("Regeneration error:",K),alert("Error regenerating transcript. Please try again.")}},de=async(s,L)=>{L.stopPropagation();try{const w=await fetch(Ae(`/api/transcripts?video_path=${encodeURIComponent(s)}`));if(w.ok){const I=await w.json();if(I.success){const A=I.data;ne(s),G(A),se(!0)}else throw new Error(I.error)}else throw new Error("Failed to fetch transcript")}catch(w){console.error("Error fetching transcript for replacement:",w),alert("Error loading transcript. Please try again.")}finally{}},ye=async s=>{var L;C(!0);try{const w=(L=document.querySelector('meta[name="csrf-token"]'))==null?void 0:L.getAttribute("content"),I=await fetch(Ae("/api/transcripts/replace"),{method:"POST",headers:{"X-CSRF-Token":w||"","Content-Type":"application/json"},body:JSON.stringify({video_path:me,new_content:s})});if(I.ok)se(!1),ne(""),G(""),i.has(me)&&await Ne(me),await y();else{const A=await I.json().catch(()=>({error:"Unknown error"}));console.error("Failed to replace transcript:",A.error),alert(`Failed to replace transcript: ${A.error}`)}}catch(w){console.error("Replace transcript error:",w),alert("Error replacing transcript. Please try again.")}finally{C(!1)}},Ce=()=>{se(!1),ne(""),G("")},Ie=async(s,L)=>{var I;L.stopPropagation();const w=((I=s.split("/").pop())==null?void 0:I.split("\\").pop())||s;ce(s),Se(w),Oe(""),l(!0),setTimeout(()=>{const A=document.getElementById("new-filename");A&&A.select()},100)},Re=async()=>{var L,w;if(!ie.trim()){Oe("Filename cannot be empty");return}const s=((L=W.split("/").pop())==null?void 0:L.split("\\").pop())||W;if(ie===s){Oe("New filename must be different from current filename");return}if(/[\/\\]/.test(ie)){Oe("Filename cannot contain path separators");return}De(!0),Oe("");try{const I=(w=document.querySelector('meta[name="csrf-token"]'))==null?void 0:w.getAttribute("content"),A=W.split("/");A[A.length-1]=ie.trim();const ae=A.join("/"),K=await fetch(Ae("/api/transcripts/rename"),{method:"POST",headers:{"X-CSRF-Token":I||"","Content-Type":"application/json"},body:JSON.stringify({video_path:W,new_path:ae})});if(!K.ok){const Ge=await K.json();throw new Error(Ge.error||`Failed to rename file: ${K.status} ${K.statusText}`)}l(!1),ce(""),Se(""),await y()}catch(I){console.error("Error renaming file:",I),Oe(I instanceof Error?I.message:"An error occurred while renaming the file")}finally{De(!1)}},Ye=()=>{l(!1),ce(""),Se(""),Oe("")},Xe=s=>{V(L=>L.includes(s)?L.filter(I=>I!==s):[...L,s])},Te=()=>{V(T)},rt=()=>{V([])},ft=s=>{E(L=>L.includes(s)?L.filter(I=>I!==s):[...L,s])},fn=()=>{E(te)},hn=()=>{E([])},pn=s=>{j(L=>{const w=new Set(L);return w.has(s)?w.delete(s):w.add(s),w})},xn=async()=>{var ae;const s=_e.filter(K=>r&&!Me.includes(K.full_path)?!1:K.transcript);if(s.length===0){alert("No files with transcripts to regenerate");return}const L=X[0],w=s.length,I=`Regenerate ${w} file${w===1?"":"s"} using "${L}" source?`;if(!confirm(I))return;ve(!0);const A=(ae=document.querySelector('meta[name="csrf-token"]'))==null?void 0:ae.getAttribute("content");try{let K=0,Ge=0;(await Promise.allSettled(s.map(async st=>{const Bt=await fetch(Ae("/api/transcripts/regenerate"),{method:"POST",headers:{"X-CSRF-Token":A||"","Content-Type":"application/json"},body:JSON.stringify({video_path:st.full_path})});if(!Bt.ok){const gn=await Bt.json().catch(()=>({error:"Unknown error"}));throw new Error(`${st.full_path}: ${gn.error}`)}return st.full_path}))).forEach(st=>{st.status==="fulfilled"?K++:(Ge++,console.error("Bulk regeneration error:",st.reason))}),Ge>0?alert(`Bulk regeneration completed with ${K} successes and ${Ge} errors. Check console for details.`):alert(`Successfully queued ${K} files for regeneration`)}catch(K){console.error("Bulk regeneration error:",K),alert("Error during bulk regeneration. Please try again.")}finally{ve(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:U,className:`${`w-full overflow-y-auto scrollbar-hide px-2 sm:px-4 ${t?n?"pt-24 pb-4":"pt-16 pb-4":"py-10"}`}`,children:[(T.length>1||te.length>1)&&e.jsxs("div",{className:`mb-6 flex items-center gap-4 ${We?"px-4":""}`,children:[T.length>1&&e.jsxs(Pe,{modal:!1,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[c.length===T.length||c.length===0?"All Directories":`${c.length} Director${c.length===1?"y":"ies"}`,e.jsx("svg",{className:"ml-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(He,{align:"start",className:"w-80",children:[e.jsx(gt,{children:"Watch Directories"}),e.jsx(Ke,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Ze,{checked:c.length===T.length,onCheckedChange:s=>{s?Te():rt()},className:"font-medium",children:"Select All"}),e.jsx(Ke,{}),T.map(s=>e.jsx(Ze,{checked:c.includes(s),onCheckedChange:()=>Xe(s),children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium text-sm",children:s.split("/").pop()||s}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s})]})},s))]})]})]}),te.length>1&&e.jsxs(Pe,{modal:!1,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[X.length===te.length||X.length===0?"All Transcript Sources":`${X.length} Source${X.length===1?"":"s"}`,e.jsx("svg",{className:"ml-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),e.jsxs(He,{align:"start",className:"w-80",children:[e.jsx(gt,{children:"Sources"}),e.jsx(Ke,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1 p-2",children:[e.jsx(Ze,{checked:X.length===te.length,onCheckedChange:s=>{s?fn():hn()},className:"font-medium",children:"Select All"}),e.jsx(Ke,{}),te.map(s=>e.jsx(Ze,{checked:X.includes(s),onCheckedChange:()=>ft(s),children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${z(s)}`,children:s})})},s))]})]})]})]}),X.length===1&&e.jsxs("div",{className:`mb-6 flex items-center justify-between ${We?"px-4":""}`,children:[e.jsx("button",{onClick:xn,disabled:oe,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 rounded-md disabled:opacity-50 disabled:cursor-not-allowed",children:oe?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Regenerate All (",X[0],")"]})}),e.jsx("span",{className:"text-sm text-muted-foreground",children:(()=>{const s=_e.filter(L=>r&&!Me.includes(L.full_path)?!1:L.transcript);return`${s.length} file${s.length===1?"":"s"} with transcripts`})()})]}),e.jsxs("div",{children:[Me.length>0&&e.jsx("div",{className:`mb-6 p-4 bg-accent/10 border border-accent/20 rounded-md ${We?"mx-4":""}`,children:e.jsxs("h3",{className:"text-sm font-medium text-accent-foreground mb-2",children:["Found in ",Me.length," file(s)"]})}),r&&Me.length===0&&e.jsx("div",{className:`mb-6 p-4 bg-muted border border-border rounded-md ${We?"mx-4":""}`,children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:['No files found containing "',r,'"']})}),!r&&!v&&e.jsx("div",{className:`mb-6 p-4 bg-muted border border-border rounded-md ${We?"mx-4":""}`,children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Search to get started!"})}),!n&&!D?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})}):We?e.jsx(Un,{sortedFiles:_e,activeSearchTerm:r,searchResults:Me,showAllFiles:v,transcriptData:b,expandedFiles:i,searchLineNumbers:a,onExpandFile:s=>{const L=_e.find(w=>w.full_path===s);L!=null&&L.transcript&&pn(s)},onRegenerate:J,onReplace:de,onRename:Ie,onFetchTranscript:Ne,onSetRightPaneUrl:q,formatDate:s=>re(s,d>=1129),getSourceChipColor:z,expandContext:Ue,clipStart:$,clipEnd:O,clipTranscript:M,onSetClipStart:f,onSetClipEnd:p,onClearClip:F,onClipBlock:H,mobileTranscriptRowRefs:N}):e.jsxs(Rn,{className:"table-fixed w-full",children:[e.jsx(En,{children:e.jsxs(bt,{children:[e.jsxs(tt,{className:"text-center w-[34%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>Ve("name"),children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Filename",qe("name")]}),r&&Me.length>0&&e.jsx("span",{className:"text-xs text-primary ml-2",children:"(Search Results)"})]}),e.jsx(tt,{className:"text-center w-[14%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>Ve("created_at"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Date",qe("created_at")]})}),e.jsx(tt,{className:"text-center w-[14%] pl-6 cursor-pointer hover:bg-accent transition-colors",onClick:()=>Ve("last_generated"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Generated",qe("last_generated")]})}),e.jsx(tt,{className:"text-center w-[10%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>Ve("line_count"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Lines",qe("line_count")]})}),e.jsx(tt,{className:"text-center w-[10%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>Ve("length"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Length",qe("length")]})}),e.jsx(tt,{className:"text-center w-[8%] cursor-pointer hover:bg-accent transition-colors",onClick:()=>Ve("source"),children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:["Source",qe("source")]})}),e.jsx(tt,{className:"text-center w-[10%]",children:"Actions"})]})}),e.jsx(Ln,{children:_e.map(s=>{var I;if(!(r?Me.includes(s.full_path):v))return e.jsx(e.Fragment,{});const w=b[s.full_path]||{text:"",loading:!1,error:null};return e.jsxs(e.Fragment,{children:[e.jsxs(bt,{ref:A=>{_.current[s.full_path]=A},"data-filename":s.full_path,className:"",onClick:()=>{s.transcript&&j(A=>{const ae=new Set(A);return ae.has(s.full_path)?ae.delete(s.full_path):ae.add(s.full_path),ae})},children:[e.jsx(Je,{className:"font-medium w-[34%] max-w-0",children:e.jsx("div",{className:"leading-tight overflow-hidden whitespace-nowrap text-ellipsis",style:{direction:"rtl",textAlign:"left",unicodeBidi:"plaintext",fontSize:(()=>{var K;const ae=(((K=s.name.split("/").pop())==null?void 0:K.split("\\").pop())||s.name).length;return ae<=15?"14px":ae<=20?"13px":"12px"})()},title:s.name,children:((I=s.name.split("/").pop())==null?void 0:I.split("\\").pop())||s.name})}),e.jsx(Je,{className:"w-[14%] pr-10 text-foreground",children:re(s.created_at,d>=1129)}),e.jsx(Je,{className:"w-[14%] text-center text-foreground",children:re(s.last_generated||"",d>=1129)}),e.jsx(Je,{className:"w-[10%] text-foreground",children:s.line_count||0}),e.jsx(Je,{className:"w-[10%] text-foreground",children:s.length?s.length:e.jsx("button",{onClick:A=>Y(s.full_path,A),disabled:!s.transcript,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Generate video length",children:s.transcript?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})}),e.jsx(Je,{className:"w-[8%] text-center",children:s.source?d>=1129?e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{className:`inline-flex items-center rounded-full font-medium ${z(s.source)} ${s.source.length>10?"px-1.5 py-0.5 text-xs scale-75":"px-2.5 py-0.5 text-xs"}`,children:s.source})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:`w-3 h-3 rounded-full ${z(s.source).split(" ").find(A=>A.startsWith("bg-"))||"bg-gray-200"} ${z(s.source).split(" ").find(A=>A.startsWith("dark:bg-"))||""}`,title:s.source})}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(Je,{className:"w-[10%] text-center p-2",children:e.jsxs(Pe,{modal:!1,children:[e.jsx(Fe,{asChild:!0,children:e.jsx("button",{onClick:A=>A.stopPropagation(),className:"p-2 text-muted-foreground hover:text-primary hover:bg-accent rounded-md transition-colors",title:"Actions",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(He,{align:"end",children:[e.jsxs(ge,{onClick:A=>Ie(s.full_path,A),disabled:!s.transcript,children:[e.jsx("span",{children:"Rename"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})]}),s.transcript&&e.jsxs(ge,{onClick:A=>de(s.full_path,A),disabled:!s.transcript,className:"text-blue-600 hover:text-blue-700",children:[e.jsx("span",{children:"Edit transcript"}),!s.transcript&&e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})]}),s.transcript&&e.jsxs(ge,{onClick:A=>J(s.full_path,s.source,A),disabled:!s.transcript,className:"text-green-600 hover:text-green-700",children:[e.jsx("span",{children:"Regenerate transcript"}),s.transcript?e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}):e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]}),ot(s.full_path)&&e.jsxs(ge,{disabled:!0,children:[e.jsx("span",{children:"Processing transcript..."}),e.jsx("svg",{className:"w-4 h-4 ml-auto animate-reverse-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})]})]})]})})]},s.full_path),e.jsx(bt,{ref:A=>{P.current[s.full_path]=A},"data-filename":s.full_path,children:e.jsx(Je,{colSpan:7,className:"p-0",children:e.jsx(Jt,{visible:i.has(s.full_path),name:s.base_name,fullPath:s.full_path,className:"w-full",searchTerm:r,text:w.text,loading:w.loading,error:w.error,visibleLines:a[s.full_path]||[],expandContext:Ue,onEditSuccess:()=>{Ne(s.full_path)},onSetRightPaneUrl:q,clipStart:$,clipEnd:O,clipTranscript:M,onSetClipStart:A=>f(A,s.full_path),onSetClipEnd:A=>p(A,s.full_path),onClearClip:F,onClipBlock:H})})})]})})})]})]})]}),e.jsx(Mt,{isOpen:ue,filename:me,transcriptInitialValue:ke,onTranscriptSave:ye,onCancel:Ce,isTranscriptSubmitting:le}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background border border-border rounded-lg p-6 w-96 max-w-90vw",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Rename File"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:['Renaming "',((Ot=W.split("/").pop())==null?void 0:Ot.split("\\").pop())||W,'" (this will rename the video, transcript, and meta files)']}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-filename",className:"block text-sm font-medium mb-2",children:"New filename (without extension):"}),e.jsx("input",{id:"new-filename",type:"text",value:ie,onChange:s=>Se(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!$e&&ie.trim()?Re():s.key==="Escape"&&Ye()},className:"w-full px-3 py-2 border border-input bg-background text-foreground rounded focus:outline-none focus:ring-1 focus:ring-ring focus:border-transparent",placeholder:"Enter new filename",disabled:$e,autoFocus:!0})]}),et&&e.jsx("div",{className:"text-sm text-destructive",children:et}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:Ye,className:"px-4 py-2 text-sm border border-input bg-background text-foreground rounded hover:bg-accent focus:outline-none focus:ring-1 focus:ring-ring",disabled:$e,children:"Cancel"}),e.jsx("button",{onClick:Re,className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 focus:outline-none focus:ring-1 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed",disabled:$e||!ie.trim(),children:$e?"Renaming...":"Rename"})]})]})]})}),e.jsx(_t,{isOpen:je,videoPath:Be,source:at,onClose:()=>ze(!1),onRegenerate:Q})]})}function qn(){return e.jsx("div",{className:"w-full h-full flex items-center justify-center p-8 bg-background",children:e.jsxs("div",{className:"text-center text-foreground",children:[e.jsx("div",{className:"mb-6",children:e.jsx("svg",{className:"w-16 h-16 mx-auto text-muted-foreground",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("h3",{className:"text-xl font-medium mb-3 text-foreground",children:"Clip Editor"}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:"Click on any timestamp in a transcript to open the clip editor and create video clips from specific moments."})]})})}const xt=m.forwardRef(({className:t,type:n,...r},a)=>e.jsx("input",{type:n,className:Ee("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...r}));xt.displayName="Input";const en=m.forwardRef(({className:t,...n},r)=>e.jsx("textarea",{className:Ee("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n}));en.displayName="Textarea";function Yn({className:t,...n}){return e.jsx(wn,{"data-slot":"checkbox",className:Ee("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(bn,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Tn,{className:"size-3.5"})})})}const zt=({buttons:t})=>{const n=t.reduce((a,o,i)=>{const j=o.group??0;return a[j]||(a[j]=[]),a[j].push({...o,originalIndex:i}),a},{}),r=Object.keys(n).map(Number).sort((a,o)=>a-o);return e.jsx("div",{className:"mt-2 space-y-3",children:r.map(a=>e.jsx("div",{className:"flex items-center gap-2 justify-center flex-wrap",children:n[a].map(o=>e.jsx(pe,{variant:"outline",size:"sm",onClick:o.onClick,className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:o.color?{borderColor:o.color,color:o.color}:void 0,children:o.text},o.originalIndex))},a))})},lt=({filename:t,clip_url:n,start_time_formatted:r="00:00:00.000",end_time_formatted:a="00:00:10.000",font_size:o="",text:i="",display_text:j=!1,onBack:b,onStartTimeChange:k,onEndTimeChange:S})=>{const[v,d]=m.useState(r),[u,D]=m.useState(a),[R,$]=m.useState(o),[O,M]=m.useState(i),[_,P]=m.useState(j),[N,U]=m.useState(!1),[q,f]=m.useState(n||""),[p,F]=m.useState(!1),[H,x]=m.useState(!1),[y]=m.useState(t),[c,V]=m.useState({}),[T,X]=m.useState("video"),E=m.useRef(null),te=m.useRef(null),Z=C=>{const g=C.split(":"),l=parseInt(g[0],10),W=parseInt(g[1],10),ce=parseFloat(g[2]);return l*3600+W*60+ce},be=C=>{C=Math.max(0,C);const g=Math.floor(C/3600),l=Math.floor(C%3600/60),W=C%60;return`${g.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${W.toFixed(3).padStart(6,"0")}`},ee=C=>/^(\d{2}):(\d{2}):(\d{2})\.(\d{3})$/.test(C),he=(C="mp4")=>{if(!v||!u||!ee(v)||!ee(u))return"";const g=Z(v),l=Z(u);if(g<0||l<=g)return"";const W=new URLSearchParams({filename:t,start_time:g.toString(),end_time:l.toString(),format:C,cachebuster:Date.now().toString()});return O&&O.trim()!==""&&W.set("text",O),R&&R.trim()!==""&&W.set("font_size",R),_&&W.set("display_text","true"),"/api/clip?"+W.toString()},oe=C=>{let g=`${y}_clip_start_${v}_end_${u}.${C}`;if(O&&O.trim()!==""){const l=O.trim().substring(0,50).replace(/[^a-zA-Z0-9\s\-_]/g,"").replace(/\s+/g,"_");l&&(g=l+`.${C}`)}return g},ve=async C=>{const g=he(C),l=oe(C);V(W=>({...W,[C]:!0}));try{const W=await fetch(g);if(!W.ok)throw new Error(`Failed to download file: ${W.statusText}`);const ce=await W.blob(),ie={mp4:"video/mp4",gif:"image/gif",mp3:"audio/mpeg"},Se=new File([ce],l,{type:ie[C]||"application/octet-stream"});await navigator.share({files:[Se]})}catch(W){console.error("Error sharing:",W);try{await navigator.share({title:`Clip from ${l}`,url:window.location.origin+g})}catch(ce){console.error("Error with fallback sharing:",ce)}}finally{V(W=>({...W,[C]:!1}))}},ue=(C,g,l,W)=>{if(!ee(C))return;const ie=Z(C)+g,Se=be(ie);l(Se),W&&W(ie)},se=(C,g,l)=>[{text:"+1s",onClick:()=>ue(C,1,g,l),color:"#22c55e",group:0},{text:"+0.5s",onClick:()=>ue(C,.5,g,l),color:"#22c55e",group:0},{text:"+0.1s",onClick:()=>ue(C,.1,g,l),color:"#22c55e",group:0},{text:"+0.01s",onClick:()=>ue(C,.01,g,l),color:"#22c55e",group:0},{text:"-1s",onClick:()=>ue(C,-1,g,l),color:"#ef4444",group:1},{text:"-0.5s",onClick:()=>ue(C,-.5,g,l),color:"#ef4444",group:1},{text:"-0.1s",onClick:()=>ue(C,-.1,g,l),color:"#ef4444",group:1},{text:"-0.01s",onClick:()=>ue(C,-.01,g,l),color:"#ef4444",group:1}],me=()=>{if(!ee(v)||!ee(u))return;const C=Z(v),g=Z(u);if(C<0||g<=C)return;const l=he(T==="video"?"mp4":"gif");l&&f(l)};m.useEffect(()=>{var C;q&&((C=E.current)==null||C.load())},[q]);const ne=()=>{te.current&&clearTimeout(te.current),te.current=setTimeout(me,500)},ke=()=>{U(!1),E.current&&window.scrollTo({top:0,behavior:"smooth"})},G=()=>{U(!1),window.scrollTo({top:0,behavior:"smooth"})},le=(C,g,l)=>{if(g(C),ee(C)&&l){const W=Z(C);l(W)}};return m.useEffect(()=>{$(o),M(i),P(j),f(n||"")},[o,i,j,n]),m.useEffect(()=>{d(r)},[r]),m.useEffect(()=>{D(a)},[a]),m.useEffect(()=>{ee(v)&&ee(u)&&me()},[v,u,T,O,R,_]),m.useEffect(()=>{x(typeof navigator.share=="function")},[]),m.useEffect(()=>(me(),()=>{te.current&&clearTimeout(te.current)}),[t,r,a]),e.jsxs("div",{className:"container max-w-6xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:t}),b&&e.jsxs("button",{onClick:b,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx($n,{className:"h-4 w-4"}),"Close"]})]}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("div",{className:"text-lg font-medium text-muted-foreground",children:[v," to ",u]})}),e.jsx(vt,{className:"relative overflow-hidden bg-black",children:e.jsxs(wt,{className:"p-0",children:[N&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center min-h-[300px] bg-black/95 backdrop-blur-sm z-10",children:[e.jsx("div",{className:"w-12 h-12 border-3 border-muted border-t-primary rounded-full animate-spin mb-6"}),e.jsx("div",{className:"text-lg font-semibold text-primary-foreground mb-2",children:"Processing..."}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Generating your clip, please wait"})]}),q&&e.jsx(e.Fragment,{children:T==="video"?e.jsxs("video",{ref:E,controls:!0,autoPlay:!0,playsInline:!0,className:"w-full h-auto block",onLoadedData:ke,onError:G,children:[e.jsx("source",{src:q,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsx("img",{src:q,alt:"Clip preview",className:"w-full h-auto block",onLoad:ke,onError:G})})]})}),e.jsx(vt,{children:e.jsxs(wt,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-start",children:e.jsxs(pe,{onClick:me,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Dn,{className:"h-4 w-4"}),"Regenerate"]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"start_time",className:"text-sm font-medium",children:"Start Time (hh:mm:ss.sss)"}),e.jsx(xt,{id:"start_time",type:"text",value:v,onChange:C=>le(C.target.value,d,k),pattern:"^(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d{3})$",placeholder:"00:00:00.000",className:"font-mono text-xs tracking-wider",required:!0}),p&&e.jsx(zt,{buttons:se(v,d,k)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"end_time",className:"text-sm font-medium",children:"End Time (hh:mm:ss.sss)"}),e.jsx(xt,{id:"end_time",type:"text",value:u,onChange:C=>le(C.target.value,D,S),pattern:"^(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d{3})$",placeholder:"00:00:00.000",className:"font-mono text-xs tracking-wider",required:!0}),p&&e.jsx(zt,{buttons:se(u,D,S)})]})]})}),!p&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(pe,{onClick:()=>F(!0),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(On,{className:"h-4 w-4"}),"Show Time Controls"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Preview"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"preview",value:"video",checked:T==="video",onChange:C=>X(C.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm",children:"Video"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"preview",value:"gif",checked:T==="gif",onChange:C=>X(C.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm",children:"GIF"})]})]})]}),e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx("label",{htmlFor:"font_size",className:"text-sm font-medium",children:"Font Size"}),e.jsx(xt,{id:"font_size",type:"number",value:R,onChange:C=>{$(C.target.value),ne()},min:"10",max:"500",placeholder:"Auto",className:"w-20"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"text",className:"text-sm font-medium",children:"Text Overlay"}),e.jsx(en,{id:"text",value:O,onChange:C=>{M(C.target.value),ne()},placeholder:"Enter text to overlay on video",className:"min-h-[100px] resize-y"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Yn,{id:"display_text",checked:_,onCheckedChange:C=>{P(C),me()}}),e.jsx("label",{htmlFor:"display_text",className:"text-sm font-medium cursor-pointer",children:"Show Text Overlay"})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-center flex-wrap",children:[e.jsx(pe,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#22c55e",color:"#22c55e"},children:e.jsxs("a",{href:he("mp4"),download:oe("mp4"),className:"inline-flex items-center gap-2",children:[e.jsx(yt,{className:"w-3 h-3"}),"Download MP4"]})}),e.jsx(pe,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#22c55e",color:"#22c55e"},children:e.jsxs("a",{href:he("gif"),download:oe("gif"),className:"inline-flex items-center gap-2",children:[e.jsx(yt,{className:"w-3 h-3"}),"Download GIF"]})}),e.jsx(pe,{asChild:!0,variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#22c55e",color:"#22c55e"},children:e.jsxs("a",{href:he("mp3"),download:oe("mp3"),className:"inline-flex items-center gap-2",children:[e.jsx(yt,{className:"w-3 h-3"}),"Download MP3"]})})]}),H&&e.jsxs("div",{className:"flex items-center gap-1 justify-center flex-wrap",children:[e.jsxs(pe,{onClick:()=>ve("mp4"),variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#3b82f6",color:"#3b82f6"},disabled:c.mp4,children:[c.mp4?e.jsx("div",{className:"w-3 h-3 mr-1 border border-current border-t-transparent rounded-full animate-spin"}):e.jsx(kt,{className:"w-3 h-3 mr-1"}),c.mp4?"Sharing...":"Share MP4"]}),e.jsxs(pe,{onClick:()=>ve("gif"),variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#3b82f6",color:"#3b82f6"},disabled:c.gif,children:[c.gif?e.jsx("div",{className:"w-3 h-3 mr-1 border border-current border-t-transparent rounded-full animate-spin"}):e.jsx(kt,{className:"w-3 h-3 mr-1"}),c.gif?"Sharing...":"Share GIF"]}),e.jsxs(pe,{onClick:()=>ve("mp3"),variant:"outline",size:"sm",className:"h-7 px-2 text-xs font-mono hover:bg-muted/80 transition-colors",style:{borderColor:"#3b82f6",color:"#3b82f6"},disabled:c.mp3,children:[c.mp3?e.jsx("div",{className:"w-3 h-3 mr-1 border border-current border-t-transparent rounded-full animate-spin"}):e.jsx(kt,{className:"w-3 h-3 mr-1"}),c.mp3?"Sharing...":"Share MP3"]})]})]})]})})]})};function Xn(t){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const tn=h.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),ut=()=>{const t=h.useContext(tn);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};Xn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function Gn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function Qn(){return Dt(/^Mac/)}function Jn(){return Dt(/^iPhone/)}function Wt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Kn(){return Dt(/^iPad/)||Qn()&&navigator.maxTouchPoints>1}function nn(){return Jn()||Kn()}function Dt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const Zn=24,er=typeof window<"u"?m.useLayoutEffect:m.useEffect;function Ut(...t){return(...n)=>{for(let r of t)typeof r=="function"&&r(...n)}}const Nt=typeof document<"u"&&window.visualViewport;function Vt(t){let n=window.getComputedStyle(t);return/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY)}function rn(t){for(Vt(t)&&(t=t.parentElement);t&&!Vt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const tr=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let ht=0,Ct;function nr(t={}){let{isDisabled:n}=t;er(()=>{if(!n)return ht++,ht===1&&nn()&&(Ct=rr()),()=>{ht--,ht===0&&(Ct==null||Ct())}},[n])}function rr(){let t,n=0,r=d=>{t=rn(d.target),!(t===document.documentElement&&t===document.body)&&(n=d.changedTouches[0].pageY)},a=d=>{if(!t||t===document.documentElement||t===document.body){d.preventDefault();return}let u=d.changedTouches[0].pageY,D=t.scrollTop,R=t.scrollHeight-t.clientHeight;R!==0&&((D<=0&&u>n||D>=R&&u<n)&&d.preventDefault(),n=u)},o=d=>{let u=d.target;Tt(u)&&u!==document.activeElement&&(d.preventDefault(),u.style.transform="translateY(-2000px)",u.focus(),requestAnimationFrame(()=>{u.style.transform=""}))},i=d=>{let u=d.target;Tt(u)&&(u.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{u.style.transform="",Nt&&(Nt.height<window.innerHeight?requestAnimationFrame(()=>{qt(u)}):Nt.addEventListener("resize",()=>qt(u),{once:!0}))}))},j=()=>{window.scrollTo(0,0)},b=window.pageXOffset,k=window.pageYOffset,S=Ut(sr(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let v=Ut(ct(document,"touchstart",r,{passive:!1,capture:!0}),ct(document,"touchmove",a,{passive:!1,capture:!0}),ct(document,"touchend",o,{passive:!1,capture:!0}),ct(document,"focus",i,!0),ct(window,"scroll",j));return()=>{S(),v(),window.scrollTo(b,k)}}function sr(t,n,r){let a=t.style[n];return t.style[n]=r,()=>{t.style[n]=a}}function ct(t,n,r,a){return t.addEventListener(n,r,a),()=>{t.removeEventListener(n,r,a)}}function qt(t){let n=document.scrollingElement||document.documentElement;for(;t&&t!==n;){let r=rn(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let a=r.getBoundingClientRect().top,o=t.getBoundingClientRect().top,i=t.getBoundingClientRect().bottom;const j=r.getBoundingClientRect().bottom+Zn;i>j&&(r.scrollTop+=o-a)}t=r.parentElement}}function Tt(t){return t instanceof HTMLInputElement&&!tr.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function ar(t,n){typeof t=="function"?t(n):t!=null&&(t.current=n)}function or(...t){return n=>t.forEach(r=>ar(r,n))}function sn(...t){return m.useCallback(or(...t),t)}const an=new WeakMap;function we(t,n,r=!1){if(!t||!(t instanceof HTMLElement))return;let a={};Object.entries(n).forEach(([o,i])=>{if(o.startsWith("--")){t.style.setProperty(o,i);return}a[o]=t.style[o],t.style[o]=i}),!r&&an.set(t,a)}function ir(t,n){if(!t||!(t instanceof HTMLElement))return;let r=an.get(t);r&&(t.style[n]=r[n])}const xe=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function pt(t,n){if(!t)return null;const r=window.getComputedStyle(t),a=r.transform||r.webkitTransform||r.mozTransform;let o=a.match(/^matrix3d\((.+)\)$/);return o?parseFloat(o[1].split(", ")[xe(n)?13:12]):(o=a.match(/^matrix\((.+)\)$/),o?parseFloat(o[1].split(", ")[xe(n)?5:4]):null)}function lr(t){return 8*(Math.log(t+1)-2)}function St(t,n){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,n),()=>{t.style.cssText=r}}function cr(...t){return(...n)=>{for(const r of t)typeof r=="function"&&r(...n)}}const fe={DURATION:.5,EASE:[.32,.72,0,1]},on=.4,dr=.25,ur=100,ln=8,nt=16,$t=26,Rt="vaul-dragging";function cn(t){const n=h.useRef(t);return h.useEffect(()=>{n.current=t}),h.useMemo(()=>(...r)=>n.current==null?void 0:n.current.call(n,...r),[])}function mr({defaultProp:t,onChange:n}){const r=h.useState(t),[a]=r,o=h.useRef(a),i=cn(n);return h.useEffect(()=>{o.current!==a&&(i(a),o.current=a)},[a,o,i]),r}function dn({prop:t,defaultProp:n,onChange:r=()=>{}}){const[a,o]=mr({defaultProp:n,onChange:r}),i=t!==void 0,j=i?t:a,b=cn(r),k=h.useCallback(S=>{if(i){const d=typeof S=="function"?S(t):S;d!==t&&b(d)}else o(S)},[i,t,o,b]);return[j,k]}function fr({activeSnapPointProp:t,setActiveSnapPointProp:n,snapPoints:r,drawerRef:a,overlayRef:o,fadeFromIndex:i,onSnapPointChange:j,direction:b="bottom",container:k,snapToSequentialPoint:S}){const[v,d]=dn({prop:t,defaultProp:r==null?void 0:r[0],onChange:n}),[u,D]=h.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);h.useEffect(()=>{function f(){D({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const R=h.useMemo(()=>v===(r==null?void 0:r[r.length-1])||null,[r,v]),$=h.useMemo(()=>{var f;return(f=r==null?void 0:r.findIndex(p=>p===v))!=null?f:null},[r,v]),O=r&&r.length>0&&(i||i===0)&&!Number.isNaN(i)&&r[i]===v||!r,M=h.useMemo(()=>{const f=k?{width:k.getBoundingClientRect().width,height:k.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var p;return(p=r==null?void 0:r.map(F=>{const H=typeof F=="string";let x=0;if(H&&(x=parseInt(F,10)),xe(b)){const c=H?x:u?F*f.height:0;return u?b==="bottom"?f.height-c:-f.height+c:c}const y=H?x:u?F*f.width:0;return u?b==="right"?f.width-y:-f.width+y:y}))!=null?p:[]},[r,u,k]),_=h.useMemo(()=>$!==null?M==null?void 0:M[$]:null,[M,$]),P=h.useCallback(f=>{var p;const F=(p=M==null?void 0:M.findIndex(H=>H===f))!=null?p:null;j(F),we(a.current,{transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,transform:xe(b)?`translate3d(0, ${f}px, 0)`:`translate3d(${f}px, 0, 0)`}),M&&F!==M.length-1&&i!==void 0&&F!==i&&F<i?we(o.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,opacity:"0"}):we(o.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,opacity:"1"}),d(r==null?void 0:r[Math.max(F,0)])},[a.current,r,M,i,o,d]);h.useEffect(()=>{if(v||t){var f;const p=(f=r==null?void 0:r.findIndex(F=>F===t||F===v))!=null?f:-1;M&&p!==-1&&typeof M[p]=="number"&&P(M[p])}},[v,t,r,M,P]);function N({draggedDistance:f,closeDrawer:p,velocity:F,dismissible:H}){if(i===void 0)return;const x=b==="bottom"||b==="right"?(_??0)-f:(_??0)+f,y=$===i-1,c=$===0,V=f>0;if(y&&we(o.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`}),!S&&F>2&&!V){H?p():P(M[0]);return}if(!S&&F>2&&V&&M&&r){P(M[r.length-1]);return}const T=M==null?void 0:M.reduce((E,te)=>typeof E!="number"||typeof te!="number"?E:Math.abs(te-x)<Math.abs(E-x)?te:E),X=xe(b)?window.innerHeight:window.innerWidth;if(F>on&&Math.abs(f)<X*.4){const E=V?1:-1;if(E>0&&R&&r){P(M[r.length-1]);return}if(c&&E<0&&H&&p(),$===null)return;P(M[$+E]);return}P(T)}function U({draggedDistance:f}){if(_===null)return;const p=b==="bottom"||b==="right"?_-f:_+f;(b==="bottom"||b==="right")&&p<M[M.length-1]||(b==="top"||b==="left")&&p>M[M.length-1]||we(a.current,{transform:xe(b)?`translate3d(0, ${p}px, 0)`:`translate3d(${p}px, 0, 0)`})}function q(f,p){if(!r||typeof $!="number"||!M||i===void 0)return null;const F=$===i-1;if($>=i&&p)return 0;if(F&&!p)return 1;if(!O&&!F)return null;const x=F?$+1:$-1,y=F?M[x]-M[x-1]:M[x+1]-M[x],c=f/Math.abs(y);return F?1-c:c}return{isLastSnapPoint:R,activeSnapPoint:v,shouldFade:O,getPercentageDragged:q,setActiveSnapPoint:d,activeSnapPointIndex:$,onRelease:N,onDrag:U,snapPointsOffset:M}}const hr=()=>()=>{};function pr(){const{direction:t,isOpen:n,shouldScaleBackground:r,setBackgroundColorOnScale:a,noBodyStyles:o}=ut(),i=h.useRef(null),j=m.useMemo(()=>document.body.style.backgroundColor,[]);function b(){return(window.innerWidth-$t)/window.innerWidth}h.useEffect(()=>{if(n&&r){i.current&&clearTimeout(i.current);const k=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!k)return;cr(a&&!o?St(document.body,{background:"black"}):hr,St(k,{transformOrigin:xe(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${fe.DURATION}s`,transitionTimingFunction:`cubic-bezier(${fe.EASE.join(",")})`}));const S=St(k,{borderRadius:`${ln}px`,overflow:"hidden",...xe(t)?{transform:`scale(${b()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${b()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{S(),i.current=window.setTimeout(()=>{j?document.body.style.background=j:document.body.style.removeProperty("background")},fe.DURATION*1e3)}}},[n,r,j])}let dt=null;function xr({isOpen:t,modal:n,nested:r,hasBeenOpened:a,preventScrollRestoration:o,noBodyStyles:i}){const[j,b]=h.useState(()=>typeof window<"u"?window.location.href:""),k=h.useRef(0),S=h.useCallback(()=>{if(Wt()&&dt===null&&t&&!i){dt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:d,innerHeight:u}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-k.current}px`,left:`${-d}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const D=u-window.innerHeight;D&&k.current>=u&&(document.body.style.top=`${-(k.current+D)}px`)}),300)}},[t]),v=h.useCallback(()=>{if(Wt()&&dt!==null&&!i){const d=-parseInt(document.body.style.top,10),u=-parseInt(document.body.style.left,10);Object.assign(document.body.style,dt),window.requestAnimationFrame(()=>{if(o&&j!==window.location.href){b(window.location.href);return}window.scrollTo(u,d)}),dt=null}},[j]);return h.useEffect(()=>{function d(){k.current=window.scrollY}return d(),window.addEventListener("scroll",d),()=>{window.removeEventListener("scroll",d)}},[]),h.useEffect(()=>{if(n)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||v()}},[n,v]),h.useEffect(()=>{r||!a||(t?(!window.matchMedia("(display-mode: standalone)").matches&&S(),n||window.setTimeout(()=>{v()},500)):v())},[t,a,j,n,r,S,v]),{restorePositionSetting:v}}function gr({open:t,onOpenChange:n,children:r,onDrag:a,onRelease:o,snapPoints:i,shouldScaleBackground:j=!1,setBackgroundColorOnScale:b=!0,closeThreshold:k=dr,scrollLockTimeout:S=ur,dismissible:v=!0,handleOnly:d=!1,fadeFromIndex:u=i&&i.length-1,activeSnapPoint:D,setActiveSnapPoint:R,fixed:$,modal:O=!0,onClose:M,nested:_,noBodyStyles:P=!1,direction:N="bottom",defaultOpen:U=!1,disablePreventScroll:q=!0,snapToSequentialPoint:f=!1,preventScrollRestoration:p=!1,repositionInputs:F=!0,onAnimationEnd:H,container:x,autoFocus:y=!1}){var c,V;const[T=!1,X]=dn({defaultProp:U,prop:t,onChange:B=>{n==null||n(B),!B&&!_&&at(),setTimeout(()=>{H==null||H(B)},fe.DURATION*1e3),B&&!O&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),B||(document.body.style.pointerEvents="auto")}}),[E,te]=h.useState(!1),[Z,be]=h.useState(!1),[ee,he]=h.useState(!1),oe=h.useRef(null),ve=h.useRef(null),ue=h.useRef(null),se=h.useRef(null),me=h.useRef(null),ne=h.useRef(!1),ke=h.useRef(null),G=h.useRef(0),le=h.useRef(!1),C=h.useRef(!U),g=h.useRef(0),l=h.useRef(null),W=h.useRef(((c=l.current)==null?void 0:c.getBoundingClientRect().height)||0),ce=h.useRef(((V=l.current)==null?void 0:V.getBoundingClientRect().width)||0),ie=h.useRef(0),Se=h.useCallback(B=>{i&&B===je.length-1&&(ve.current=new Date)},[]),{activeSnapPoint:$e,activeSnapPointIndex:De,setActiveSnapPoint:et,onRelease:Oe,snapPointsOffset:je,onDrag:ze,shouldFade:Be,getPercentageDragged:Le}=fr({snapPoints:i,activeSnapPointProp:D,setActiveSnapPointProp:R,drawerRef:l,fadeFromIndex:u,overlayRef:oe,onSnapPointChange:Se,direction:N,container:x,snapToSequentialPoint:f});nr({isDisabled:!T||Z||!O||ee||!E||!F||!q});const{restorePositionSetting:at}=xr({isOpen:T,modal:O,nested:_??!1,hasBeenOpened:E,preventScrollRestoration:p,noBodyStyles:P});function Qe(){return(window.innerWidth-$t)/window.innerWidth}function ot(B){var J,Q;!v&&!i||l.current&&!l.current.contains(B.target)||(W.current=((J=l.current)==null?void 0:J.getBoundingClientRect().height)||0,ce.current=((Q=l.current)==null?void 0:Q.getBoundingClientRect().width)||0,be(!0),ue.current=new Date,nn()&&window.addEventListener("touchend",()=>ne.current=!1,{once:!0}),B.target.setPointerCapture(B.pointerId),G.current=xe(N)?B.pageY:B.pageX)}function Me(B,J){var Q;let Y=B;const de=(Q=window.getSelection())==null?void 0:Q.toString(),ye=l.current?pt(l.current,N):null,Ce=new Date;if(Y.tagName==="SELECT"||Y.hasAttribute("data-vaul-no-drag")||Y.closest("[data-vaul-no-drag]"))return!1;if(N==="right"||N==="left")return!0;if(ve.current&&Ce.getTime()-ve.current.getTime()<500)return!1;if(ye!==null&&(N==="bottom"?ye>0:ye<0))return!0;if(de&&de.length>0)return!1;if(me.current&&Ce.getTime()-me.current.getTime()<S&&ye===0||J)return me.current=Ce,!1;for(;Y;){if(Y.scrollHeight>Y.clientHeight){if(Y.scrollTop!==0)return me.current=new Date,!1;if(Y.getAttribute("role")==="dialog")return!0}Y=Y.parentNode}return!0}function We(B){if(l.current&&Z){const J=N==="bottom"||N==="right"?1:-1,Q=(G.current-(xe(N)?B.pageY:B.pageX))*J,Y=Q>0,de=i&&!v&&!Y;if(de&&De===0)return;const ye=Math.abs(Q),Ce=document.querySelector("[data-vaul-drawer-wrapper]"),Ie=N==="bottom"||N==="top"?W.current:ce.current;let Re=ye/Ie;const Ye=Le(ye,Y);if(Ye!==null&&(Re=Ye),de&&Re>=1||!ne.current&&!Me(B.target,Y))return;if(l.current.classList.add(Rt),ne.current=!0,we(l.current,{transition:"none"}),we(oe.current,{transition:"none"}),i&&ze({draggedDistance:Q}),Y&&!i){const Te=lr(Q),rt=Math.min(Te*-1,0)*J;we(l.current,{transform:xe(N)?`translate3d(0, ${rt}px, 0)`:`translate3d(${rt}px, 0, 0)`});return}const Xe=1-Re;if((Be||u&&De===u-1)&&(a==null||a(B,Re),we(oe.current,{opacity:`${Xe}`,transition:"none"},!0)),Ce&&oe.current&&j){const Te=Math.min(Qe()+Re*(1-Qe()),1),rt=8-Re*8,ft=Math.max(0,14-Re*14);we(Ce,{borderRadius:`${rt}px`,transform:xe(N)?`scale(${Te}) translate3d(0, ${ft}px, 0)`:`scale(${Te}) translate3d(${ft}px, 0, 0)`,transition:"none"},!0)}if(!i){const Te=ye*J;we(l.current,{transform:xe(N)?`translate3d(0, ${Te}px, 0)`:`translate3d(${Te}px, 0, 0)`})}}}h.useEffect(()=>{window.requestAnimationFrame(()=>{C.current=!0})},[]),h.useEffect(()=>{var B;function J(){if(!l.current||!F)return;const Q=document.activeElement;if(Tt(Q)||le.current){var Y;const de=((Y=window.visualViewport)==null?void 0:Y.height)||0,ye=window.innerHeight;let Ce=ye-de;const Ie=l.current.getBoundingClientRect().height||0,Re=Ie>ye*.8;ie.current||(ie.current=Ie);const Ye=l.current.getBoundingClientRect().top;if(Math.abs(g.current-Ce)>60&&(le.current=!le.current),i&&i.length>0&&je&&De){const Xe=je[De]||0;Ce+=Xe}if(g.current=Ce,Ie>de||le.current){const Xe=l.current.getBoundingClientRect().height;let Te=Xe;Xe>de&&(Te=de-(Re?Ye:$t)),$?l.current.style.height=`${Xe-Math.max(Ce,0)}px`:l.current.style.height=`${Math.max(Te,de-Ye)}px`}else Gn()||(l.current.style.height=`${ie.current}px`);i&&i.length>0&&!le.current?l.current.style.bottom="0px":l.current.style.bottom=`${Math.max(Ce,0)}px`}}return(B=window.visualViewport)==null||B.addEventListener("resize",J),()=>{var Q;return(Q=window.visualViewport)==null?void 0:Q.removeEventListener("resize",J)}},[De,i,je]);function _e(B){Ve(),M==null||M(),B||X(!1),setTimeout(()=>{i&&et(i[0])},fe.DURATION*1e3)}function Ue(){if(!l.current)return;const B=document.querySelector("[data-vaul-drawer-wrapper]"),J=pt(l.current,N);we(l.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`}),we(oe.current,{transition:`opacity ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,opacity:"1"}),j&&J&&J>0&&T&&we(B,{borderRadius:`${ln}px`,overflow:"hidden",...xe(N)?{transform:`scale(${Qe()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Qe()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${fe.DURATION}s`,transitionTimingFunction:`cubic-bezier(${fe.EASE.join(",")})`},!0)}function Ve(){!Z||!l.current||(l.current.classList.remove(Rt),ne.current=!1,be(!1),se.current=new Date)}function qe(B){if(!Z||!l.current)return;l.current.classList.remove(Rt),ne.current=!1,be(!1),se.current=new Date;const J=pt(l.current,N);if(!B||!Me(B.target,!1)||!J||Number.isNaN(J)||ue.current===null)return;const Q=se.current.getTime()-ue.current.getTime(),Y=G.current-(xe(N)?B.pageY:B.pageX),de=Math.abs(Y)/Q;if(de>.05&&(he(!0),setTimeout(()=>{he(!1)},200)),i){Oe({draggedDistance:Y*(N==="bottom"||N==="right"?1:-1),closeDrawer:_e,velocity:de,dismissible:v}),o==null||o(B,!0);return}if(N==="bottom"||N==="right"?Y>0:Y<0){Ue(),o==null||o(B,!0);return}if(de>on){_e(),o==null||o(B,!1);return}var ye;const Ce=Math.min((ye=l.current.getBoundingClientRect().height)!=null?ye:0,window.innerHeight);var Ie;const Re=Math.min((Ie=l.current.getBoundingClientRect().width)!=null?Ie:0,window.innerWidth),Ye=N==="left"||N==="right";if(Math.abs(J)>=(Ye?Re:Ce)*k){_e(),o==null||o(B,!1);return}o==null||o(B,!0),Ue()}h.useEffect(()=>(T&&(we(document.documentElement,{scrollBehavior:"auto"}),ve.current=new Date),()=>{ir(document.documentElement,"scrollBehavior")}),[T]);function z(B){const J=B?(window.innerWidth-nt)/window.innerWidth:1,Q=B?-nt:0;ke.current&&window.clearTimeout(ke.current),we(l.current,{transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,transform:xe(N)?`scale(${J}) translate3d(0, ${Q}px, 0)`:`scale(${J}) translate3d(${Q}px, 0, 0)`}),!B&&l.current&&(ke.current=setTimeout(()=>{const Y=pt(l.current,N);we(l.current,{transition:"none",transform:xe(N)?`translate3d(0, ${Y}px, 0)`:`translate3d(${Y}px, 0, 0)`})},500))}function re(B,J){if(J<0)return;const Q=(window.innerWidth-nt)/window.innerWidth,Y=Q+J*(1-Q),de=-nt+J*nt;we(l.current,{transform:xe(N)?`scale(${Y}) translate3d(0, ${de}px, 0)`:`scale(${Y}) translate3d(${de}px, 0, 0)`,transition:"none"})}function Ne(B,J){const Q=xe(N)?window.innerHeight:window.innerWidth,Y=J?(Q-nt)/Q:1,de=J?-nt:0;J&&we(l.current,{transition:`transform ${fe.DURATION}s cubic-bezier(${fe.EASE.join(",")})`,transform:xe(N)?`scale(${Y}) translate3d(0, ${de}px, 0)`:`scale(${Y}) translate3d(${de}px, 0, 0)`})}return h.useEffect(()=>{O||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[O]),h.createElement(yn,{defaultOpen:U,onOpenChange:B=>{!v&&!B||(B?te(!0):_e(!0),X(B))},open:T},h.createElement(tn.Provider,{value:{activeSnapPoint:$e,snapPoints:i,setActiveSnapPoint:et,drawerRef:l,overlayRef:oe,onOpenChange:n,onPress:ot,onRelease:qe,onDrag:We,dismissible:v,shouldAnimate:C,handleOnly:d,isOpen:T,isDragging:Z,shouldFade:Be,closeDrawer:_e,onNestedDrag:re,onNestedOpenChange:z,onNestedRelease:Ne,keyboardIsOpen:le,modal:O,snapPointsOffset:je,activeSnapPointIndex:De,direction:N,shouldScaleBackground:j,setBackgroundColorOnScale:b,noBodyStyles:P,container:x,autoFocus:y}},r))}const un=h.forwardRef(function({...t},n){const{overlayRef:r,snapPoints:a,onRelease:o,shouldFade:i,isOpen:j,modal:b,shouldAnimate:k}=ut(),S=sn(n,r),v=a&&a.length>0;if(!b)return null;const d=h.useCallback(u=>o(u),[o]);return h.createElement(Cn,{onMouseUp:d,ref:S,"data-vaul-overlay":"","data-vaul-snap-points":j&&v?"true":"false","data-vaul-snap-points-overlay":j&&i?"true":"false","data-vaul-animate":k!=null&&k.current?"true":"false",...t})});un.displayName="Drawer.Overlay";const mn=h.forwardRef(function({onPointerDownOutside:t,style:n,onOpenAutoFocus:r,...a},o){const{drawerRef:i,onPress:j,onRelease:b,onDrag:k,keyboardIsOpen:S,snapPointsOffset:v,activeSnapPointIndex:d,modal:u,isOpen:D,direction:R,snapPoints:$,container:O,handleOnly:M,shouldAnimate:_,autoFocus:P}=ut(),[N,U]=h.useState(!1),q=sn(o,i),f=h.useRef(null),p=h.useRef(null),F=h.useRef(!1),H=$&&$.length>0;pr();const x=(c,V,T=0)=>{if(F.current)return!0;const X=Math.abs(c.y),E=Math.abs(c.x),te=E>X,Z=["bottom","right"].includes(V)?1:-1;if(V==="left"||V==="right"){if(!(c.x*Z<0)&&E>=0&&E<=T)return te}else if(!(c.y*Z<0)&&X>=0&&X<=T)return!te;return F.current=!0,!0};h.useEffect(()=>{H&&window.requestAnimationFrame(()=>{U(!0)})},[]);function y(c){f.current=null,F.current=!1,b(c)}return h.createElement(kn,{"data-vaul-drawer-direction":R,"data-vaul-drawer":"","data-vaul-delayed-snap-points":N?"true":"false","data-vaul-snap-points":D&&H?"true":"false","data-vaul-custom-container":O?"true":"false","data-vaul-animate":_!=null&&_.current?"true":"false",...a,ref:q,style:v&&v.length>0?{"--snap-point-height":`${v[d??0]}px`,...n}:n,onPointerDown:c=>{M||(a.onPointerDown==null||a.onPointerDown.call(a,c),f.current={x:c.pageX,y:c.pageY},j(c))},onOpenAutoFocus:c=>{r==null||r(c),P||c.preventDefault()},onPointerDownOutside:c=>{if(t==null||t(c),!u||c.defaultPrevented){c.preventDefault();return}S.current&&(S.current=!1)},onFocusOutside:c=>{if(!u){c.preventDefault();return}},onPointerMove:c=>{if(p.current=c,M||(a.onPointerMove==null||a.onPointerMove.call(a,c),!f.current))return;const V=c.pageY-f.current.y,T=c.pageX-f.current.x,X=c.pointerType==="touch"?10:2;x({x:T,y:V},R,X)?k(c):(Math.abs(T)>X||Math.abs(V)>X)&&(f.current=null)},onPointerUp:c=>{a.onPointerUp==null||a.onPointerUp.call(a,c),f.current=null,F.current=!1,b(c)},onPointerOut:c=>{a.onPointerOut==null||a.onPointerOut.call(a,c),y(p.current)},onContextMenu:c=>{a.onContextMenu==null||a.onContextMenu.call(a,c),p.current&&y(p.current)}})});mn.displayName="Drawer.Content";const vr=250,wr=120,br=h.forwardRef(function({preventCycle:t=!1,children:n,...r},a){const{closeDrawer:o,isDragging:i,snapPoints:j,activeSnapPoint:b,setActiveSnapPoint:k,dismissible:S,handleOnly:v,isOpen:d,onPress:u,onDrag:D}=ut(),R=h.useRef(null),$=h.useRef(!1);function O(){if($.current){P();return}window.setTimeout(()=>{M()},wr)}function M(){if(i||t||$.current){P();return}if(P(),!j||j.length===0){S||o();return}if(b===j[j.length-1]&&S){o();return}const U=j.findIndex(f=>f===b);if(U===-1)return;const q=j[U+1];k(q)}function _(){R.current=window.setTimeout(()=>{$.current=!0},vr)}function P(){R.current&&window.clearTimeout(R.current),$.current=!1}return h.createElement("div",{onClick:O,onPointerCancel:P,onPointerDown:N=>{v&&u(N),_()},onPointerMove:N=>{v&&D(N)},ref:a,"data-vaul-drawer-visible":d?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},h.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},n))});br.displayName="Drawer.Handle";function jr(t){const n=ut(),{container:r=n.container,...a}=t;return h.createElement(Nn,{container:r,...a})}const mt={Root:gr,Content:mn,Overlay:un,Portal:jr,Title:jn};function Et({...t}){return e.jsx(mt.Root,{"data-slot":"drawer",...t})}function yr({...t}){return e.jsx(mt.Portal,{"data-slot":"drawer-portal",...t})}function kr({className:t,...n}){return e.jsx(mt.Overlay,{"data-slot":"drawer-overlay",className:Ee("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}function Lt({className:t,children:n,...r}){return e.jsxs(yr,{"data-slot":"drawer-portal",children:[e.jsx(kr,{}),e.jsxs(mt.Content,{"data-slot":"drawer-content",className:Ee("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",t),...r,children:[e.jsx("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),n]})]})}function Yt({className:t,...n}){return e.jsx("div",{"data-slot":"drawer-header",className:Ee("flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",t),...n})}function Xt({className:t,...n}){return e.jsx(mt.Title,{"data-slot":"drawer-title",className:Ee("text-foreground font-semibold",t),...n})}function Nr(){const t=Qt(),{selectedWatchDirs:n,selectedSources:r,setFiles:a,refreshFiles:o,showAllFiles:i,setShowAllFiles:j}=Gt(),[b,k]=m.useState(new Set),[S,v]=m.useState(""),[d,u]=m.useState(""),[D,R]=m.useState({}),[$,O]=m.useState(!1),[M]=m.useState([]),[_]=m.useState(null),[P]=m.useState("TODO delete"),[N,U]=m.useState({}),[q,f]=m.useState(!0),[p,F]=m.useState(0),[H,x]=m.useState(null),[y,c]=m.useState(0),[V,T]=m.useState(!1),[X,E]=m.useState(!1),[te,Z]=m.useState(!1),[be,ee]=m.useState(!1),[he,oe]=m.useState(!1),[ve,ue]=m.useState(!1),[se,me]=m.useState(null),[ne,ke]=m.useState(null),[G,le]=m.useState(null),[C,g]=m.useState(""),l=m.useRef({}),W=m.useRef({}),ce=m.useRef({}),ie=m.useRef(null),Se=!0;m.useEffect(()=>{const z=ie.current;if(!z||!Se)return;const re=()=>{const Ne=z.scrollTop;f(Ne<=10),F(Ne)};return z.addEventListener("scroll",re),re(),()=>{z.removeEventListener("scroll",re)}},[Se]);const $e=()=>{const z=ie.current;z&&z.scrollTo({top:0,behavior:"smooth"})},De=async()=>{if(!S.trim()){R({}),u("");return}O(!0);try{const z=new URLSearchParams;z.append("query",S),n.length>0&&z.append("filter",n.join(",")),r.length>0&&z.append("sources",r.join(","));const re=await fetch(Ae(`/api/search?${z.toString()}`));if(re.ok){const Ne=await re.json();if(Ne.success){R(Ne.data.map(Q=>({[Q.file_path]:Q.matches.map(Y=>Y.line_number)})).reduce((Q,Y)=>({...Q,...Y}),{}));const J=Ne.data.map(Q=>{const Y=Q.matches[0];return Y&&Y.video_info?Y.video_info:null}).filter(Q=>Q!==null).filter((Q,Y,de)=>Y===de.findIndex(ye=>ye.full_path===Q.full_path));a(J)}u(S)}}catch(z){console.error("Error searching:",z)}finally{O(!1)}},et=()=>{j(z=>!z)},Oe=()=>{v(""),u(""),R({}),k(new Set),i&&o()},je=z=>{const re=Math.floor(z/3600),Ne=Math.floor(z%3600/60),B=z%60,J=Math.floor(B),Q=Math.round((B-J)*1e3);return`${re.toString().padStart(2,"0")}:${Ne.toString().padStart(2,"0")}:${J.toString().padStart(2,"0")}.${Q.toString().padStart(3,"0")}`},ze=z=>{me(z)},Be=z=>{ke(z)},Le=m.useCallback((z,re)=>{t?z?(ee(!0),oe(!1),ue(!1)):ee(!1):(x(z),E(!1),Z(!1))},[t]),at=()=>{t?(oe(!0),ee(!1),ue(!1)):(E(!0),Z(!1),x(null))},Qe=()=>{t?(ue(!0),ee(!1),oe(!1)):(Z(!0),E(!1),x(null))},ot=()=>{if(E(!1),se!==null&&ne!==null&&G){const z=`/clip_player/${encodeURIComponent(G)}?start_time=${se}&end_time=${ne}&display_text=false`,re=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(lt,{filename:G,start_time_formatted:je(se),end_time_formatted:je(ne),font_size:"",text:C,display_text:!1,onStartTimeChange:ze,onEndTimeChange:Be,onBack:()=>{t?ee(!1):(x(null),Ue())}},G)});Le(re,z)}},Me=()=>{if(Z(!1),se!==null&&ne!==null&&G){const z=`/clip_player/${encodeURIComponent(G)}?start_time=${se}&end_time=${ne}&display_text=false`,re=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(lt,{filename:G,start_time_formatted:je(se),end_time_formatted:je(ne),font_size:"",text:C,display_text:!1,onStartTimeChange:ze,onEndTimeChange:Be,onBack:()=>{t?ee(!1):(x(null),Ue())}},G)});Le(re,z)}},We=(z,re)=>{G&&G!==re?(me(z),ke(null),le(re)):(me(z),le(re))},_e=(z,re)=>{G&&G!==re?(me(null),ke(z),le(re)):(ke(z),le(re))},Ue=()=>{me(null),ke(null),le(null),g(""),x(null),ee(!1),oe(!1),ue(!1),E(!1),Z(!1)},Ve=(z,re,Ne,B)=>{me(z),ke(re),le(B),g(Ne)},qe=()=>{if(se!==null&&ne!==null&&G){const z=`/clip_player/${encodeURIComponent(G)}?start_time=${se}&end_time=${ne}&display_text=false`,re=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(lt,{filename:G,start_time_formatted:je(se),end_time_formatted:je(ne),font_size:"",text:C,display_text:!1,onStartTimeChange:ze,onEndTimeChange:Be,onBack:()=>{t?(Le(null),f(!0),setTimeout(()=>{ie.current&&(ie.current.scrollTop=p)},0)):x(null)}},G)});Le(re,z)}};return m.useEffect(()=>{if(se!==null&&ne!==null&&G){const z=`/clip_player/${encodeURIComponent(G)}?start_time=${se}&end_time=${ne}&display_text=false`,re=e.jsx("div",{className:"w-full flex-1 overflow-y-auto scrollbar-hide",children:e.jsx(lt,{filename:G,start_time_formatted:je(se),end_time_formatted:je(ne),font_size:"",text:C,display_text:!1,onStartTimeChange:ze,onEndTimeChange:Be,onBack:()=>{t?ee(!1):(x(null),Ue())}},G)});Le(re,z)}else(se!==null||ne!==null)&&(t?ee(!1):x(null))},[se,ne,G,Le,t]),m.useEffect(()=>{typeof window<"u"&&(window.handleSetRightPaneComponent=Le)},[Le]),e.jsxs(e.Fragment,{children:[e.jsx(Pn,{show:!0,searchTerm:S,setSearchTerm:v,activeSearchTerm:d,setActiveSearchTerm:u,setSearchLineNumbers:R,setExpandedFiles:k,isSearching:$,queue:M,currentProcessingFile:_,isAtTop:q,clipStart:se,clipEnd:ne,selectedWatchDirs:n,setSelectedWatchDirs:()=>{},availableWatchDirs:[],selectedSources:r,setSelectedSources:()=>{},availableSources:[],showAllFiles:i,onToggleShowAllFiles:et,onSearch:De,onClearSearch:Oe,onScrollToTop:$e,onConfigClick:at,onQueueClick:Qe,mobileClipPlayerComponent:null,onPlayClip:qe}),e.jsxs("div",{className:"flex h-screen",children:[e.jsx(Vn,{watchDirectory:P,isSmallScreen:t,activeSearchTerm:d,searchLineNumbers:D,setSearchLineNumbers:R,expandedFiles:b,setExpandedFiles:k,transcriptData:N,setTranscriptData:U,currentProcessingFile:_,leftPaneWidth:y,setLeftPaneWidth:c,isLeftPaneWidthMeasured:V,setIsLeftPaneWidthMeasured:T,clipStart:se,clipEnd:ne,clipTranscript:G,fileRowRefs:l,transcriptRowRefs:W,mobileTranscriptRowRefs:ce,leftPaneRef:ie,onSetRightPaneUrl:Le,onSetClipStart:We,onSetClipEnd:_e,onClearClip:Ue,onClipBlock:Ve,showAllFiles:i}),!t&&e.jsx("div",{className:"w-1/2 border-l border-border flex flex-col scrollbar-hide pt-16",children:X?e.jsx(Ft,{onClose:ot}):te?e.jsx(At,{onClose:Me}):H||e.jsx(qn,{})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Et,{open:be,onOpenChange:ee,children:e.jsx(Lt,{children:e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:se!==null&&ne!==null&&G&&e.jsx(lt,{filename:G,start_time_formatted:je(se),end_time_formatted:je(ne),font_size:"",text:C,display_text:!1,onStartTimeChange:ze,onEndTimeChange:Be,onBack:()=>ee(!1)},G)})})}),e.jsx(Et,{open:he,onOpenChange:oe,children:e.jsxs(Lt,{children:[e.jsx(Yt,{children:e.jsx(Xt,{children:"Configuration"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Ft,{onClose:()=>oe(!1)})})]})}),e.jsx(Et,{open:ve,onOpenChange:ue,children:e.jsxs(Lt,{children:[e.jsx(Yt,{children:e.jsx(Xt,{children:"Processing Queue"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(At,{onClose:()=>ue(!1)})})]})})]})]})}function $r(){return e.jsx(Nr,{})}export{$r as default};
