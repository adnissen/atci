import{j as e,c as y,d as C,e as M,f as L,I as q,L as _,g as T,h as z,i as S}from"./radix-CDPlHJ-s.js";import{c as d,u as D,T as I,d as Q,e as u,f as m,g as B,h as l}from"./index.js";import{u as P}from"./router-Cji3JhtE.js";import{e as $,f as W}from"./icons-D0PEVxHe.js";function F({...n}){return e.jsx(y,{"data-slot":"dropdown-menu",...n})}function O({...n}){return e.jsx(C,{"data-slot":"dropdown-menu-trigger",...n})}function R({className:n,sideOffset:r=4,...o}){return e.jsx(M,{children:e.jsx(L,{"data-slot":"dropdown-menu-content",sideOffset:r,className:d("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",n),...o})})}function p({className:n,inset:r,variant:o="default",...i}){return e.jsx(q,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":o,className:d("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",n),...i})}function J({className:n,children:r,checked:o,...i}){return e.jsxs(z,{"data-slot":"dropdown-menu-checkbox-item",className:d("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",n),checked:o,...i,children:[e.jsx("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:e.jsx(S,{children:e.jsx($,{className:"size-4"})})}),r]})}function G({className:n,inset:r,...o}){return e.jsx(_,{"data-slot":"dropdown-menu-label","data-inset":r,className:d("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",n),...o})}function K({className:n,...r}){return e.jsx(T,{"data-slot":"dropdown-menu-separator",className:d("bg-border -mx-1 my-1 h-px",n),...r})}function E({onClose:n}={}){const r=P(),{queueStatus:o,fetchQueueStatus:i,isQueueLoading:f,queueError:x}=D(),v=async s=>{confirm(`Remove "${s.split("/").pop()}" from queue?`)},g=async s=>{if(confirm(`Cancel processing of "${s.split("/").pop()}"?`))try{const t=await fetch("/api/queue/cancel",{method:"POST",headers:{"Content-Type":"application/json"}});if(t.ok)await i();else{const a=await t.json().catch(()=>({message:"Unknown error"}));alert(`Failed to cancel job: ${a.message}`)}}catch(t){console.error("Error cancelling job:",t),alert("Failed to cancel processing job")}},j=async s=>{if(s===0)return;const t=[...o.queue],[a]=t.splice(s,1);t.splice(s-1,0,a),await c(t)},b=async s=>{if(s===o.queue.length-1)return;const t=[...o.queue],[a]=t.splice(s,1);t.splice(s+1,0,a),await c(t)},w=async s=>{if(s===0)return;const t=[...o.queue],[a]=t.splice(s,1);t.splice(0,0,a),await c(t)},N=async s=>{if(s===o.queue.length-1)return;const t=[...o.queue],[a]=t.splice(s,1);t.push(a),await c(t)},c=async s=>{try{const t=await fetch("/api/queue/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paths:s})});if(t.ok)await i();else{const a=await t.json().catch(()=>({message:"Unknown error"}));alert(`Failed to set queue: ${a.message}`)}}catch(t){console.error("Error setting queue:",t),alert("Failed to set queue")}},h=s=>{var t;return((t=s.split("/").pop())==null?void 0:t.replace(/\.(mp4|MP4)$/,""))||s},k=()=>{n?n():r("/")};return f?e.jsx("div",{className:"h-full overflow-auto",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-lg text-muted-foreground",children:"Loading queue..."})})}):e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("div",{className:"p-6 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h2",{className:"text-lg font-semibold",children:"Queue"})}),n&&e.jsxs("button",{onClick:k,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(W,{className:"h-4 w-4"}),"Close"]})]}),x&&e.jsx("div",{className:"mb-6 p-4 bg-destructive/10 border border-destructive/20 rounded-md",children:e.jsx("p",{className:"text-sm text-destructive",children:x})}),e.jsx("div",{className:"border border-border rounded-md",children:!o.currently_processing&&o.queue.length===0?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"No items in queue"}):e.jsxs(I,{children:[e.jsx(Q,{children:e.jsxs(u,{children:[e.jsx(m,{className:"w-[15%] text-left",children:"Position"}),e.jsx(m,{className:"w-[65%] text-left",children:"File"}),e.jsx(m,{className:"w-[20%] text-left",children:"Actions"})]})}),e.jsxs(B,{children:[o.currently_processing&&e.jsxs(u,{children:[e.jsx(l,{className:"font-mono text-sm text-left",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"text-orange-600 dark:text-orange-400",children:"Processing"}),e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),o.age_in_seconds!==void 0&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["(",o.age_in_seconds,"s)"]})]})}),e.jsx(l,{className:"font-medium text-left",children:e.jsx("div",{className:"max-w-xs truncate",title:o.currently_processing,children:h(o.currently_processing)})}),e.jsx(l,{className:"text-left",children:e.jsx("button",{onClick:()=>g(o.currently_processing),className:"p-1.5 border border-red-500 text-red-500 bg-transparent rounded hover:bg-red-50 hover:border-red-600 hover:text-red-600 dark:hover:bg-red-950/20 focus:outline-none focus:ring-1 focus:ring-red-500 transition-colors",title:"Cancel processing",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]},`processing-${o.currently_processing}`),o.queue.map((s,t)=>e.jsxs(u,{children:[e.jsx(l,{className:"font-mono text-sm text-left",children:`#${t+1}`}),e.jsx(l,{className:"font-medium text-left",children:e.jsx("div",{className:"max-w-xs truncate",title:s,children:h(s)})}),e.jsx(l,{className:"text-left",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>j(t),disabled:t===0,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Move up",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{onClick:()=>b(t),disabled:t===o.queue.length-1,className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Move down",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs(F,{modal:!1,children:[e.jsx(O,{asChild:!0,children:e.jsx("button",{className:"p-1 text-muted-foreground hover:text-primary hover:bg-accent rounded transition-colors",title:"More actions",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})}),e.jsxs(R,{align:"end",children:[e.jsxs(p,{onClick:()=>w(t),disabled:t===0,className:"focus:text-primary",children:[e.jsx("span",{children:"Send to top"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 10l7-7m0 0l7 7m-7-7v18"})})]}),e.jsxs(p,{onClick:()=>N(t),disabled:t===o.queue.length-1,className:"focus:text-primary",children:[e.jsx("span",{children:"Send to bottom"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})]}),e.jsxs(p,{onClick:()=>v(s),className:"text-destructive focus:text-destructive",children:[e.jsx("span",{children:"Remove from queue"}),e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})]})]})]})]})})]},`${s}-${t}`))]})]})})]})})}const X=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"}));export{F as D,E as Q,O as a,R as b,G as c,K as d,J as e,p as f,X as g};
